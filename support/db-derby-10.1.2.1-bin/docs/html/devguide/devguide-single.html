<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><META http-equiv="Content-Type" content="text/html; charset=utf-8"><title>XSL FO Document</title><META content="text/css" http-equiv="Content-Style-Type"><style type="text/css">
        a { color: black; border: none; text-decoration: none; }
        img { border: none; }
      </style></head><body topmargin="6" leftmargin="6" marginheight="6" marginwidth="6" bgcolor="white"><br><div valign="top">
<div style="font-family: Helvetica; text-align: right;">
<div style="line-height: 140%; font-weight: bold; font-size: 30pt;"></div>
<div style="margin-bottom: 1in; line-height: 140%; font-weight: bold; font-size: 24pt;"></div>
<div style="line-height: 1.5; font-weight: bold; font-size: 11pt;">[vertical list of authors]</div>
<div style="line-height: normal; font-weight: bold; font-size: 11pt; margin-top: 3pc;"> &copy; &nbsp;&nbsp; Copyright
              &nbsp;&nbsp;,. </div>
</div>
<div style="padding: 6pt; border-width: thin; border-color: black; border-style: dashed; font-family: Helvetica; margin-top: 2pc;">
<div style="text-align: center; margin-bottom: 12pc; margin-top: 12pc; line-height: 100%; font-size: 12pt;">
<span style="font-weight: bold; color: purple;">[cover art/text goes here]</span>
</div>
</div>
</div><br><br><div valign="top">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; text-align: center; color: purple;"></div>
</div><br><br><div valign="top">
<div style="line-height: 8pt; font-size: 8pt;">Copyright</div>
</div><div valign="top">
<a name="page1-1"></a><div style="font-family: Helvetica; font-size: 10pt; line-height: 12pt;">
<div style="font-family: Helvetica; text-align: left;">
<div>
 &nbsp;&nbsp;&nbsp; 
</div>
<div style="line-height: 140%; font-weight: bold; font-size: 20pt;">
              Contents </div>
</div>
</div>
</div><div valign="top">
<div style="font-family: Helvetica; font-weight: bold; font-size: 10pt; text-align: center;">
<span>&bull;</span>
</div>
</div><br><br><div valign="top">
<div style="line-height: 8pt; font-size: 8pt;">Copyright</div>
</div><div valign="top">
<div style="font-family: Helvetica; font-size: 10pt; text-align: left;">Apache Software FoundationDerby Developer's GuideApache Derby<div>
<a name="N10033"></a><span></span>
<a name="N1003C"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="rdevcopyright"></a><span></span>Copyright</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">First Edition (July 2005)</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1004A"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Copyright 1997, 2005 The Apache Software Foundation or its licensors,
as applicable.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.   You may
obtain a copy of the License at<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">http://www.apache.org/licenses/LICENSE-2.0</div></pre>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Unless
required by applicable law or agreed to in writing, software   distributed
under the License is distributed on an "AS IS" BASIS,   WITHOUT WARRANTIES
OR CONDITIONS OF ANY KIND, either express or implied.   See the License for
the specific language governing permissions and   limitations under the License.</div>
</div>
</div>
</div>
<div>
<a name="N10064"></a><span></span>
<a name="N1006D"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevdgpref29520"></a><span></span>About this guide</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For general information about the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> documentation, such
as a complete list of books, conventions, and further reading, see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Getting Started with Derby</span>
</span>
</span>.</div>
</div>
<div>
<a name="N100CA"></a><span></span>
<a name="N100D3"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdgpref11181"></a><span></span>Purpose of this guide</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This book explains how to use the core <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> technology and is for
developers building <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications. It describes basic <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> concepts,
such as how you create and access <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases through JDBC procedures
and how you can deploy <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications.</div>
</div>
</div>
<div>
<a name="N10131"></a><span></span>
<a name="N1013A"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdgpref24290"></a><span></span>Audience</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This book is intended for software developers who already know some SQL
and Java. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> users who are not familiar with the SQL standard or
the Java programming language will benefit from consulting books on those
subjects.</div>
</div>
</div>
<div>
<a name="N10180"></a><span></span>
<a name="N10189"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdgpref23947"></a><span></span>How this guide Is Organized</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This document includes the following chapters:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevdvlp19524">JDBC applications and Derby basics</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Basic
details for using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, including loading the JDBC driver, specifying
a database URL, and starting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevstart19524">After installing</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Explains the installation layout.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevdeploy32171">Deploying Derby applications</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An overview of different deployment scenarios, and tips for getting the details
right when deploying applications.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevconcepts19524">Controlling Derby application behavior</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC, cursors, locking and isolation levels, and multiple connections.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevresman19524">Using Derby as a J2EE resource manager</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Information for programmers developing back-end components in a J2EE system.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevadvjdbc35053">Developing Tools and Using Derby with an IDE</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Tips for tool designers.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevtricks32436">SQL tips</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Insiders' tricks of the trade for using SQL.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevin10613">Localizing Derby</a>
</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An
overview of database localization.</div>
</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N10279"></a><span></span>
<a name="N10282"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevupgrades"></a><span></span>Upgrades</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To connect to a database created with a previous version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, you must first upgrade
that database.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Upgrading involves writing changes to the system tables, so it is not possible
for databases on read-only media. The upgrade process:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>marks the database as upgraded to the current release (Version 10.1).</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>allows use of new features such as SYNONYMS with the upgraded database. </div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the release notes for more information on upgrading your databases
to this version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
</div>
<div>
<a name="N102F8"></a><span></span>
<a name="N10301"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="tdevpreupgrade"></a><span></span>Preparing to upgrade</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N10320"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Upgrading occurs the first time the new <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software
connects to the old database. Before connecting with the new software:</div>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Back up your database to a safe location using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> online/offline
backup procedures.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information on backup, see the <span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you do not
perform a soft upgrade, then once the database is upgraded, it cannot be reverted
back to the previous version.</div>
</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N10384"></a><span></span>
<a name="N1038D"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="tdevupgradedb"></a><span></span>Upgrading a database</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To upgrade a database, you must explicitly request an upgrade the
first time you connect to it with the new version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N103B2"></a><span></span>Do not attempt to upgrade a database without first backing it up.</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N103B7"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To request an upgrade when connecting to the database:</div>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Use the <span style="font-family: Courier;">upgrade=true</span> database connection URL attribute,
as shown in the following example:</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:sample;upgrade=true</div></pre>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once the upgrade is complete, you cannot connect to the database
with an older version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
</div>
</td></tr></table></div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N103E8"></a><span></span>You can find out the version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> using
sysinfo:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">java org.apache.derby.tools.sysinfo</div></pre>Note that
this is the version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
not the version of the database. Sysinfo uses information found in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar files, so verify
that only one version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
jar files are in your class path when you run this tool.</div>
</div>
</div>
<div>
<a name="N1043A"></a><span></span>
<a name="N10443"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="tdevupgradesoft"></a><span></span>Soft upgrade</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Soft upgrade allows you run a newer version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> against
an existing database without having to fully upgrade the database. This means
that you can continue to run an older version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> against
the database.</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N10478"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">If you perform a soft upgrade, you will not be able to perform
certain functions that are not available in older versions of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.
For example, the following <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Version
10.1 features cannot be used in a database that has been soft upgraded:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Synonym functionality</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Creating tables using the GENERATED BY DEFAULT option for identity columns</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Reclaiming unused space using the SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE
procedure</div>
</td></tr></table></div>Other new features in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that
do not affect database structure, such as using timestamp arithmetic, are
allowed in a soft upgraded database.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To perform a soft upgrade on a
database created using an earlier version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>:</div>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;"> Simply connect to the database, as shown in the following example:</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">connect 'jdbc:derby:sample'</div></pre>In this example, the
sample database is a Version 10.0 database.</div>
</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N104F8"></a><span></span>
<a name="N10501"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevdvlp19524"></a><span></span>JDBC applications and Derby basics</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This chapter describes the core <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> functionality. In addition,
it details the most basic <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> deployment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> embedded in
a Java application.</div>
</div>
<div>
<a name="N1054B"></a><span></span>
<a name="N10554"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdvlp14839"></a><span></span>Application development overview</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application developers use JDBC, the application programming interface
that makes it possible to access relational databases from Java programs.
The JDBC API is part of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Java<span style="font-size: 75%;">(TM)</span>
</span> 2 Platform, Standard Edition and is
not specific to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. It consists of the <span style="font-style: italic;">java.sql</span> and <span style="font-style: italic;">javax.sql</span> packages,
which is a set of classes and interfaces that make it possible to access databases
(from a number of different vendors, not just <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>) from a Java
application.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To develop <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications successfully, you will need to learn JDBC.
This section does not teach you how to program with the JDBC API.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section covers the details of application programming that are specific
to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications. For example, all JDBC applications typically start
their DBMS's JDBC driver and use a connection URL to connect to a database.
This chapter gives you the details of how to start <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s JDBC driver and
how to work with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s connection URL to accomplish various tasks. It also
covers essential <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> concepts such as the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You will find reference information about the particulars of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s implementation
of JDBC in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application developers will need to learn SQL. <span style="font-style: italic;">SQL</span> is the
standard query language used with relational databases and is not tied to
a particular programming language. No matter how a particular RDBMS has been
implemented, the user can design databases and insert, modify, and retrieve
data using the standard SQL statements and well-defined data types. SQL-92
is the version of SQL standardized by ANSI and ISO in 1992; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports
entry-level SQL-92 as well as some higher-level features. Entry-level SQL-92
is a subset of full SQL-92 specified by ANSI and ISO that is supported by
nearly all major DBMSs today. This chapter does not teach you SQL. You will
find reference information about the particulars of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s implementation
of SQL in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> implements JDBC that allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to serve a resource manager in
a J2EE compliant system.</div>
</div>
</div>
<div>
<a name="N1062F"></a><span></span>
<a name="N10638"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdvlp39409"></a><span></span>Derby embedded basics</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section discusses the basics of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database.</div>
</div>
<div>
<a name="N106C4"></a><span></span>
<a name="N106CD"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdvlp40653"></a><span></span>Derby JDBC driver</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> consists of both the database engine and an embedded JDBC driver.
Applications use JDBC to interact with a database. Applications must load
the driver in order to work with the database.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded environment, loading the driver also starts <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a Java application, you typically load the driver with the static <span style="font-style: italic;">Class.forName</span> method or with the <span style="font-family: Courier;">
<span style="font-style: italic;">jdbc.drivers</span>
</span> system property. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
Class.forName("org.apache.derby.jdbc.EmbeddedDriver");
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For detailed information about loading the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC driver, see <span style="font-style: italic;">"java.sql.Driver" </span> in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>
<span style="font-style: italic;">.</span>
<span style="border-right-width: 0pt; border-left-width: 0pt;"> See also javadoc for org.apache.derby.util.DriverUtil.</span>
</div>
</div>
</div>
<div>
<a name="N10799"></a><span></span>
<a name="N107A2"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdvlp17453"></a><span></span>Derby JDBC database connection URL</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A Java application using the JDBC API establishes a connection to a database
by obtaining a <span style="font-style: italic;">Connection</span> object. The standard way
to obtain a <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> object is to call
the method <span style="font-family: Courier;">
<span style="font-style: italic;">DriverManager.getConnection</span>
</span>,
which takes a String containing a connection URL (uniform resource locator). A JDBC connection URL provides
a way of identifying a database. It also allows you to perform a number of
high-level tasks, such as creating a database or shutting down the system.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An application in an embedded environment uses a different connection URL
from that used by applications using the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network Server in a client/server
environment. See the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>
</span> for more information on the Network
Server. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, all versions of the connection URL (which you can use for tasks besides
connecting to a database) have common features:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>you can specify the name of the database you want to connect to</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>you can specify a number of attributes and values that allow you to accomplish
tasks. For more information about what you can specify with the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection URL,
see "Examples". For detailed reference about attributes and values,
as well as syntax of the database connection URL, see the "<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Database
Connection URL Syntax" in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>. </div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An example use of the connection URL:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn=DriverManager.getConnection("jdbc:derby:sample");</div></pre>
</div>
</div>
<div>
<a name="N10890"></a><span></span>
<a name="N10899"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdvlp27610"></a><span></span>Derby system</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database exists
within a <span style="font-style: italic;">system</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system is a
single instance of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
engine and the environment in which it runs. It consists of a system directory,
zero or more databases, and a system-wide configuration. The system directory
contains any persistent system-wide configuration parameters, or properties,
specific to that system in a properties file called <span style="color: blue;">
<a href="#cdevdvlp39943">derby.properties</a>
</span>.
This file is not automatically created; you must create it yourself.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system is
not persistent; you must specify the location of the system directory at every
startup.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, the system - as well as its directory, which you name - is an
essential part of a running database or databases. Understanding the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
is essential to successful development and deployment of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications.</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>Derby databases
live in a system, which includes system-wide properties, an error log, and
one or more databases.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\system_os.jpg">
</div>
<div></div>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The system directory can also contain an error log file called <span style="font-style: italic;">derby.log </span>(see <span style="color: blue;">
<a href="#cdevdvlp25889">The error log</a>
</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Each database within that system is contained in a subdirectory, which
has the same name as the database (see <span style="color: blue;">
<a href="#cdevdvlp21955">A Derby database</a>
</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can use a property (see <span style="font-style: italic;">"derby.service" </span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>)
to include databases in other directories or in subdirectories of the system
directory in the current system when you start it up.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, if you connect to a database outside the current system, it
automatically becomes part of the current system.</div>
</div>
<div>
<a name="N10A36"></a><span></span>
<a name="N10A3F"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp96597"></a><span></span>One Derby instance for each Java Virtual Machine</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You could potentially have two instances of a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system (JVM)
running on the same machine at the same time. Each instance must run in a
different JVM. Two separate instances of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> must not access the same
database. For example, in an embedded environment, an application that accesses <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
starts up the local JDBC driver, which starts up an instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.
If you start another application, such as ij, and connect to the same database,
severe database corruption can result. See <span style="color: blue;">
<a href="#cdevdvlp20458">Double-booting system behavior</a>
</span>.</div>
</div>
</div>
<div>
<a name="N10AFC"></a><span></span>
<a name="N10B05"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp27715"></a><span></span>Booting databases</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The default configuration for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is to <span style="font-style: italic;">boot</span> (or start) a database when an application first makes a connection to
it. When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> boots a database, it checks to see if recovery needs
to be run on the database, so in some unusual cases booting can take some
time.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also configure your system to automatically boot all databases
in the system when it starts up; see <span style="font-style: italic;">derby.system.bootAll</span> in the <span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span> manual. Because of the time needed to boot a database,
the number of databases in the system directory affects startup performance
if you use that configuration. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once a database has been booted within a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, it remains
active until the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system has been shut down or until you shut down
the database individually.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> boots a database, it prints a message in the error log:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">2005-06-10 03:54:06.196 GMT: Booting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> version <span style="border-right-width: 0pt; border-left-width: 0pt;">Apache Derby</span>
- 10.0.0.1 - (29612): instance c013800d-00fd-0cb0-e736-ffffd1025a25 on
database directory sample</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The number of databases running in a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system is limited only
by the amount of memory available in the JVM.</div>
</div>
</div>
<div>
<a name="N10BF8"></a><span></span>
<a name="N10C01"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevdvlp20349"></a><span></span>Shutting down the system</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N10C1B"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded environment, when an application shuts down, it
should first shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If
the application that started the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> quits
but leaves the JVM running, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> continues
to run and is available for database connections.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded system,
the application shuts down the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
by issuing the following JDBC call:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">DriverManager.getConnection("jdbc:derby:cs;shutdown=true");</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Shutdown
commands always raise <span style="font-style: italic;">SQLExceptions</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
shuts down, a message goes to the error log:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Sat Jan 10 14:31:54 PDT 2005:
Shutting down instance 80000001-00d0-8bdf-d115-000a0a0b2d00</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically,
an application using an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
shuts down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> just before
shutting itself down. However, an application can shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and
later restart it in the same JVM session. To restart <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> successfully,
the JVM needs to unload <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>, so that
it can reload it when it restarts <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.
(Loading the local driver starts <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.) </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You
cannot explicitly request that the JVM unload a class, but you can ensure
that the <span style="font-style: italic;">EmbeddedDriver</span> class is unloaded by using a <span style="font-family: Courier;">
<span style="font-style: italic;">System.gc()</span>
</span> to
force it to garbage collect classes that are no longer needed. Running with <span style="font-family: Courier;">
<span style="font-style: italic;">-nogc</span>
</span> or <span style="font-family: Courier;">
<span style="font-style: italic;">-noclassgc</span>
</span> definitely <span style="font-style: italic;">prevents</span> the class from being unloaded and makes you unable to restart <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in the same JVM. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It
is also possible to shut down a single database instead of the entire <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system. See <span style="color: blue;">
<a href="#tdevdvlp40464">Shutting down Derby or an individual database</a>
</span>.
You can reboot a database in the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> session
after shutting it down.</div>
</div>
</div>
</div>
<div>
<a name="N10D54"></a><span></span>
<a name="N10D5D"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp13018"></a><span></span>Defining the system directory</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You define the system directory when <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> starts
up by specifying a Java <span style="font-style: italic;">system property</span> called <span style="font-family: Courier;">
<span style="font-style: italic;">derby.system.home</span>
</span>.
If you do not specify the system directory when starting up <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
the current directory becomes the system directory.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses
the <span style="font-style: italic;">derby.system.home</span> property to determine which directory is its
system directory - and thus what databases are in its system, where to create
new databases, and what configuration parameters to use. See <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span> for
more information on setting this property.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you specify a system directory at startup that does not exist, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> creates
this new directory - and thus a new system with no databases-automatically.</div>
</div>
</div>
<div>
<a name="N10E2B"></a><span></span>
<a name="N10E34"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp25889"></a><span></span>The error log</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once you create or connect to a database within a system, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> begins
outputting information and error messages, if any. Typically, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> writes
this information to a log called <span style="font-style: italic;">derby.log</span> in the
system directory, although you can also have <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> send messages to
a stream, using a property. By default, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> overwrites <span style="font-style: italic;">derby.log</span> when you start the system. You can configure <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
append to the log with the  <span style="font-family: Courier;">
<span style="font-style: italic;">derby.infolog.append</span>
</span> property.
For information on setting this and other properties, see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N10F09"></a><span></span>
<a name="N10F12"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp39943"></a><span></span>derby.properties</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The text file <span style="font-style: italic;">derby.properties</span> contains the definition
of properties, or configuration parameters valid for the entire system. This
file is not automatically created; if you wish to set <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties
with this file, you need to create it yourself. The file should be in the
format created by the <span style="font-family: Courier;">
<span style="font-style: italic;">java.util.Properties.save</span>
</span> method.
For more information about properties and the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.properties file, see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N10FCA"></a><span></span>
<a name="N10FD3"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp20458"></a><span></span>Double-booting system behavior</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> attempts to prevent two instances of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> from booting
the same database by using a file called <span style="font-style: italic;">db.lck</span> inside
the database directory (see "The Database Directory").</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">On all platforms running with a JDK of 1.4 or higher, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can successfully
prevent a second instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> from booting the database and thus prevents
corruption.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">On some platforms running with a JDK lower than 1.4, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> may prevent
a second instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> from booting the database (previous to JDK 1.4
the ability to do this was OS dependent).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If this is the case, you will see an <span style="font-style: italic;">SQLException</span> like
the following:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ERROR XJ040: Failed to start database 'sample', see the next exception for details.
ERROR XSDB6: Another instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> might have already booted
the databaseC:\databases\sample. 
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The error is also written to the error log.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you are running a JVM prior to 1.4, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues a warning message on
some platforms if an instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> attempts to boot a database that already
has a running instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> attached to it. However, it does not prevent
the second instance from booting, and thus potentially corrupting, the database.
(You can change this behavior with the property <span style="font-family: Courier;">
<span style="font-style: italic;">derby.database.forceDatabaseLock</span>
</span>.)</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a warning message has been issued, corruption might already have occurred.
Corruption can occur even if one of the two booting systems has "readonly"
access to the database.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The warning message looks like this:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
WARNING: <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> 
(instance 80000000-00d2-3265-de92-000a0a0a0200) is
attempting to boot the database /export/home/sky/wombat
even though <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
(instance 80000000-00d2-3265-8abf-000a0a0a0200) might still be active.
Only one instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
should boot a database at a time. Severe and non-recoverable corruption can
result and might have already occurred.</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The warning is also written to the error log.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> If you see this warning, you should close the connection and exit the
JVM, minimizing the risk of a corruption. Close all instances of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
then restart one instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and shut down the database properly
so that the <span style="font-style: italic;">db.lck</span> file can be removed. The warning
message continues to appear until a proper shutdown of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
can delete the <span style="font-style: italic;">db.lck</span> file.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When developing applications, you might want to configure <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
append to the log. Doing so will help you detect when you have inadvertently
started more than one instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in the same system. For example,
when the <span style="font-style: italic;">derby.infolog.append</span> property is set to true
for a system, booting two instances of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in the same system produces
the following in the log:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Sat Aug 14 09:42:51 PDT 2005:
Booting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> version <span style="border-right-width: 0pt; border-left-width: 0pt;">Apache Derby</span> - 10.0.0.1 - (29612): 

instance 80000000-00d2-1c87-7586-000a0a0b1300 on database at
directory C:\tutorial_system\sample
------------------------------------------------------------
Sat Aug 14 09:42:59 PDT 2005:
Booting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> version <span style="border-right-width: 0pt; border-left-width: 0pt;">Apache Derby</span> - 10.0.0.1 - (29612):
instance 80000000-00d2-1c87-9143-000a0a0b1300 on database at
directory C:\tutorial_system\HelloWorldDB</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows you to boot databases that are not in the system directory.
While this might seem more convenient, check that you do not boot the same
database with two JVMs. If you need to access a single database from more
than one JVM, you will need to put a server solution in place. You can allow
multiple JVMs that need to access that database to connect to the server.
The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network Server is provided as a server solution. See the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>
</span> for more information on the Network Server.</div>
</div>
</div>
<div>
<a name="N11167"></a><span></span>
<a name="N11170"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp19297"></a><span></span>Recommended practices</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">When developing <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications, create a single directory to
hold your database or databases. Give this directory a unique name, to help
you remember that:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>All databases exist within a system.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>System-wide properties affect the entire system, and persistent system-wide
properties live in the system directory.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>You can boot all the databases in the system, and the boot-up times of
all databases affect the performance of the system.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>You can preboot databases only if they are within the system. (Databases
do not necessarily have to live inside the system <span style="font-style: italic;">directory</span>, but keeping your databases there is the recommended practice.)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Once you connect to a database, it is part of the current system and thus
inherits all system-wide properties.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Only one instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can run in a JVM at a single time, and
only one instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> should boot a database at one time. Keeping
databases in the system directory makes it less likely that you would use
more than one instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The error log is located inside the system directory.</div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<div>
<a name="N11248"></a><span></span>
<a name="N11251"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdvlp21955"></a><span></span>A Derby database</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database contains dictionary objects such as tables, columns,
indexes, and jar files. A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database can also store its own configuration
information.</div>
</div>
<div>
<a name="N11343"></a><span></span>
<a name="N1134C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp40724"></a><span></span>The database directory</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database is
stored in files that live in a directory of the same name as the database.
Database directories typically live in <span style="font-style: italic;">system</span> directories.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A database directory contains the following, as shown in <span style="color: blue;">
<a href="#cdevdvlp40724">Derby database directories contain files and directories used by the software.</a>
</span>:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">log</span> directory <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Contains files that make up the database transaction
log, used internally for data recovery (not the same thing as the error log).</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">seg0</span> directory <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Contains one file for each user table, system
table, and index (known as conglomerates).</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">service.properties</span> file <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A text file with internal configuration
information.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">tmp</span> directory  <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">(might not exist.) A temporary directory used
by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> for large sorts
and deferred updates and deletes. Sorts are used by a variety of SQL statements.
For databases on read-only media, you might need to set a property to change
the location of this directory. See "Creating <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Databases
for Read-Only Use".</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jar</span> directory  <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">(might not  exist.) A directory in which jar
files are stored when you use database class loading.</div>
</div>
</td></tr></table></div>
<a name="cdevdvlpaccessingareadonlydatabaseinazip"></a><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Read-only database directories
can be archived (and compressed, if desired) into jar or zip files. For more
information, see <span style="color: blue;">
<a href="#cdevdeploy11201">Accessing a read-only database in a zip/jar file</a>
</span>.</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
directories contain files and directories used by the software.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\dbcont.jpg">
</div>
<div></div>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> imposes relatively
few limitations on the number and size of databases and database objects.
The following table shows some size limitations of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
and database objects:</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Size Limits
to Derby Database Objects</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">


<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Type of Object</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Limit</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>tables per database</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span style="font-style: italic;">java.lang.Long.MAX_VALUE</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some operating systems
impose a limit to the number of files allowed in a single directory.</div>
</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>indexes per table</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>32,767 or storage</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>columns per table</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>1,012</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>number of columns on an index key</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>16</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>rows per table</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>no limit</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>size of table</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>no limit Some operating systems impose a limit on the size
of a single file.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>size of row</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>no limit--rows can span pages. Rows cannot span tables
so some operating systems impose a limit on the size of a single file, and
therefore limit the size of a table and size of a row in that table.</div>
</td>
</tr>
</tbody>
</table>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For a complete list of restrictions on <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
and database objects, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N115AF"></a><span></span>
<a name="N115B8"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp42173"></a><span></span>Creating, dropping, and backing up databases</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You create new databases and access existing ones by specifying attributes
to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection URL (see <span style="color: blue;">
<a href="#rdevdvlp22102">Database connection examples</a>
</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There is no drop database command. To drop a database, delete the database
directory with operating system commands. The database must not be booted
when you remove a database. You can get a list of booted databases with <span style="font-style: italic;">getPropertyInfo</span> (see <span style="color: blue;">
<a href="#cdevadvjdbc41138">Offering Connection Choices to the User</a>
</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To back up a database, you can use the online backup utility. For information
on this utility, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also use <span style="font-style: italic;">roll-forward recovery</span> to recover
a damaged database. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> accomplishes roll-forward recovery by using a full
backup copy of the database, archived logs, and active logs from the most
recent time before a failure. For more information on roll-forward recovery
see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N116B2"></a><span></span>
<a name="N116BB"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp845973"></a><span></span>Single database shutdown</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An application can shut down a single database within a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
and leave the rest of the system running. See <span style="color: blue;">
<a href="#tdevdvlp40464">Shutting down Derby or an individual database</a>
</span>.</div>
</div>
</div>
<div>
<a name="N11757"></a><span></span>
<a name="N11760"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp18166"></a><span></span>Storage and recovery</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database provides persistent storage and recovery. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> ensures
that all committed transactions are durable, even if the system fails, through
the use of a database transaction log. Whereas inserts, updates, and deletes
may be cached before being written to disk, log entries tracking all those
changes are never cached but always forced to disk when a transaction commits.
If the system or operating system fails unexpectedly, when <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> next starts
up it can use the log to perform recovery, recovering the "lost" transactions
from the log and rolling back uncommitted transactions. <span style="font-style: italic;">Recovery</span> ensures that all committed transactions at the time the system
failed are applied to the database, and all transactions that were active
are rolled back. Thus the databases are left in a consistent, valid state.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In normal operation, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> keeps the log small through periodic checkpoints.
Checkpointing marks the portions of the log that are no longer useful, writes
changed pages to disk, then truncates the log.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> checkpoints the log file as it fills. It also checkpoints the
log when a shutdown command is issued. Shutting down the JVM in which <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
running without issuing the proper shutdown command is equivalent to a system
failure from <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s point of view.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Booting a database means that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> checks to see if recovery needs
to be run on a database. Recovery can be costly, so using the proper shutdown
command improves connection or startup performance.</div>
</div>
</div>
<div>
<a name="N11846"></a><span></span>
<a name="N1184F"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp84026"></a><span></span>Log on separate device</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can put a database's log on a separate device when you create it.
For more information, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N118DE"></a><span></span>
<a name="N118E7"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp25820"></a><span></span>Database Pages</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tables and indexes, known as conglomerates, consist of two
or more pages. A page is a unit of storage whose size is configurable on a
system-wide, database-wide, or conglomerate-specific basis. By default, a
conglomerate grows one page at a time until eight pages of user data (or nine
pages of total disk use, which includes one page of internal information)
have been allocated. (You can configure this behavior; see <span style="font-style: italic;">"derby.storage.initialPages" </span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.)
After that, it grows eight pages at a time.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The size of a row or column is not limited by the page size. Rows or columns
that are longer than the table's page size are automatically wrapped to
overflow pages. </div>
</div>
</div>
<div>
<a name="N11998"></a><span></span>
<a name="N119A1"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp846110"></a><span></span>Database-wide properties</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can set many <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties as database-level properties. When
set in this way, they are stored in the database and "travel" with
the database unless overridden by a system property. For more information,
see "Database-Wide Properties" in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  You should work with database-level properties
wherever possible.</div>
</div>
</div>
<div>
<a name="N11A4D"></a><span></span>
<a name="N11A56"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp30653"></a><span></span>Database limitations</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases have these limitations:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Indexes are not supported for columns defined on CLOB,
BLOB, and LONG VARCHAR data types.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the length of the key columns
in an index is larger than half the page size of the index, creating an index
on those key columns for the table fails. For existing indexes, an insert
of new rows for which the key columns are larger than half of the index page
size causes the insert to fail.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It is generally not recommended to create
indexes on long columns. It is best to create indexes on small columns that
provide a quick look-up to larger, unwieldy data in the row. You might not
see performance improvements if you index long columns. For information about
indexes, see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>. </div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">The system shuts down if the database log cannot allocate
more disk space.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A "LogFull" error or some sort of <span style="font-family: Courier;">
<span style="font-style: italic;">IOException</span>
</span> will occur in the <span style="font-style: italic;">derby.log </span> if the system runs out of space. If the system has no more
disk space to append to the <span style="font-style: italic;">derby.log</span>, you might not
see the error messages.</div>
</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N11B46"></a><span></span>
<a name="N11B4F"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdvlp34964"></a><span></span>Connecting to databases</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You connect to a database using a form of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection URL as an argument
to the <span style="font-style: italic;">DriverManager.getConnection</span> call (see <span style="color: blue;">
<a href="#cdevdvlp17453">Derby JDBC database connection URL</a>
</span>). You specify a path to the database within
this connection URL.</div>
</div>
<div>
<a name="N11C03"></a><span></span>
<a name="N11C0C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp19619"></a><span></span>Standard connections</div>
<div style="margin-left: 72pt; font-size: 10pt;"></div>
<div>
<a name="N11C85"></a><span></span>
<a name="N11C8E"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp846369"></a><span></span>Connecting to databases within the system: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The standard way to access databases is in the file system by specifying
the path to the database, either absolute or relative to the system directory.
In a client/server environment, this path is always on the <span style="font-style: italic;">server</span> machine.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By default, you can connect to databases within the current system directory
(see <span style="color: blue;">
<a href="#cdevdvlp13018">Defining the system directory</a>
</span>). To connect to databases within
the current system, just specify the database name on the connection URL. For example,
if your system directory contains a database called <span style="font-style: italic;">myDB</span>, you can connect to that database with the following connection URL:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:myDB</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The full call within a Java program would be:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn =DriverManager.getConnection("jdbc:derby:myDB");</div></pre>
</div>
</div>
<div>
<a name="N11CFD"></a><span></span>
<a name="N11D06"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp846402"></a><span></span>Connecting to databases outside the system directory: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also connect to databases in other directories (including subdirectories
of the system directory) by specifying a relative or absolute path name to
identify the database. The way you specify an absolute path is defined by
the host operating system (see <span style="font-style: italic;">java.io.File.isAbsolute</span>).
You must specify a path for a database in a directory other than the system
directory even if you have defined the <span style="font-family: Courier;">
<span style="font-style: italic;">derby.service</span>
</span> property to have <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> boot the database automatically (see <span style="font-style: italic;">"derby.service"</span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Using the connection URL as described here, you can connect to databases in more
than one directory at a time.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Two examples:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:../otherDirectory/myDB

jdbc:<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>:c:/otherDirectory/myDB</div></pre>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Once connected to, such a database becomes a part of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
even though it is not in the system directory. This means that it takes on
the system-wide properties of the system and that no other instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> should
access that database, among other things. It is recommended that you connect
to databases only in the system directory. See <span style="color: blue;">
<a href="#cdevdvlp19297">Recommended practices</a>
</span> for suggestions about working with a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div>
</div>
</div>
</div>
<div>
<a name="N11DAA"></a><span></span>
<a name="N11DB3"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp40350"></a><span></span>Conventions for specifying the database path</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When accessing databases from the file system (instead of from classpath
or a jar file), any path that is not absolute is interpreted as relative to
the system directory. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The path must do one of the following:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>refer to a previously created <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>specify the <span style="font-style: italic;">create=true</span> attribute</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The path separator in the connection URL is / (forward slash), as in the standard <span style="font-style: italic;">file:// </span>URL protocol.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can specify only databases that are local to the machine on which the
JVM is running. NFS file systems on UNIX and remote shared files on Windows
(//<span style="font-style: italic;">machine/directory</span>) are not guaranteed to work.
Using <span style="font-style: italic;">derby.system.home</span> and forward slashes is recommended
practice for platform independent applications.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If two different database name values, relative or absolute, refer to the
same actual directory, they are considered equivalent. This means that connections
to a database through its absolute path and its relative path are connections
to the same database. Within <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, the name of the database is defined
by the canonical path of its directory from <span style="font-style: italic;">java.io.File.getCanonicalPath</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> automatically creates any intermediate directory that does
not already exist when creating a new database. If it cannot create the intermediate
directory, the database creation fails.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the path to the database is ambiguous, i.e., potentially the same as
that to a database that is available on the classpath (see "Special Database
Access"), use the <span style="font-style: italic;">directory:</span> subsubprotocol to
specify the one in the file system. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:directory:myDB</div></pre>
</div>
</div>
<div>
<a name="N11E7E"></a><span></span>
<a name="N11E87"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp19700"></a><span></span>Special database access</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also access databases from the classpath or from a jar file (in
the classpath or not) as read-only databases.</div>
</div>
<div>
<a name="N11EF3"></a><span></span>
<a name="N11EFC"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp91854"></a><span></span>Accessing databases from the classpath: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In most cases, you access databases from the file system as described above.
However, it is also possible to access databases from the classpath. The
databases can be archived into a jar or zip file or left as is.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">All such databases are read-only.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To access an unarchived database from the classpath, specify the name
of the database relative to the directory in the classpath. You can use the
classpath subprotocol if such a database is ambiguous within the directory
system. See <span style="color: blue;">
<a href="#rdevdvlp38881">Embedded Derby JDBC database connection URL</a>
</span> for more information.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, for a database called <span style="font-style: italic;">sample</span> in <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>\demo\databases</span>, you can put the <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>\demo\databases</span> directory in the
classpath and access <span style="font-style: italic;">sample</span> like this:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:/sample
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The forward slash is required before <span style="font-style: italic;">sample</span> to
indicate that it is relative to <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>\demo\databases</span> directory.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If only <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>
</span> were in the class
path, you could access <span style="font-style: italic;">sample</span> (read-only) like this:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:/demo/databases/sample
</div></pre>
</div>
</div>
<div>
<a name="N11FB5"></a><span></span>
<a name="N11FBE"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdvlp24155"></a><span></span>Accessing databases from a jar or zip file: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It is possible to access databases from a jar file. The jar file can be,
but does not have to be, on the classpath.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  All such databases are read-only.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, suppose you have archived the database <span style="font-style: italic;">jarDB1</span> into a file called <span style="font-style: italic;">jar1.jar</span>. This archive
is in the classpath before you start up <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. You can access <span style="font-style: italic;">jarDB1</span> with the following connection URL</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:/jarDB1</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To access a database in a jar file that is not on the classpath, use the
jar subprotocol. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, suppose you have archived the database <span style="font-style: italic;">jarDB2</span> into a file called <span style="font-style: italic;">jar2.jar</span>. This archive
is not in the classpath. You can access <span style="font-style: italic;">jarDB2</span> by
specifying the path to the jar file along with the jar subsubprotocol, like
this:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:jar:(c:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/jar2.jar)jarDB2
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For complete instructions and examples of accessing databases in jar files,
see <span style="color: blue;">
<a href="#cdevdeploy11201">Accessing a read-only database in a zip/jar file</a>
</span>.</div>
</div>
</div>
</div>
<div>
<a name="N1204E"></a><span></span>
<a name="N12057"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevdvlp22102"></a><span></span>Database connection examples</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12071"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12079"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The examples in this section use the syntax of the connection URL for use in an
embedded environment. This information also applies to the client connection URL in
a client/server environment. For reference information about client connection URLs,
see <span style="font-style: italic;">"java.sql.Connection"</span> in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12096"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:db1</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a connection to the database <span style="font-style: italic;">db1</span>. <span style="font-style: italic;">db1</span> is a directory located
in the system directory.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:london/sales</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a connection to
the database <span style="font-style: italic;">london/sales</span>. <span style="font-style: italic;">london</span> is a subdirectory of the system directory, and <span style="font-style: italic;">sales</span> is a subdirectory of the directory <span style="font-style: italic;">london</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:/reference/phrases/french</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a
connection to the database <span style="font-style: italic;">/reference/phrases/french</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">On a UNIX system, this would be the path of the directory. On a Windows
system, the path would be <span style="font-style: italic;">C:\reference\phrases\french</span> if
the current drive were <span style="font-style: italic;">C. </span>If a jar file storing databases
were in the user's classpath, this could also be a path within the jar
file.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:a:/demo/sample</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a connection
to the database stored in the directory <span style="font-style: italic;">\demo\sample</span> on
drive <span style="font-style: italic;">A</span> (usually the floppy drive) on a Windows system.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>:c:/databases/salesdb jdbc:derby:salesdb</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These two connection URLs connect to the same database, <span style="font-style: italic;">salesdb</span>, on a Windows platform if the system directory of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
is <span style="font-style: italic;">C:\databases</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:support/bugsdb;create=true</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Create
the database <span style="font-style: italic;">support/bugsdb</span> in the system directory,
automatically creating the intermediate directory <span style="font-style: italic;">support</span> if it does not exist.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:sample;shutdown=true</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Shut down the <span style="font-style: italic;">sample</span> database.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:/myDB</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access <span style="font-style: italic;">myDB</span> (which is directly in a directory in the classpath) as a read-only
database.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:classpath:/myDB</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access <span style="font-style: italic;">myDB</span> (which is directly in a directory in the classpath) as a read-only
database. The reason for using the subsubprotocol is that it might  have the
same path as a database in the directory structure.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:jar:(C:/dbs.jar)products/boiledfood</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access the read-only database <span style="font-style: italic;">boiledfood</span> in the <span style="font-style: italic;">products</span> directory from the jar file <span style="font-style: italic;">C:/dbs.jar</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jdbc:derby:directory:myDB</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access <span style="font-style: italic;">myDB</span>, which is in the system directory. The reason for using the <span style="font-family: Courier;">
<span style="font-style: italic;">directory:</span>
</span> subsubprotocol is that it might happen
to have the same path as a database in the classpath.</div>
</div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<div>
<a name="N12212"></a><span></span>
<a name="N1221B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdvlp51654"></a><span></span>Working with the database connection URL attributes</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You specify attributes on the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection URL (see <span style="color: blue;">
<a href="#cdevdvlp17453">Derby JDBC database connection URL</a>
</span>). The examples in this section use the syntax of the connection URL for
use in an embedded environment. You can also specify these same attributes
and values on the client connection URL if you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> as a database
server. For more information, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also set these attributes by passing a <span style="font-style: italic;">Properties</span> object along with a connection URL to <span style="font-family: Courier;">
<span style="font-style: italic;">DriverManager.getConnection</span>
</span> when obtaining a connection; see "Specifying Attributes in
a Properties Object".</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">All attributes are optional. For detailed information about the connection URL syntax
and attributes, see "<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Database Connection URL Syntax"in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can specify the following attributes:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">bootPassword=key</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">create=true</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">databaseName=nameofDatabase</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">dataEncryption=true</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">encryptionProvider=providerName</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">encryptionAlgorithm=algorithm</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">territory=ll_CC</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">logDevice=logDirectoryPath</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">createFrom=BackupPath</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">restoreFrom=BackupPath</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">rollForwardrecoveryFrom=BackupPath</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">password=userPassword</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">shutdown=true</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">user=userName</span>
</div>
</td></tr></table></div>
</div>
<div>
<a name="N123D0"></a><span></span>
<a name="N123D9"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevdvlp847152"></a><span></span>Using the databaseName attribute</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1240C"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:;databaseName=<span style="font-style: italic;">databaseName</span>
</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1241B"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can access read-only databases in jar or zip files by specifying jar
as the subsubprotocol, like this:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12424"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:jar:(<span style="font-style: italic;">pathToArchive</span>)<span style="font-style: italic;">databasePathWithinArchive</span>
</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12439"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Or, if the jar or zip file has been included in the classpath, like this:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12442"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:/<span style="font-style: italic;">databasePathWithinArchive</span>
</div></pre>
</div>
</div>
</div>
<div>
<a name="N124B3"></a><span></span>
<a name="N124BC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevdvlp40464"></a><span></span>Shutting down Derby or an individual database</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N124EA"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Applications in an embedded environment shut down the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
by specifying the <span style="font-style: italic;">shutdown=true</span> attribute in the connection URL.
To shut down the system, you do not specify a database name, and you must
not specify any other attribute.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:;<span style="border-right-width: 0pt; border-left-width: 0pt;">shutdown=true</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A successful shutdown always results in an <span style="font-style: italic;">SQLException</span> to indicate that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> has shut down and that there is no other
exception.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also shut down an individual database if you specify the <span style="font-style: italic;">databaseName</span>. You can shut down the database of the current connection
if you specify the default connection instead of a database name<span style="font-style: italic;"></span>(within an SQL statement).</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-weight: bold;">// shutting down a database from your application</span>
DriverManager.getConnection(
    "jdbc:derby:sample;shutdown=true");</span>
</div></pre>
</div>
</div>
</div>
<div>
<a name="N1259C"></a><span></span>
<a name="N125A5"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevdvlp39090"></a><span></span>Creating and accessing a database</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N125CE"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You create a database by supplying a new database name in the connection URL and
specifying <span style="font-style: italic;">create=true</span>. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> creates a new
database inside a new subdirectory in the system directory. This system directory
has the same name as the new database. If you specify a partial path, it is
relative to the system directory. You can also specify an absolute path.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:<span style="font-style: italic;">databaseName</span>;<span style="border-right-width: 0pt; border-left-width: 0pt;">create=true</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more details about <span style="font-style: italic;">create=true</span>, see <span style="font-style: italic;">"create=true"</span> in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
</div>
</div>
<div>
<a name="N12675"></a><span></span>
<a name="N1267E"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevdvlp12233"></a><span></span>Providing a user name and password</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1269D"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When user authentication is enabled, an application must provide a user
name and password. One way to do this is to use connection URL attributes (see <span style="font-style: italic;">user=userName</span> and <span style="font-style: italic;">password=userPassword</span>).</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:sample;user=jill;password=toFetchAPail</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see <span style="color: blue;">
<a href="#cdevcsecure42374">Working with user authentication</a>
</span>.</div>
</div>
</div>
</div>
<div>
<a name="N12727"></a><span></span>
<a name="N12730"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevdvlp14496"></a><span></span>Encrypting a database when you create it</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1274F"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If your environment is configured properly, you can create your database
as an encrypted database (one in which the database is encrypted on disk).
To do this, you use the <span style="font-style: italic;">dataEncryption=true</span> attribute
to turn on encryption and the <span style="font-family: Courier;">
<span style="font-style: italic;">bootPassword=key</span>
</span> attribute
to specify a key for the encryption. You can also specify an encryption provider
and encryption algorithm other than the defaults with the <span style="font-family: Courier;">
<span style="font-style: italic;">encryptionProvider=providerName</span>
</span> and <span style="font-family: Courier;">
<span style="font-style: italic;">encryptionAlgorithm=algorithm </span>
</span>attributes For more information about data encryption, see <span style="color: blue;">
<a href="#cdevcsecure24366">Encrypting databases on disk</a>
</span>.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:encryptedDB;create=true;dataEncryption=true;
bootPassword=DBpassword
</div></pre>
</div>
</div>
</div>
<div>
<a name="N127EC"></a><span></span>
<a name="N127F5"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevdvlp40140"></a><span></span>Booting an encrypted database</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12814"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You must specify the encryption key with the <span style="font-style: italic;">bootPassword=key</span> attribute for an encrypted database when you boot it (which is the first
time you connect to it within a JVM session or after shutting it down within
the same JVM session). For more information about data encryption, see <span style="color: blue;">
<a href="#cdevcsecure24366">Encrypting databases on disk</a>
</span>.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:encryptedDB;bootPassword=DBpassword
</div></pre>
</div>
</div>
</div>
<div>
<a name="N12893"></a><span></span>
<a name="N1289C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevdvlp36289"></a><span></span>Specifying attributes in a properties object</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N128C0"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Instead of specifying attributes on the connection URL, you can specify attributes
as properties in a <span style="font-style: italic;">Properties</span> object that you pass
as a second argument to the <span style="font-family: Courier;">
<span style="font-style: italic;">DriverManager.getConnection</span>
</span> method. For example, to set the user name and password:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Class.forName("org.apache.derby.jdbc.EmbeddedDriver");

Properties p = new Properties();

p.put("user", "sa");

p.put("password", "manager");


Connection conn = DriverManager.getConnection(

    "jdbc:derby:mynewDB", p);</div></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N12941"></a><span></span>
<a name="N1294A"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevstart19524"></a><span></span>After installing</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This chapter provides reference information about the installation directory,
JVMs, classpath, upgrades, and platform-specific issues.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Review the <span style="font-family: Courier;">install.html</span> file that is installed with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> for
information on installing the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> development environment. See the Release
Notes for information on platform support, changes that may affect your existing
applications, defect information, and recent documentation updates. See <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Getting Started with Derby</span>
</span>
</span> for basic product descriptions, information
on getting started, and directions for setting the path and the classpath. </div>
</div>
<div>
<a name="N129C1"></a><span></span>
<a name="N129CA"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstart16043"></a><span></span>The installation directory</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The installation program installs the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software in a directory
of your choice. See the<span style="font-family: Courier;"> install.html</span> file for information on how
to install <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The installer automatically creates setup scripts that include an environment
variable called <span style="border-right-width: 0pt; border-left-width: 0pt;">DERBY_INSTALL</span>. The installer's value is set to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
base directory.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">C:&gt;echo %<span style="border-right-width: 0pt; border-left-width: 0pt;">DERBY_INSTALL</span>%
C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">DERBY_INSTALL</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you want to set your own environment, <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Getting Started with Derby</span>
</span>
</span> instructs
you on setting its value to the directory in which you installed the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
software.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The installer for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> installs all the files you need,
including the documentation set, some example applications, and a sample database.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Details about the installation:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">index.html </span>in the top-level directory is the top
page for the on-line documentation.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">release_notes.html</span>, in the top-level <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> base
directory, contains important last-minute information. <span style="font-style: italic;">Read it first</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">/demo</span> contains some sample applications, useful
scripts, and prebuilt databases.  
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">/databases</span> includes prebuilt sample databases.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">/programs</span> includes sample applications.</div>
</td></tr></table></div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">/doc</span> contains the on-line documentation (including
this document).</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">/frameworks</span> contains utilities and scripts for
running <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">/javadoc</span> contains the documented APIs for the
public classes and interfaces. Typically, you use the JDBC interface to interact
with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>; however, you can use some of these additional classes in
certain situations.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">/lib</span> contains the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> libraries.</div>
</td></tr></table></div>
</div>
<div>
<a name="N12B2C"></a><span></span>
<a name="N12B35"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevstart813142"></a><span></span>Batch files and shell scripts</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-style: italic;">/frameworks/embedded/bin</span> directory contains scripts for running some of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools
and utilities. To customize your environment, put the directory first in your
path.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These scripts serve as examples to help you get started with these tools
and utilities on any platform. However, they can require modification in order
to run properly on certain platforms.</div>
</div>
</div>
</div>
<div>
<a name="N12B7E"></a><span></span>
<a name="N12B87"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstart18978"></a><span></span>Derby and JVMs</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is a database engine written completely in Java; it will run
in any JVM, version 1.3 or higher.</div>
</div>
</div>
<div>
<a name="N12BEB"></a><span></span>
<a name="N12BF4"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstart98282"></a><span></span>Derby libraries and classpath</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> libraries are located in the /<span style="font-style: italic;">lib</span> subdirectory
of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> base directory. You must set the classpath on your development
machine to include the appropriate libraries.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Getting Started with Derby</span>
</span>
</span>
<span style="font-style: italic;"></span> explains how to set the
classpath in a development environment.</div>
</div>
</div>
<div>
<a name="N12C68"></a><span></span>
<a name="N12C71"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstart41260"></a><span></span>UNIX-specific issues</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;"></div>
<div>
<a name="N12CD7"></a><span></span>
<a name="N12CE0"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevstart39409"></a><span></span>Configuring file descriptors</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases create one file per table or index. Some operating
systems limit the number of files an application can open at one time. If
the default is a low number, such as 64, you might run into unexpected <span style="font-style: italic;">IOExceptions</span> (wrapped in <span style="font-family: Courier;">
<span style="font-style: italic;">SQLExceptions</span>
</span>). If your operating system lets you configure the number of file
descriptors, set this number to a higher value.</div>
</div>
</div>
<div>
<a name="N12D37"></a><span></span>
<a name="N12D40"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevstart813545"></a><span></span>Scripts</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Your installation contains executable script files that simplify invoking
the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools. On UNIX systems, these files might need to have their
default protections set to include execute privilege. A typical way to do
this is with the command <span style="font-style: italic;">chmod +x *.ksh</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Consult the documentation for your operating system for system-specific
details.</div>
</div>
</div>
</div>
</div>
<div>
<a name="N12D77"></a><span></span>
<a name="N12D80"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevdvlp25174"></a><span></span>Derby embedded basics</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section explains how to use and configure <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in an embedded
environment. Included in the installation is a sample application program, <span style="font-style: italic;">/demo/programs/simple</span>, which illustrates how to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> embedded
in the calling program.</div>
</div>
<div>
<a name="N12DE4"></a><span></span>
<a name="N12DED"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdvlp40170"></a><span></span>Embedded Derby JDBC driver</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> driver class name for the embedded environment is <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>. In a Java application, you typically load the driver with the static <span style="font-family: Courier;">
<span style="font-style: italic;">Class.forName</span>
</span> method or with the <span style="font-family: Courier;">
<span style="font-style: italic;">jdbc.drivers</span>
</span> system property. For more information, see "Starting
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> as an Embedded Database".</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For detailed information about loading the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC driver, see <span style="font-style: italic;">"java.sql.Driver"</span> in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>
<span style="font-style: italic;">.</span>
</div>
</div>
</div>
<div>
<a name="N12E90"></a><span></span>
<a name="N12E99"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="rdevdvlp38881"></a><span></span>Embedded Derby JDBC database connection URL</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12EE5"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The standard <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC connection URL, which you can use for tasks besides
connecting to a database, is</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12EF4"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:[subsubprotocol:][<span style="font-style: italic;">databaseName</span>][;<span style="font-style: italic;">attribute</span>=<span style="font-style: italic;">value</span>]*</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12F10"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">Subsubprotocol</span>, which is not typically specified,
determines how <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> looks for a database: in a directory, in a class
path, or in a jar file. Subsubprotocol is one of the following:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12F24"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">directory</span> The default. Specify this explicitly
only to distinguish a database that might be ambiguous with one on the class
path.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">classpath</span> Databases are treated as read-only databases,
and all <span style="font-style: italic;">databaseNames</span> must begin with at least a slash,
because you specify them "relative" to the classpath directory.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jar</span> Databases are treated as read-only databases. <span style="font-style: italic;">DatabaseNames</span> might require a leading slash, because you
specify them "relative" to the jar file.</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12F56"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">jar</span> requires an additional element immediately
before the database name:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12F64"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">(<span style="font-style: italic;">pathToArchive</span>)</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12F74"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">pathToArchive</span> is the path to the jar or zip file
that holds the database.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12F82"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For examples of using this syntax, see <span style="color: blue;">
<a href="#cdevdeploy11201">Accessing a read-only database in a zip/jar file</a>
</span>.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12F93"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You typically pass the connection URL as an argument to the JDBC <span style="font-style: italic;">DriverManager.getConnection</span> method call. For example:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12FA2"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
DriverManager.getConnection("jdbc:derby:sample");
</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N12FAC"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can specify attributes and attribute values to a connection URL. For more information
about what you can specify with the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection URL, see <span style="color: blue;">
<a href="#rdevdvlp22102">Database connection examples</a>
</span>. For detailed reference about attributes and values, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
</div>
</div>
<div>
<a name="N1300C"></a><span></span>
<a name="N13015"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdvlp10252"></a><span></span>Getting a nested connection</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you are executing a method within SQL, that method might need
to reuse the current connection to the database in order to execute more SQL statements.
Such a connection is called a<span style="font-style: italic;"> nested connection</span>. The
way for a method to get a nested connection is to issue a connection request
using the connection URL.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:default:connection</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">URL attributes are not supported as part of this connection URL. Any URL
attributes specified in a Properties object, user name, or password that are
passed to a <span style="font-style: italic;">java.sql.DriverManager.getConnection()</span> call
will be ignored.</div>
</div>
</div>
<div>
<a name="N1309F"></a><span></span>
<a name="N130A8"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="tdevdvlp38381"></a><span></span>Starting Derby as an embedded database</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N130E5"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To start <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, you start the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC driver. Starting the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> driver
starts up the complete <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system within the current JVM.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, when using the JBDC driver manager directly within Java code,
you typically start a JDBC driver in one of two ways:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Specify the <span style="font-style: italic;">jdbc.drivers</span> system property, which
allows users to customize the JDBC drivers used by their applications. For
example:  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
java -Djdbc.drivers=org.apache.derby.jdbc.EmbeddedDriver <span style="font-style: italic;">applicationClass
</span>
</div></pre>
</div>
</td></tr></table></div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Load the class directly from Java code using the static method <span style="font-style: italic;">Class.forName</span>. For example:  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
Class.forName("org.apache.derby.jdbc.EmbeddedDriver"); 
</div></pre>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more details, see <span style="font-style: italic;">"java.sql.Driver"</span> in
the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>
<span style="font-style: italic;">.</span>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC driver class has been loaded, you can connect
to any <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database by passing the embedded connection URL with the appropriate
attributes to the <span style="font-style: italic;">DriverManager.getConnection</span> method.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection("jdbc:derby:sample");</div></pre>
</div>
</div>
</div>
</div>
<div>
<a name="N131B4"></a><span></span>
<a name="N131BD"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevdeploy32171"></a><span></span>Deploying Derby applications</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, once you have developed a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application and database,
you package up the application, the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> libraries, and the database
in some means for distribution to your users. This process is called <span style="font-style: italic;">deployment</span>. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section discusses issues for deploying <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications and
databases.</div>
</div>
<div>
<a name="N1321F"></a><span></span>
<a name="N13228"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdeploy38918"></a><span></span>Deployment issues</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section discusses deployment options and details.</div>
</div>
<div>
<a name="N13287"></a><span></span>
<a name="N13290"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy855368"></a><span></span>Embedded deployment application overview</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In an embedded environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> runs
in the same JVM as the application.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The application can be a single-user application or a multi-user application
server. In the latter case, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> runs
embedded in the user-provided server framework, and any client applications
use user-provided connectivity or allow the application server to handle all
database interaction.</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> embedded
in a single-user Java application</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\embed_os.jpg">
</div>
<div></div>
</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>Derby embedded in a multi-user Java application
server</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\itserv_os.jpg">
</div>
<div></div>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
is embedded in a Java application, the database is dedicated to that single
application. If you deploy more than one copy of the application, <span style="font-style: italic;">each
application has its own copy of the database and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software</span>.
A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> server framework
can work in multi-threaded, multi-connection mode and can even connect to
more than one database at a time. A server framework, such as the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network
Server, can be used to manage multiple connections and handle network capabilities.
Some server framework solutions, such as WebSphere Application Server, provide
additional features such as web services and connection pooling. However,
only one server framework at a time can operate against a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application
accesses an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
through the JDBC API. To connect, an application makes a call to the local <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC driver. Accessing
the JDBC driver automatically starts the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software.
The calling application is responsible for shutting down the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database software. </div>
</div>
</div>
<div>
<a name="N1337A"></a><span></span>
<a name="N13383"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy855655"></a><span></span>Deploying Derby in an embedded environment</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can "embed" <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in any Java application (single- or
multi-user) by deploying the following package:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> library (<span style="font-style: italic;">derby.jar</span>)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>the application's libraries  
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You have the option of storing these
libraries in the database. (See <span style="color: blue;">
<a href="#cdevdeploy30736">Loading classes from a database</a>
</span>.)</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>the database or databases used by the application, in the context of their
system directory (see <span style="color: blue;">
<a href="#cdevdeploy18639">Embedded systems and properties</a>
</span>)  
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>Deploying an application, embedded Derby software,
and the database. Storing the application in the database and setting properties
as database-wide properties simplify deployment.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\edeploy_os.jpg">
</div>
<div></div>
</div>
</div>
</td></tr></table></div>
</div>
<div>
<a name="N13434"></a><span></span>
<a name="N1343D"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdeploy18639"></a><span></span>Embedded systems and properties</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Database-wide properties are stored in the database and are simpler for
deployment, while system-wide parameters might be easier for development.</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>If you are setting any system-wide properties, see if they can be set
as database-wide properties instead.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Are any properties being set in the <span style="font-style: italic;">derby.properties</span> file? Some
properties can only be set on a system-wide basis. If so, deploy the entire
system directory along with the properties file. Deploy only those databases
that you wish to include. Setting properties programmatically can simplify
this step- you will not have to worry about deploying the system directory/properties
file.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Before deploying your application, read <span style="color: blue;">
<a href="#cdevdvlp19297">Recommended practices</a>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Extra steps are required for deploying an application and an embedded database
on read-only media. See <span style="color: blue;">
<a href="#cdevdeploy15325">Creating Derby databases for read-only use</a>
</span>.</div>
</div>
</div>
</div>
</div>
<div>
<a name="N13491"></a><span></span>
<a name="N1349A"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdeploy15325"></a><span></span>Creating Derby databases for read-only use</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can create <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases for use on read-only media such as
CD-ROMs.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases in zip or jar files are also read-only databases.
Typically, read-only databases are deployed with an application in an embedded
environment.</div>
</div>
<div>
<a name="N1354F"></a><span></span>
<a name="N13558"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="tdevdeploy26887"></a><span></span>Creating and preparing the database for read-only use</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N13577"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To create databases for use on read-only media:</div>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Create and populate the database on read-write media.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Commit all transactions and shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
the prescribed manner (see <span style="color: blue;">
<a href="#tdevdvlp40464">Shutting down Derby or an individual database</a>
</span>).
If you do not shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
the prescribed manner, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will
need to perform recovery the next time the system boots. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> cannot
perform recovery on read-only media.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>3. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Delete the <span style="font-style: italic;">tmp</span> directory if one was created within your
database directory. If you include this directory, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will
attempt to delete it and will return errors when attempting to boot a database
on read-only media.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>4. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">For the read-only database, set the property <span style="font-style: italic;">derby.storage.tempDirectory</span> to
a writable location.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> needs
to write to temporary files for large sorts required by such SQL statements
as ORDER BY, UNION, DISTINCT, and GROUP BY. For more information about this
property, see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.storage.tempDirectory=c:/temp/mytemp</div></pre>
</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>5. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Configure the database to send error messages to a writable file
or to an output stream.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information, see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.stream.error.file=c:/temp/mylog.LOG</div></pre>
</div>
</div>
</td></tr></table></div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1361A"></a><span></span>Be sure to set these properties so that they are deployed
with the database.  For more information, see <span style="color: blue;">
<a href="#cdevdeploy18639">Embedded systems and properties</a>
</span>.</div>
</div>
</div>
<div>
<a name="N1367C"></a><span></span>
<a name="N13685"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="tdevdeploy19136"></a><span></span>Deploying the database on the read-only media</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N136A4"></a><span></span>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Move the database directory to the read-only media, including the necessary
subdirectory directories (<span style="font-style: italic;">log</span> and <span style="font-style: italic;">seg0</span>) and the file <span style="font-family: Courier;">
<span style="font-style: italic;">service.properties</span>
</span>.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Use the database as usual, except that you will not be able to insert
or update any data in the database or create or drop dictionary objects.</span>
</div>
</td></tr></table></div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N136D4"></a><span></span>
</div>
</div>
</div>
<div>
<a name="N1372D"></a><span></span>
<a name="N13736"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="tdevdeploy33704"></a><span></span>Transferring read-only databases to archive (jar or zip) files</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1376E"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once a database has been created in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, it can be stored in a
jar or zip file and continue to be accessed by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in read-only mode.
This allows a read-only database to be distributed as a single file instead
of as multiple files within a directory and to be compressed. In fact, a jar
or zip file can contain any number of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases and can also contain
other information not related to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, such as application data or
code.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You cannot store the <span style="font-style: italic;">derby.properties</span> file in a
jar or zip file.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">To create a jar or zip file containing one or more <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Follow the instructions for creating a database for use on read-only media.
See <span style="color: blue;">
<a href="#tdevdeploy26887">Creating and preparing the database for read-only use</a>
</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>From the directory that contains the database folder, archive the database
directory and its contents. For example, for the database<span style="font-style: italic;"> sales</span> that lives in the system directory<span style="font-style: italic;"> C:\london</span>, issue the command from <span style="font-style: italic;">london</span>. Do not issue
the command from inside the database directory itself.</div>
</td></tr></table></div>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, archive the database folder and its contents using the JAR
program from the JDK. You can use any zip or jar tool to generate the archive.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This command archives the database directory <span style="font-style: italic;">sales</span> and
its contents into a compressed jar file called <span style="font-style: italic;">dbs.jar</span>.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">cd C:\london
jar cMf C:\dbs.jar sales</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can add multiple databases with jar. For example, this command puts
the <span style="font-style: italic;">sales</span> databases and the <span style="font-style: italic;">boiledfood</span> database (in the subdirectory products) into the archive.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">cd C:\london
jar cMf C:\dbs.jar sales products\boiledfood</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The relative paths of the database in the jar need not match their original
relative paths. You can do this by allowing your archive tool to change the
path, or by moving the original databases before archiving them.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The archive can be compressed or uncompressed, or individual databases
can be uncompressed or compressed if your archive tool allows it. Compressed
databases take up a smaller amount of space on disk, depending on the data
loaded, but are slower to access.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once the database is archived into the jar or zip file, it has no relationship
to the original database. The original database can continue to be modified
if desired.</div>
</div>
</div>
</div>
<div>
<a name="N13864"></a><span></span>
<a name="N1386D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy11201"></a><span></span>Accessing a read-only database in a zip/jar file</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To access a database in a zip/jar, you specify the jar in the subsubprotocol:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:jar:(<span style="font-style: italic;">pathToArchive</span>)<span style="font-style: italic;">databasePathWithinArchive</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-style: italic;">pathToArchive</span> is the absolute path to the archive
file. The <span style="font-style: italic;">databasePathWithinArchive</span> is the relative
path to the database within the archive. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:jar:(C:/dbs.jar)products/boiledfood
jdbc:derby:jar:(C:/dbs.jar)sales</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you have trouble finding a database within an archive, check the contents
of the archive using your archive tool. The <span style="font-style: italic;">databasePathWithinArchive</span> must match the one in the archive. You might find that the path in the
archive has a leading slash, and thus the URL would be:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:jar:(C:/dbs.jar)/products/boiledfood</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Databases in a jar or zip file are always opened read-only and there is
currently no support to allow updates of any type.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Databases in a jar or zip file are not booted automatically when <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
started, unless they are explicitly listed as <span style="font-style: italic;">derby.service</span> properties.</div>
</div>
</div>
<div>
<a name="N13935"></a><span></span>
<a name="N1393E"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="tdevdeploy39856"></a><span></span>Accessing databases within a jar file using the classpath</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N13962"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once an archive containing one or more <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
has been created it can be placed in the classpath. This allows access to
a database from within an application without the application's knowing the
path of the archive. When jar or zip files are part of the classpath, you
do not have to specify the jar subsubprotocol to connect to them.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To
access a database in a zip or jar file in the classpath:</div>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Set the classpath to include the jar or zip file before starting
up <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>:</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CLASSPATH="C:\dbs.jar;%CLASSPATH%"</div></pre>
</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Connect to a database within the jar or zip file with one of the
following connection URLs:</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">Standard syntax:</span>
jdbc:derby:/<span style="font-style: italic;">databasePathWithinArchive</span>
</div></pre>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">Syntax with subsubprotocol:</span>
jdbc:derby:classpath:/<span style="font-style: italic;">databasePathWithinArchive</span>
</div></pre>
</div>
</div>
</td></tr></table></div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N139C0"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:/products/boiledfood
jdbc:derby:classpath:/products/boiledfood</div></pre>
</div>
</div>
<div>
<a name="N13A43"></a><span></span>
<a name="N13A4C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdeploy18716"></a><span></span>Connecting to databases with ambiguous paths to databases in the file
system</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Use the basic connection URL syntax only if the database path specified does not
also point to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database in the file system. If this is the case,
the connection attempt might fail or connect to the wrong database. Use the
form of the syntax with the subsubprotocol to distinguish between the databases.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:classpath:/products/boiledfood</div></pre>
</div>
</div>
<div>
<a name="N13AA2"></a><span></span>
<a name="N13AAB"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdeploy856333"></a><span></span>Connecting to databases when the path is ambiguous because of databases
in the classpath</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To connect to a database in the file system when the connection URL that you would
use would be ambiguous with a database in the classpath, use the following
form of the connection URL:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:directory:<span style="font-style: italic;">databasePathInFileSystem</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example,</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:directory:/products/boiledfood</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Apart from the connection URL, databases in archives in the classpath behave just
like databases in archives accessed through the file system. However, databases
in archives are read-only.</div>
</div>
</div>
</div>
<div>
<a name="N13B0B"></a><span></span>
<a name="N13B14"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy82529"></a><span></span>Databases on read-only media and DatabaseMetaData</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Databases on read-only media return true for <span style="font-style: italic;">DatabaseMetaData.isReadOnly</span>.</div>
</div>
</div>
</div>
<div>
<a name="N13B81"></a><span></span>
<a name="N13B8A"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdeploy30736"></a><span></span>Loading classes from a database</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can store application logic in a database and then load classes from
the database. Application logic, which can be used by SQL functions and procedures,
includes Java class files and other resources. Storing application code simplifies
application deployment, since it reduces the potential for problems with a
user's classpath.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded environment, when application logic is stored in the database, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can access classes loaded
by the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> class loader
from stored jar files. </div>
</div>
<div>
<a name="N13C59"></a><span></span>
<a name="N13C62"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy856753"></a><span></span>Class loading overview</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You store application classes and resources by storing one or more jar
files in the database. Then your application can access classes loaded by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> from
the jar file and does not need to be coded in a particular way. The only difference
is the way in which you invoke the application.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here are the basic steps:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="color: blue;">
<a href="#cdevdeploy15818">Create jar files for your application</a>
</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="color: blue;">
<a href="#cdevdeploy23812">Add the jar file or files to the database</a>
</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>3. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="color: blue;">
<a href="#cdevdeploy21645">Enable database class loading with a property</a>
</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>4. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="color: blue;">
<a href="#cdevdeploy12748">Code your applications</a>
</span>
</div>
</td></tr></table></div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If you are interested in making changes to jar files stored
in the database or changing the database jar "classpath" of your
application without having to re-boot, read <span style="color: blue;">
<a href="#cdevdeploy17604">Dynamic changes to jar files or to the database jar classpath</a>
</span>.</div>
</div>
<div>
<a name="N13D1F"></a><span></span>
<a name="N13D28"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdeploy92419"></a><span></span>Signed jar files</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information about how <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> handles signed jar files, see <span style="color: blue;">
<a href="#cdevcsecure90988">Signed jar files</a>
</span>
</div>
</div>
</div>
</div>
<div>
<a name="N13D6D"></a><span></span>
<a name="N13D76"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy15818"></a><span></span>Create jar files for your application</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Include any Java classes in a jar file intended for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> class loading
except:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>the standard Java packages (<span style="font-style: italic;">java.*</span>, <span style="font-family: Courier;">
<span style="font-style: italic;">javax.*</span>
</span>)  
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not prevent you from storing such
a jar file in the database, but these classes <span style="font-style: italic;">are never
loaded</span> from the jar file.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>those supplied with your Java environment (for example, <span style="font-style: italic;">sun.*</span>)</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A running <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system can load classes from any number of jar files
from any number of schemas and databases.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Create jar files intended for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database class loading the same
way you create a jar file for inclusion in a user's classpath. For example,
consider an application targeted at travel agencies: </div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">jar cf travelagent.jar travelagent/*.class.</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Various IDEs have tools to generate a list of contents for a jar file based
on your application. If your application requires classes from other jar files,
you have a choice:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Extract the required third-party classes from their
jar file and include only those in your jar file.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Best if you need
only a small subset of the classes in the third-party jar file.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Store the third-party jar file in the database.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Best if you need most or all of the classes in the third-party jar file, since
your application and third-party logic can be upgraded separately.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Deploy the third-party jar file in the user's class
path.</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Best if the classes are often already installed on a user's
machine (for example, Objectspace's JGL classes).</div>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Include the class files and resources needed for your application.</div>
</div>
</div>
<div>
<a name="N13E6F"></a><span></span>
<a name="N13E78"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy23812"></a><span></span>Add the jar file or files to the database</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Use a set of procedures to install, replace, and remove jar files in a
database. When you install a jar file in a database, you give it a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar
name, which is an <span style="font-family: Courier;">
<span style="font-style: italic;">SQL92Identifier</span>
</span>. </div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Once a jar file has been installed, you cannot modify any
of the individual classes or resources within the jar file. Instead, you must
replace the entire jar file.</div>
</div>
<div>
<a name="N13F18"></a><span></span>
<a name="N13F21"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevdeploy856948"></a><span></span>Jar file examples</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N13F2E"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Tools and Utilities Guide</span>
</span>
</span> for reference information about
the utility and complete syntax.</div>
</div>
</div>
<div>
<a name="N13F85"></a><span></span>
<a name="N13F8E"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevdeploy856845"></a><span></span>Installing jar files: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N13F9B"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-weight: bold;">-- SQL  statement</span>
CALL sqlj.install_jar(
    'tours.jar', 'APP.Sample1', 0)

<span style="font-weight: bold;">-- SQL  statement
-- using a quoted identifier for the 
-- <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>  jar name</span>
CALL sqlj.install_jar(
    'tours.jar', 'APP."Sample2"', 0)</span>
</div></pre>
</div>
</div>
</div>
<div>
<a name="N13FE8"></a><span></span>
<a name="N13FF1"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevdeploy856880"></a><span></span>Removing jar files: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N13FFE"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-weight: bold;">-- SQL  statement</span>
CALL sqlj.remove_jar(
    'APP.Sample1', 0)</span>
</div></pre>
</div>
</div>
</div>
<div>
<a name="N1403F"></a><span></span>
<a name="N14048"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevdeploy856912"></a><span></span>Replacing jar files: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N14055"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-weight: bold;">-- SQL  statement</span>
CALL sqlj.replace_jar(
    'c:\myjarfiles\newtours.jar', 'APP.Sample1')</span>
</div></pre>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N14096"></a><span></span>
<a name="N1409F"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy21645"></a><span></span>Enable database class loading with a property</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once you have added one or more jar files to a database, you must set the
database jar "classpath" by including the jar file or files in the <span style="font-style: italic;">derby.database.classpath</span> property to enable <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
load classes from the jar files. This property, which behaves like a class
path, specifies the jar files to be searched for classes and resources and
the order in which they are searched. If <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not find a needed
class stored in the database, it can retrieve the class from the user's
classpath. (<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> first looks in the user's classpath before looking
in the database.)</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Separate jar files with a colon (:).</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Use two-part names for the jar files (schema name and jar name). Set the
property as a database-level property for the database. The <span style="font-style: italic;">first time</span> you set the property, you must reboot to load the classes.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.classpath',
    'APP.ToursLogic:APP.ACCOUNTINGLOGIC')</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See <span style="font-style: italic;">"derby.database.classpath"</span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span> for more information about the property.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s class loader looks first in the user's
classpath for any needed classes, and then in the database. To ensure class
loading with the database class loader, remove classes from the classpath.</div>
</div>
</div>
<div>
<a name="N14164"></a><span></span>
<a name="N1416D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy12748"></a><span></span>Code your applications</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In your applications, you cause classes to be loaded the way you normally
would:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Indirectly referencing them in the code</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Directly using <span style="font-style: italic;">java.lang.Class.forName</span>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In your applications, you load resources the way you normally would, using
the standard <span style="font-style: italic;">java.lang.Class.getResourceAsStream</span>,
a mechanism that allows an application to access resources defined in the
classpath without knowing where or how they are stored.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You do not need to make any changes to the way code interacts with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and
its JDBC driver. An application can safely attempt to boot <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, even
though it is already running, without any errors. Applications connect to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
the usual manner.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The method <span style="font-style: italic;">getResource</span> is not supported.</div>
</div>
</div>
<div>
<a name="N14214"></a><span></span>
<a name="N1421D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevdeploy17604"></a><span></span>Dynamic changes to jar files or to the database jar classpath</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you store jar files in a single database and make those jar files
available to that database, it is possible to make changes to jar files or
to change the database jar "classpath" dynamically (without having
to reboot).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">That is, when you install or replace a jar file within an SQL statement
or change the database jar "classpath" (the <span style="font-style: italic;">derby.database.classpath</span> property<span style="font-family: Courier;">
<span style="font-style: italic;">),</span>
</span>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is able to
load the new classes right away without your having to reboot.</div>
</div>
<div>
<a name="N142BD"></a><span></span>
<a name="N142C6"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdeploy857611"></a><span></span>Requirements for dynamic changes</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Certain conditions must be met for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to be able to load the new
classes right away without you having to reboot:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>You <span style="font-style: italic;">originally configured</span> database-level class
loading for the database correctly. Turning on the database-level class loading
property requires setting the <span style="font-family: Courier;">
<span style="font-style: italic;">derby.database.classpath</span>
</span> property with valid two-part names, then rebooting.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>If changes to the <span style="font-style: italic;">derby.database.classpath</span> property
are needed to reflect new jar files, you change the property to a valid value.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If these requirements are not met, you will have to reboot to see the changes.</div>
</div>
</div>
<div>
<a name="N14328"></a><span></span>
<a name="N14331"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevdeploy857648"></a><span></span>Notes</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you are changing the <span style="font-style: italic;">derby.database.classpath</span> property,
all classes loaded from database jar files are reloaded, even for a jar file
that has not changed.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Remember that the user's classpath is searched first.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Any existing prepared statements will use the previously loaded classes
unless they require class loading, in which case they will fail with a <span style="font-style: italic;">ClassNotFound</span> error.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cached objects do not match objects created with newly loaded classes.
For example, an in-memory <span style="font-style: italic;">Customer</span> object will not
match a new <span style="font-family: Courier;">
<span style="font-style: italic;">Customer</span>
</span> object if the <span style="font-family: Courier;">
<span style="font-style: italic;">Customer</span>
</span> class has been reloaded, and it will raise
a <span style="font-family: Courier;">
<span style="font-style: italic;">ClassCastException.</span>
</span>
</div>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N143A2"></a><span></span>
<a name="N143AB"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevspecial"></a><span></span>Derby server-side programming</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses special programming for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These features include such programming as database-side JDBC procedures
and triggers.</div>
</div>
<div>
<a name="N143EA"></a><span></span>
<a name="N143F3"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevspecial42117"></a><span></span>Programming database-side JDBC procedures</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Methods invoked within an application are called application-side
methods. Methods invoked within <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> are
called database-side procedures.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An application-side method can be exactly the same as a database-side procedure.
The only difference is where you invoke them. You write the method only once.
Where you invoke the method-within the application or within an SQL statement-determines
whether it is an "application-side" or a "database-side" method. </div>
</div>
<div>
<a name="N14477"></a><span></span>
<a name="N14480"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial29620"></a><span></span>Database-side JDBC procedures and nested connections</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Most database-side JDBC Procedures need to share the same transaction space
as the statements that called them for the following reasons:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>to avoid blocking and deadlocks</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>to ensure that any updates done from within the method are atomic with
the outer transaction</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In order to use the same transaction, the procedure must use the same connection
as the parent SQL statement in which the method was executed. Connections
re-used in this way are called <span style="font-style: italic;">nested connections</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Use the connection URL <span style="font-style: italic;">jdbc:default:connection</span> to re-use the current <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The Database Connection URL jdbc:default:connection allows a Java method
to get the <span style="font-style: italic;">Connection</span> of the SQL statement that called it. This is
the standard (SQL standard, Part 13 SQL Routines and Java) mechanism to obtain
the nested connection object. The method would get a <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:default:connection");</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Loading a JDBC driver in a database-side routine is not required.</div>
</div>
<div>
<a name="N14552"></a><span></span>
<a name="N1455B"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevspecial28907"></a><span></span>Requirements for database-side JDBC procedures using nested connections</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">In order to preserve transactional atomicity, database-side JDBC procedures
that use nested connections: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>cannot issue a commit or rollback, unless called within a CALL statement.
  </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>cannot change connection attributes such as auto-commit.  </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>cannot modify the data in a table used by the parent statement that called
the procedure, using INSERT, UPDATE, or DELETE. For example, if a SELECT statement
using the <span style="font-style: italic;">T</span> table calls the <span style="font-family: Courier;">
<span style="font-style: italic;">changeTables</span>
</span> procedure, <span style="font-family: Courier;">
<span style="font-style: italic;">changeTables</span>
</span> cannot
modify data in the <span style="font-family: Courier;">
<span style="font-style: italic;">T</span> table.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>cannot drop a table used by the statement that called the procedure.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>cannot be in a class whose static initializer executes DDL statements.</div>
</td></tr></table></div>In addition, the Connection object that represents the nested connection
always has its auto-commit mode set to false.</div>
</div>
</div>
</div>
<div>
<a name="N145D5"></a><span></span>
<a name="N145DE"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial16181"></a><span></span>Database-side JDBC procedures using non-nested connections</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A database-side JDBC procedure can create a new connection instead of using
a nested connection. Statements executed in the procedure will be part of
a different transaction, and so can issue commits and rollbacks.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Such procedures can connect to a database different from the one to which
the parent SQL statement that called it is connected. The procedure
does not use the same transaction or <span style="font-style: italic;">Connection</span>. It
establishes a new <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> and transaction.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If database-side JDBC procedures do not use nested connections,
this means that they are operating outside of the normal DBMS transaction
control, so it is not good practice to use them indiscriminately.</div>
</div>
<div>
<a name="N14669"></a><span></span>
<a name="N14672"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevspecial847513"></a><span></span>Invoking a procedure using the CALL command</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a procedure uses only IN parameters, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
execute the procedure by using the SQL CALL command. A stored procedure with
IN, OUT, or INOUT parameters can be invoked from a client application by using
the CallableStatement method. You can invoke the procedure in an SQL statement
such as the following:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CALL MYPROC()</span>
</div></pre>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  You cannot roll back this statement, because commits occur within the
procedure itself. Procedures that use nested connections, on the other hand,
are not permitted to commit or roll back and can therefore be rolled back
after the calling statement.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also use the CALL command to execute a procedure that does return
a value, but you will not be able to access the value.</div>
</div>
</div>
</div>
<div>
<a name="N146C4"></a><span></span>
<a name="N146CD"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial41728"></a><span></span>Database-side JDBC procedures and SQLExceptions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It is possible to code database-side procedures, like application-side
methods, to catch <span style="font-style: italic;">SQLExceptions</span>. <span style="font-family: Courier;">
<span style="font-style: italic;">SQLExceptions</span>
</span> that are caught within a procedure are hidden from
the calling application code. When such <span style="font-family: Courier;">
<span style="font-style: italic;">SQLExceptions</span>
</span> are of transaction severity (such as deadlocks), this "hiding"
of the exception causes unexpected problems.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This is because errors of transaction severity roll back work already done
by a transaction (not just the piece executed by the called method) and silently
begin a new transaction. When the method execution is complete, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> detects
that the outer statement was invalidated by a deadlock and rolls back any
work done<span style="font-style: italic;"> in the new transaction</span> as well. This is
the expected behavior, because all the statements in between explicit commits
should be treated atomically; the new transaction implicitly begun by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
rollback was not intended by the application designer.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, this is not the same behavior that would happen if the method
were invoked in the application. In that situation, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> would roll
back the work done by the transaction and silently begin a new transaction.
Work in the new transaction would not be rolled back when the method returned.
However, coding the application in that way means that the transaction did
not end where you expected it to and is probably a programming mistake. Coding
in this manner is not recommended.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A method that catches a deadlock exception and then continues is probably
making a mistake. Errors of transaction severity should be caught not by nested
code, but only by the outermost application code. That is the only way to
ensure that transactions begin and end where you expect them to.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Not all database vendors handle nested deadlocks the same way. For this
and other reasons, it is not possible to write portable SQL-invoking methods.
However, it is possible to write SQL-invoking methods that behave identically <span style="font-style: italic;">regardless of whether you invoke them in the application or
as a procedure in the database</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In order to ensure identical application- and database-side handling of
nested errors, code try-catch blocks to check for the severity of exceptions
as follows:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">try {
    preparedStatement.execute();
} catch (SQLException se ) {
        String SQLState = se.getSQLState();
    if ( SQLState.equals( "23505" ) ) 
        { correctDuplicateKey(); }
    else if ( SQLState.equals( "22003" ) ) {    
        correctArithmeticOverflow(); }
    else { throw se; }
}</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Of course, users also have the choice of not wrapping SQL statements in
try-catch blocks within methods. In that case, <span style="font-style: italic;">SQLExceptions</span> are caught higher up in their applications, which is the desired behavior.</div>
</div>
</div>
<div>
<a name="N14798"></a><span></span>
<a name="N147A1"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial45786"></a><span></span>User-defined SQLExceptions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When the execution of a database-side method raises an error, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> wraps
that exception in an <span style="font-style: italic;">SQLException</span> with an <span style="font-family: Courier;">
<span style="font-style: italic;">SQLState</span>
</span> of
38000. You can avoid having <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> wrap
the exception if:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The exception is an <span style="font-style: italic;">SQLException</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The range of the <span style="font-style: italic;">SQLState</span> is 38001-38999</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">(This conforms to the SQL99 standard.)</div>
</div>
</div>
</div>
<div>
<a name="N1483A"></a><span></span>
<a name="N14843"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevspecial27163"></a><span></span>Programming trigger actions</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows you to create triggers. When you create a trigger, you
define an action or set of actions that are executed when a database event
occurs on a specified table. A <span style="font-style: italic;">database event</span> is a
delete, insert, or update operation. For example, if you define a trigger
for a delete on a particular table, the trigger action is executed whenever
someone deletes a row or rows from the table.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-family: Courier;">CREATE TRIGGER</span> statement in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span> goes
into detail of the complete <span style="font-family: Courier;">CREATE TRIGGER</span> syntax. This section
provides information on defining the trigger action itself, which is only
one aspect of creating triggers.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section refers to the <span style="font-family: Courier;">CREATE TRIGGER</span> statement as the <span style="font-style: italic;">trigger actions</span>.</div>
</div>
<div>
<a name="N14908"></a><span></span>
<a name="N14911"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial53165"></a><span></span>Trigger action overview</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A trigger action is a simple SQL statement. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CREATE TRIGGER . . .
DELETE FROM flightavailability 
	WHERE flight_id IN (SELECT flight_id FROM flightavailability 
		WHERE YEAR(flight_date) &lt; 2005);) 
</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A trigger action does have some limitations, though; for example, it cannot
contain dynamic parameters or alter the table on which the trigger is defined.
See "TriggerAction" in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span> for details. </div>
</div>
</div>
<div>
<a name="N14970"></a><span></span>
<a name="N14979"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial76763"></a><span></span>Performing referential actions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides referential actions. Examples in this section are included
to illustrate how to write triggers. You can choose to use standard SQL referential
integrity to obtain this functionality, rather than writing triggers. See
the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span> for more information on referential integrity.</div>
</div>
</div>
<div>
<a name="N149D8"></a><span></span>
<a name="N149E1"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial67260"></a><span></span>Accessing before and after rows</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Many trigger actions need to access the values of the rows being changed.
Such trigger actions need to know one or both of the following:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>the "before" values of the rows being changed (their values before
the database event that caused the trigger to fire)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>the "after" values of the rows being changed (the values to which
the database event is setting them)</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides transition variables and transition tables for a trigger
action to access these values. See"Referencing Old and New Values: The
Referencing Clause" in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N14A3F"></a><span></span>
<a name="N14A48"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial13670"></a><span></span>Examples</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N14A67"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following trigger action copies a row from the <span style="font-style: italic;">flights</span> table into the <span style="font-style: italic;">flight_history</span> table whenever
any row gets inserted into <span style="font-style: italic;">flights</span> and adds the comment "inserted
from trig1" in the <span style="font-style: italic;">status</span> column of the<span style="font-style: italic;">flight_history</span> table.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N14A8E"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CREATE TRIGGER trig1 
AFTER UPDATE ON flights 
REFERENCING OLD AS UPDATEDROW 
FOR EACH ROW MODE DB2SQL 
INSERT INTO flights_history 
VALUES (UPDATEDROW.FLIGHT_ID, UPDATEDROW.SEGMENT_NUMBER,
UPDATEDROW.ORIG_AIRPORT, UPDATEDROW.DEPART_TIME,
UPDATED ROW.DEST_AIRPORT, UPDATEDROW.ARRIVE_TIME,
UPDATEDROW.MEAL, UPDATEDROW.FLYING_TIME, UPDATEDROW.MILES,
UPDATEDROW.AIRCRAFT,'INSERTED FROM trig1');</span>
</div></pre>
</div>
</div>
</div>
<div>
<a name="N14AB0"></a><span></span>
<a name="N14AB9"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevspecial49460"></a><span></span>Triggers and exceptions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Exceptions raised by triggers have a statement severity; they roll
back the statement that caused the trigger to fire.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This rule applies to nested triggers (triggers that are fired by other
triggers). If a trigger action raises an exception (and it is not caught),
the transaction on the current connection is rolled back to the point before
the triggering event. For example, suppose Trigger A causes Trigger B to fire.
If Trigger B throws an exception, the current connection is rolled back to
the point before to the statement in Trigger A that caused Trigger B to fire.
Trigger A is then free to catch the exception thrown by Trigger B and continue
with its work. If Trigger A does not throw an exception, the statement that
caused Trigger A, as well as any work done in Trigger A, continues until the
transaction in the current connection is either committed or rolled back.
However, if Trigger A does not catch the exception from Trigger B, it is as
if Trigger A had thrown the exception. In that case, the statement that caused
Trigger A to fire is rolled back, along with any work done by both of the
triggers.</div>
</div>
<div>
<a name="N14B12"></a><span></span>
<a name="N14B1B"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevspecial93497"></a><span></span>Aborting statements and transactions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You might want a trigger action to be able to abort the triggering statement
or even the entire transaction. Triggers that use the current connection are
not permitted to commit or roll back the connection, so how do you do that?
The answer is: have the trigger throw an exception, which is by default a
statement-level exception (which rolls back the statement). The application-side
code that contains the statement that caused the trigger to fire can then
roll back the entire connection if desired. Programming triggers in this respect
is no different from programming any database-side JDBC method.</div>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N14B41"></a><span></span>
<a name="N14B4A"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevconcepts19524"></a><span></span>Controlling Derby application behavior</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section looks at some advanced <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application concepts.</div>
</div>
<div>
<a name="N14BC5"></a><span></span>
<a name="N14BCE"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevconcepts38375"></a><span></span>The JDBC Connection and Transaction Model</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Session and transaction capabilities for SQL are handled through JDBC procedures,
not by SQL commands.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC defines a system session and transaction model for database access.
A <span style="font-style: italic;">session</span> is the duration of one connection to the
database and is handled by a JDBC <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> object.</div>
</div>
<div>
<a name="N14C88"></a><span></span>
<a name="N14C91"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts36881"></a><span></span>Connections</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="font-style: italic;">Connection</span> object represents a connection with
a database. Within the scope of one <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>,
you access only a single <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database. (Database-side JDBC procedures
can allow you to access more than one database in some circumstances.) A single application might allow one
or more <span style="font-family: Courier;">
<span style="font-style: italic;">Connections</span>
</span> to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, either
to a single database or to many different databases, provided that all the
databases are within the same system (see <span style="color: blue;">
<a href="#cdevdvlp27610">Derby system</a>
</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">With DriverManager, you use the connection URL as an argument to get the <span style="font-family: Courier;">
<span style="font-style: italic;">getConnection</span>
</span> method to specify which database to
connect to and other details (see <span style="color: blue;">
<a href="#cdevdvlp17453">Derby JDBC database connection URL</a>
</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following example shows an application establishing three separate
connections to two different databases in the current system.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:sample");
System.out.println("Connected to database sample");
conn.setAutoCommit(false);
Connection conn2 = DriverManager.getConnection(
    "jdbc:derby:newDB;create=true");
System.out.println("Created AND connected to newDB");
conn2.setAutoCommit(false);
Connection conn3 = DriverManager.getConnection(
    "jdbc:derby:newDB");
System.out.println("Got second connection to newDB");
conn3.setAutoCommit(false);</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="font-style: italic;">Connection</span> object has no association with any
specific thread; during its lifetime, any number of threads might have access
to it, as controlled by the application.</div>
</div>
<div>
<a name="N14D6C"></a><span></span>
<a name="N14D75"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts838179"></a><span></span>Statements</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To execute SQL statements against a database, an application uses <span style="font-style: italic;">Statements</span> (<span style="font-family: Courier;">
<span style="font-style: italic;">java.sql.Statement</span>
</span>) and <span style="font-style: italic;">PreparedStatements</span> (<span style="font-family: Courier;">
<span style="font-style: italic;">java.sql.PreparedStatement</span>
</span>), or <span style="font-style: italic;">CallableStatements</span> (<span style="font-family: Courier;">
<span style="font-style: italic;">java.sql.CallableStatement</span>
</span>) for stored procedures. Because <span style="font-style: italic;">PreparedStatement</span> extends <span style="font-style: italic;">Statement</span> and <span style="font-style: italic;">CallableStatement</span> extends<span style="font-style: italic;"> PreparedStatement</span>, this section refers to both as <span style="font-style: italic;">Statements</span>. <span style="font-style: italic;">Statements</span> are obtained from and
are associated with a particular <span style="font-style: italic;">Connection</span>.</div>
</div>
</div>
<div>
<a name="N14E21"></a><span></span>
<a name="N14E2A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts838315"></a><span></span>ResultSets and Cursors</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Executing a <span style="font-style: italic;">Statement</span> that returns values gives
a <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> (<span style="font-family: Courier;">
<span style="font-style: italic;">java.sql.ResultSet</span>
</span>), allowing the application to obtain the results of the statement.
Only one <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> can be open for a particular <span style="font-family: Courier;">
<span style="font-style: italic;">Statement</span>
</span> at any time, as per the JDBC specification.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Thus, executing a <span style="font-style: italic;">Statement</span> automatically closes
any open <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> generated by an earlier
execution of that <span style="font-family: Courier;">
<span style="font-style: italic;">Statement</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For this reason, you must use a different <span style="font-style: italic;">Statement</span> to update a cursor (a named <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span>)
from the one used to generate the cursor. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The names of open cursors must be unique within a <span style="font-style: italic;">Connection</span>. For more information about how to use cursors and <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSets</span>
</span>, see <span style="color: blue;">
<a href="#cdevconcepts41275">SQL and JDBC ResultSet/Cursor mechanisms</a>
</span>.</div>
</div>
</div>
<div>
<a name="N14EFB"></a><span></span>
<a name="N14F04"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts26633"></a><span></span>Nested connections</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">SQL statements can include routine invocations. If these routines
interact with the database, they must use a <span style="font-style: italic;">Connection</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see <span style="color: blue;">
<a href="#cdevspecial42117">Programming database-side JDBC procedures</a>
</span>.</div>
</div>
</div>
</div>
<div>
<a name="N14F69"></a><span></span>
<a name="N14F72"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts19173"></a><span></span>Transactions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="font-style: italic;">transaction</span> is a set of one or more SQL statements
that make up a logical unit of work that you can either commit or roll back
and that will be recovered in the event of a system failure. All the statements
in the transaction are <span style="font-style: italic;">atomic</span>. A transaction is associated
with a single <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> object (and database).
A transaction cannot span <span style="font-style: italic;">Connections</span> (or databases).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> permits schema and data manipulation statements (DML) to be
intermixed within a single transaction. If you create a table in one transaction,
you can also insert into it in that same transaction. A schema manipulation
statement (DDL) is not automatically committed when it is performed, but participates
in the transaction within which it is issued. Because DDL requires exclusive
locks on system tables, keep transactions that involve DDL short.</div>
</div>
<div>
<a name="N15023"></a><span></span>
<a name="N1502C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts838850"></a><span></span>Transactions when auto-commit is disabled</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When auto-commit is disabled (see <span style="color: blue;">
<a href="#cdevconcepts29416">Using auto-commit</a>
</span>),
you use a <span style="font-style: italic;">Connection</span> object's <span style="font-family: Courier;">
<span style="font-style: italic;">commit</span>
</span> and <span style="font-family: Courier;">
<span style="font-style: italic;">rollback</span>
</span> methods
to commit or roll back a transaction. The <span style="font-family: Courier;">
<span style="font-style: italic;">commit</span>
</span> method
makes permanent the changes resulting from the transaction and releases locks.
The <span style="font-family: Courier;">
<span style="font-style: italic;">rollback</span>
</span> method undoes all the changes
resulting from the transaction and releases locks. A transaction encompasses
all the SQL statements executed against a single <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> object since the last <span style="font-family: Courier;">
<span style="font-style: italic;">commit</span>
</span> or <span style="font-family: Courier;">
<span style="font-style: italic;">rollback</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You do not need to explicitly begin a transaction. You implicitly end one
transaction and begin a new one after disabling auto-commit, changing the
isolation level, or after calling <span style="font-family: Courier;">
<span style="font-style: italic;">commit</span>
</span> or <span style="font-family: Courier;">
<span style="font-style: italic;">rollback</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Committing a transaction also closes all <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> objects excluding the <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> objects
associated with cursors with holdability <span style="font-family: Courier;">true</span>. The default holdability
of the cursors is <span style="font-family: Courier;">true</span> and <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> objects
associated with them need to be closed explicitly. A commit will not close
such <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> objects. (See <span style="color: blue;">
<a href="#rdevconceptsholdablecursors">Holdable cursors</a>
</span> for more information.) It also releases any database locks
currently held by the <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>, whether
or not these objects were created in different threads.</div>
</div>
</div>
<div>
<a name="N15150"></a><span></span>
<a name="N15159"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts29416"></a><span></span>Using auto-commit</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A new connection to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
is in auto-commit mode by default, as specified by the JDBC standard. Auto-commit
mode means that when a statement is completed, the method <span style="font-style: italic;">commit</span> is
called on that statement automatically. Auto-commit in effect makes every
SQL statement a transaction. The commit occurs when the statement completes
or the next statement is executed, whichever comes first. In the case of a
statement returning a <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span>, the statement completes
when the last row of the <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> has been retrieved
or the <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> has been closed explicitly.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some applications might prefer to work with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
auto-commit mode; some might prefer to work with auto-commit turned off. You
should be aware of the implications of using either model.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You should be aware of the following when you use auto-commit:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Cursors</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You cannot use auto-commit if you do any positioned
updates or deletes (that is, an update or delete statement with a "WHERE CURRENT
OF" clause) on cursors which have the <span style="font-style: italic;">close cursors on commit</span> option
set.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Auto-commit automatically closes cursors, which are explicitly
opened with the <span style="font-style: italic;">close on commit</span> option, when you do any in-place updates
or deletes. For more information about cursors, see <span style="color: blue;">
<a href="#cdevconcepts41275">SQL and JDBC ResultSet/Cursor mechanisms</a>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A
cursor declared to be held across commit can execute updates and issue multiple
commits before closing the cursor, but the cursor must be repositioned before
any statement following the commit. If this is attempted with auto-commit
on, an error is generated. </div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Database-side JDBC Procedures (procedures using nested connections)</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You cannot execute procedures within SQL statements if those procedures
perform a commit or rollback on the current connection. Since in the auto-commit
mode all SQL statements are implicitly committed, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> turns
off auto-commit during execution of database-side procedures and turns it
back on when the method completes.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Procedures that use nested connections
are not permitted to turn auto-commit on or off or to commit or roll back.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Table-level locking and the SERIALIZABLE isolation level</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When
an application uses table-level locking and the SERIALIZABLE isolation level,
all statements that access tables hold at least shared table locks. Shared
locks prevent other transactions that update data from accessing the table.
A transaction holds a lock on a table until the transaction commits. <span style="font-style: italic;">So
even a SELECT statement holds a shared lock on a table until its connection
commits and a new transaction begins. </span>
</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Summary of Application Behavior with Auto-Commit On or Off</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">



<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Topic</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Auto-Commit On</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Auto-Commit Off</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Transactions</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Each statement is a separate transaction.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Commit() or rollback() begins a transaction.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Database-side JDBC procedures (routines using nested connections)</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Auto-commit is turned off.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Works (no explicit commits or rollbacks are allowed).</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Updatable cursors</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Does not work.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Works.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Multiple connections accessing the same data</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Works.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Works. Lower concurrency when applications use SERIALIZABLE
isolation mode and table-level locking.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Updatable ResultSets</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Works.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Works. Not required by the JDBC program.</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N15313"></a><span></span>
<a name="N1531C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevconcepts839040"></a><span></span>Turning Off Auto-Commit</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15345"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can disable auto-commit with the <span style="font-style: italic;">Connection</span> class's <span style="font-style: italic;">setAutoCommit</span> method:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">conn.setAutoCommit(false);</div></pre>
</div>
</div>
</div>
<div>
<a name="N153A8"></a><span></span>
<a name="N153B1"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts839085"></a><span></span>Explicitly closing Statements, ResultSets, and Connections</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You should explicitly close <span style="font-style: italic;">Statements</span>, <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSets,</span>
</span> and <span style="font-family: Courier;">
<span style="font-style: italic;">Connections</span>
</span> when you no longer need them. Connections to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> are resources
external to an application, and the garbage collector will not close them
automatically. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, close a <span style="font-style: italic;">Statement</span> object using its <span style="font-family: Courier;">
<span style="font-style: italic;">close</span>
</span> method; close a <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> object using its <span style="font-family: Courier;">
<span style="font-style: italic;">close</span>
</span> method.
If auto-commit is disabled, active transactions need to be explicitly committed
or rolled back before closing the connection</div>
</div>
</div>
<div>
<a name="N15461"></a><span></span>
<a name="N1546A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts14433"></a><span></span>Statement versus transaction runtime rollback</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When an SQL statement generates an exception, this exception results
in a <span style="font-style: italic;">runtime rollback</span>. A runtime rollback is a system-generated
rollback of a statement or transaction by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, as opposed to an explicit <span style="font-family: Courier;">
<span style="font-style: italic;">rollback</span>
</span> call from your application.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Extremely severe exceptions, such as disk-full errors, shut down the system,
and the transaction is rolled back when the database is next booted. Severe
exceptions, such as deadlock, cause transaction rollback; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> rolls
back all changes since the beginning of the transaction and implicitly begins
a new transaction. Less severe exceptions, such as syntax errors, result in
statement rollback; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> rolls back only changes made by the statement
that caused the error. The application developer can insert code to explicitly
roll back the entire transaction if desired.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports partial rollback through the use of savepoints. See the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span> for more information.</div>
</div>
</div>
</div>
</div>
<div>
<a name="N15515"></a><span></span>
<a name="N1551E"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevconcepts41275"></a><span></span>SQL and JDBC ResultSet/Cursor mechanisms</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A cursor provides you with the ability to step through and process the
rows in a <span style="font-style: italic;">ResultSet</span> one by one. A <span style="font-family: Courier;">
<span style="font-style: italic;">java.sql.ResultSet</span>
</span> object constitutes a cursor. You do not need
to use a language construct, such as SQL-92's DECLARE CURSOR, to work
with cursors in a Java application. In <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, any SELECT statement generates
a cursor.</div>
</div>
<div>
<a name="N1560A"></a><span></span>
<a name="N15613"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevconcepts88082"></a><span></span>Simple non-updatable ResultSets</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15620"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here is an excerpt from a sample JDBC application that generates
a <span style="font-style: italic;">ResultSet</span> with a simple SELECT statement and then processes the rows.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1562F"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:sample");
Statement s = conn.createStatement();
s.execute("set schema 'SAMP'");
<span style="font-weight: bold;">//note that autocommit is on--it is on by default in JDBC</span>
ResultSet rs = s.executeQuery(
    "SELECT empno, firstnme, lastname, salary, bonus, comm "
				 + "FROM samp.employee");
<span style="font-weight: bold;">/** a standard JDBC ResultSet. It maintains a 
  *  cursor that points to the current row of data. The cursor 
  *  moves down one row each time the method next() is called.
  *  You can scroll one way only--forward--with the next()
  *  method. When auto-commit is on, after you reach the 
  *  last row the statement is considered completed
  *  and the transaction is committed.
  */</span>
System.out.println( "last name" + "," + "first name" + ": earnings");
<span style="font-weight: bold;">/* here we are scrolling through the result set 
with the next() method.*/</span>
while (rs.next()) {
<span style="font-weight: bold;">    // processing the rows</span>
    String firstnme = rs.getString("FIRSTNME");
    String lastName = rs.getString("LASTNAME");
    BigDecimal salary = rs.getBigDecimal("SALARY");
    BigDecimal bonus = rs.getBigDecimal("BONUS");
    BigDecimal comm = rs.getBigDecimal("COMM"); 
    System.out.println( lastName + ", " + firstnme + ": " 
                       + (salary.add(bonus.add(comm))));
}
rs.close();
<span style="font-weight: bold;">// once we've iterated through the last row,
// the transaction commits automatically and releases
//shared locks</span>
s.close();</div></pre>
</div>
</div>
</div>
<div>
<a name="N1569F"></a><span></span>
<a name="N156A8"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts28351"></a><span></span>Updatable cursors</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cursors are read-only by default. For a cursor to be updatable, you must
specify SELECT . . . FOR UPDATE. Use FOR UPDATE only when you will be modifying
rows to avoid excessive locking of tables.</div>
</div>
<div>
<a name="N1572E"></a><span></span>
<a name="N15737"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts30811"></a><span></span>Requirements for updatable cursors</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Only specific SELECT statements- simple accesses of a single
table-allow you to update or delete rows as you step through them.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see "SELECT statement" and "FOR UPDATE clause" in
the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N157A6"></a><span></span>
<a name="N157AF"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="tdevconcepts41704"></a><span></span>Naming or accessing the name of a cursor</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N157D8"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There is no SQL language command to <span style="font-style: italic;">assign</span> a name to a
cursor. You can use the JDBC <span style="font-family: Courier;">
<span style="font-style: italic;">setCursorName</span>
</span> method
to assign a name to a <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> that allows positioned
updates and deletes. You assign a name to a <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> with
the <span style="font-family: Courier;">
<span style="font-style: italic;">setCursorName</span>
</span> method of the <span style="font-family: Courier;">
<span style="font-style: italic;">Statement</span>
</span> interface.
You assign the name to a cursor before executing the <span style="font-family: Courier;">
<span style="font-style: italic;">Statement</span>
</span> that
will generate it.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Statement s3 = conn.createStatement();
// name the statement so we can reference the result set
// it generates
s3.setCursorName("UPDATABLESTATEMENT");
// we will be able to use the following statement later
// to access the current row of the cursor
// a result set needs to be obtained prior to using the
// WHERE CURRENT syntax
ResultSet rs = s3.executeQuery("select * from 
    FlightBookings FOR UPDATE of number_seats");
PreparedStatement ps2 = conn.prepareStatement(
    "UPDATE FlightBookings SET number_seats = ? " +
       "WHERE CURRENT OF UPDATABLESTATEMENT");</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, you
do not assign a name to the cursor, but let the system generate one for you
automatically. You can determine the system-generated cursor name of a <span style="font-style: italic;">ResultSet</span> generated
by a SELECT statement using the <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span> class's <span style="font-family: Courier;">
<span style="font-style: italic;">getCursorName</span>
</span> method.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">PreparedStatement ps2 = conn.prepareStatement(
    "UPDATE employee SET bonus = ? WHERE CURRENT OF "+
        Updatable.getCursorName());</div></pre>
</div>
</div>
</div>
<div>
<a name="N1587C"></a><span></span>
<a name="N15885"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevconcepts38274"></a><span></span>Extended updatable cursor example</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15892"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">String URL = "jdbc:derby:sample";
<span style="font-weight: bold;">// autocommit must be turned off for updatable cursors</span>
conn.setAutoCommit(false);
Statement s3 = conn.createStatement();
<span style="font-weight: bold;">// name the statement so we can reference the result set
// it generates</span>
s3.setCursorName("UPDATABLESTATEMENT");
<span style="font-weight: bold;">// Updatable statements have some requirements</span>
<span style="font-weight: bold;">// for example, select must be on a single table</span>
ResultSet Updatable = s3.executeQuery(
    "SELECT firstnme, lastname, workdept, bonus" +
    "FROM employee FOR UPDATE of bonus");
<span style="font-weight: bold;">// we need a separate statement to do the</span>
<span style="font-weight: bold;">// update PreparedStatement</span>
PreparedStatement ps2 = conn.prepareStatement("UPDATE employee " +
<span style="font-weight: bold;">// we could use the cursor name known by the system,</span>
<span style="font-weight: bold;">// as the following line shows</span>
<span style="font-weight: bold;">//"SET bonus = ? WHERE CURRENT OF " + Updatable.getCursorName());</span>
<span style="font-weight: bold;">// but we already know the cursor name</span>
"SET bonus = ? WHERE CURRENT OF UPDATABLESTATEMENT"); 
String theDept="E21";
while (Updatable.next()) {
    String firstnme = Updatable.getString("FIRSTNME");
    String lastName = Updatable.getString("LASTNAME");
    String workDept = Updatable.getString("WORKDEPT");
    BigDecimal bonus = Updatable.getBigDecimal("BONUS");
    if (workDept.equals(theDept)) {
    <span style="font-weight: bold;">// if the current row meets our criteria,
    // update the updatable column in the row</span>
        ps2.setBigDecimal(1, bonus.add(new BigDecimal(250)));
        ps2.executeUpdate();
        System.out.println("Updating bonus in employee" +
        " table for employee " + firstnme +
        ", department " + theDept );
    } 
    }
Updatable.close();
s3.close();
ps2.close();
conn.commit();</div></pre>
</div>
</div>
</div>
</div>
<div>
<a name="N15907"></a><span></span>
<a name="N15910"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts23987"></a><span></span>ResultSets and auto-commit</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Except for the result sets associated with holdable cursors (see <span style="color: blue;">
<a href="#rdevconceptsholdablecursors">Holdable cursors</a>
</span> for
more information), issuing a commit will cause all result sets on your connection
to be closed.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The JDBC program is not required to have auto-commit off when using updatable
ResultSets.</div>
</div>
</div>
<div>
<a name="N15989"></a><span></span>
<a name="N15992"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts22641"></a><span></span>Scrolling insensitive ResultSets</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC 2.0 adds a new kind of <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span>,
one that allows you to scroll in either direction or to move the cursor to
a particular row. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> implements scrolling insensitive <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSets</span>
</span>. When you use a scroll insensitive <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSets</span>
</span> cursor to facilitate the insensitive scrolling action,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> materializes in memory all rows from the first one in the result set
up to the one with the biggest row number.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">//autocommit does not have to be off because even if 
//we accidentally scroll past the last row, the implicit commit
//on the the statement will not close the result set because result sets
//are held over commit by default</span>
conn.setAutoCommit(false);
Statement s4 = conn.createStatement(
ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);
s4.execute("set schema 'SAMP'");
ResultSet scroller=s4.executeQuery(
    "SELECT sales_person, region, sales FROM sales " +
    "WHERE sales &gt; 8 ORDER BY sales DESC");
if (scroller.first())
    System.out.println("The sales rep who sold the highest number
				of sales is " +
           scroller.getString("SALES_PERSON"));
else
    System.out.println("There are no rows.");
scroller.beforeFirst();
scroller.afterLast();
scroller.absolute(3);
if (!scroller.isAfterLast()) 
    System.out.println("The employee with the third highest number
				of sales is " +
           scroller.getString("SALES_PERSON") + ", with " +
           scroller.getInt("SALES") + " sales");
if (scroller.isLast())
    System.out.println("There are only three rows.");
if (scroller.last())
    System.out.println("The least highest number
				of sales of the top three sales is: " +
           scroller.getInt("SALES"));
scroller.close();
s4.close();
conn.commit()
conn.close();
System.out.println("Closed connection");</div></pre>
</div>
</div>
<div>
<a name="N15A42"></a><span></span>
<a name="N15A4B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevconceptsholdablecursors"></a><span></span>Holdable cursors</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15A6A"></a><span></span>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>   Non-holdable cursors are only available in Java 2 Platform,
Standard Edition, v 1.4 (J2SE) environments.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15A73"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The holdable cursor feature permits an application to keep cursors
open after implicit or explicit commits. By default, the cursors are held
open after a commit. Starting with Java 2 Platform, Standard
Edition, v 1.4 (J2SE), cursors can be created with close when a commit occurs
option. Such cursors will be automatically closed when a commit happens. Cursors
are automatically closed when a transaction aborts, whether or not they have
been specified to be held open.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15A7C"></a><span></span>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>   Holdable cursors do not work with XA transactions, in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
Version 10.1, therefore cursors should be opened with holdability false when
working with XA transactions.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15A8B"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify whether a cursor should be held open after a commit
takes place, supply one of the following <span style="font-style: italic;">ResultSet</span> parameters to the <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> method <span style="font-family: Courier;">
<span style="font-style: italic;">createStatement</span>
</span>, <span style="font-family: Courier;">
<span style="font-style: italic;">prepareStatement</span>
</span>, or <span style="font-family: Courier;">
<span style="font-style: italic;">prepareCall</span>
</span>:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15AC2"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="font-style: italic;">CLOSE_CURSORS_AT_COMMIT</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cursors are closed when an
implicit or explicit commit is performed.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">
<span style="font-style: italic;">HOLD_CURSORS_OVER_COMMIT</span>
</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cursors are held open when
a commit is performed, implicitly or explicitly. This is the default behavior.</div>
</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15AEE"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The method <span style="font-style: italic;">Statement.getResultSetHoldability()</span> indicates
whether a cursor generated by the Statement object stays open or closes, upon
commit. See the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span> for more information.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15B0B"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When an implicit or explicit commit occurs, <span style="font-style: italic;">ResultSets</span> that
hold cursors open behave as follows:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15B1A"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Open <span style="font-style: italic;">ResultSets</span> remain open. The cursor is positioned before the
next logical row of the result set.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>When the session is terminated, the <span style="font-style: italic;">ResultSet</span> is closed and destroyed.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>All locks are released, except locks protecting the current cursor position
of open cursors specified to stay open after commits.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Immediately following a commit, the only valid operations that can be
performed on the <span style="font-style: italic;">ResultSet</span> are:   <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>positioning the <span style="font-style: italic;">ResultSet</span> to the next valid row in the result with <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet.next()</span>
</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>closing the <span style="font-style: italic;">ResultSet</span> with <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet.close()</span>
</span>.</div>
</td></tr></table></div>
</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15B76"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a rollback occurs either explicitly or implicitly, the following
behavior applies:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15B7F"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>All open <span style="font-style: italic;">ResultSets</span> are closed.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>All locks acquired during the unit of work are released.</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N15BFE"></a><span></span>
<a name="N15C07"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts840995"></a><span></span>Holdable cursors and autocommit</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When autocommit is on, positioned updates and deletes are not supported
for <span style="font-style: italic;">ResultSet</span> objects that hold cursors open. If you
attempt an update or delete, an exception is thrown.</div>
</div>
</div>
<div>
<a name="N15C57"></a><span></span>
<a name="N15C60"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevconcepts1119"></a><span></span>Non-holdable cursor example</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15C6D"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following example uses <span style="font-style: italic;">Connection.createStatement</span> to return a <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSet</span>
</span>  that will
close after a commit is performed:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N15C86"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = ds.getConnection(user, passwd);
Statement stmt =
conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,
                  ResultSet.CONCUR_READ_ONLY,
                  ResultSet.CLOSE_CURSORS_AT_COMMIT);
</div></pre>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N15CB1"></a><span></span>
<a name="N15CBA"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevconcepts30291"></a><span></span>Locking, concurrency, and isolation</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section discusses topics pertinent to multi-user systems, in which
concurrency is important. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is configured by default to work well
for multi-user systems. For single-user systems, you might want to tune your
system so that it uses fewer resources; see <span style="color: blue;">
<a href="#cdevconcepts23810">Lock granularity</a>
</span>.</div>
</div>
<div>
<a name="N15D9E"></a><span></span>
<a name="N15DA7"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts15366"></a><span></span>Isolation levels and concurrency</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides four
transaction isolation levels. Setting the transaction isolation level for
a connection allows a user to specify how severely the user's transaction
should be isolated from other transactions. For example, it allows you to
specify whether transaction A is allowed to make changes to data that have
been viewed by transaction B before transaction B has committed.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A connection determines its own isolation level, so JDBC provides an application
with a way to specify a level of transaction isolation. It specifies four
levels of transaction isolation. The higher the transaction isolation, the
more care is taken to avoid conflicts; avoiding conflicts sometimes means
locking out transactions. Lower isolation levels thus allow greater concurrency.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Inserts, updates, and deletes always behave the same no matter what the
isolation level is. Only the behavior of select statements varies.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To set isolation levels you can use the JDBC <span style="font-style: italic;">Connection.setIsolationLevel</span> method
or the SQL SET ISOLATION statement. The names of the isolation levels are
different, depending on whether you use a JDBC method or SQL statement. <span style="color: blue;">
<a href="#cdevconcepts15366">Mapping of JDBC transaction isolation levels to Derby isolation levels</a>
</span> shows the equivalent
names for isolation levels whether they are set through the JDBC method or
an SQL statement.</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Mapping of JDBC transaction
isolation levels to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> isolation
levels</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">


<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Isolation levels for JDBC</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Isolation levels for SQL</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection.TRANSACTION_READ_ UNCOMMITTED (ANSI level
0)</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>UR, DIRTY READ, READ UNCOMMITTED </div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection.TRANSACTION_READ_COMMITTED (ANSI level
1) </div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>CS, CURSOR STABILITY, READ COMMITTED</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection.TRANSACTION_REPEATABLE_READ (ANSI level
2) </div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>RS</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection.TRANSACTION_SERIALIZABLE (ANSI level
3) </div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>RR, REPEATABLE READ, SERIALIZABLE </div>
</td>
</tr>
</tbody>
</table>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These levels allow you to avoid particular kinds of transaction anomalies,
which are described in <span style="color: blue;">
<a href="#cdevconcepts15366">Transaction Anomalies</a>
</span>.</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Transaction Anomalies</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">


<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top">
<div>Anomaly</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Example</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Dirty Reads <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A dirty read happens when a transaction
reads data that is being modified by another transaction that has not yet
committed.</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Transaction A begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">UPDATE employee SET salary = 31650
WHERE empno = '000090'</div></pre> Transaction B begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT * FROM employee</div></pre> (Transaction
B sees data updated by transaction A. Those updates have not yet been committed.)</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Non-Repeatable Reads <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Non-repeatable reads happen when
a query returns data that would be different if the query were repeated within
the same transaction. Non-repeatable reads can occur when other transactions
are modifying data that a transaction is reading.</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Transaction A begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT * FROM employee
WHERE empno = '000090' </div></pre> Transaction B begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">UPDATE employee SET salary = 30100
WHERE empno = '000090'</div></pre> (Transaction B updates rows viewed by transaction
A before transaction A commits.) If Transaction A issues the same SELECT statement,
the results will be different.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Phantom Reads <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Records that appear in a set being read
by another transaction. Phantom reads can occur when other transactions insert
rows that would satisfy the WHERE clause of another transaction's statement.</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Transaction A begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT * FROM employee
 WHERE salary &gt; 30000 </div></pre> Transaction B begins.  <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">INSERT INTO employee
(empno, firstnme, midinit,
lastname, job,
salary) VALUES ('000350', 'NICK',
'A','GREEN','LEGAL COUNSEL',35000)</div></pre> Transaction B inserts a row
that would satisfy the query in Transaction A if it were issued again.</div>
</td>
</tr>
</tbody>
</table>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The transaction isolation level is a way of specifying whether these transaction
anomalies are allowed. The transaction isolation level thus affects the quantity
of data locked by a particular transaction. In addition, a DBMS's locking
schema might also affect whether these anomalies are allowed. A DBMS can lock
either the entire table or only specific rows in order to prevent transaction
anomalies.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="color: blue;">
<a href="#cdevconcepts15366">When Transaction Anomalies Are Possible</a>
</span> shows which anomalies
are possible under the various locking schemas and isolation levels.</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>When Transaction Anomalies
Are Possible</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">



<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Isolation Level</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Table-Level Locking</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Row-Level Locking</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>TRANSACTION_READ_UNCOMMITTED</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Dirty reads, nonrepeatable reads, and phantom reads possible</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Dirty reads, nonrepeatable reads, and phantom reads possible</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>TRANSACTION_READ_COMMITTED</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Nonrepeatable reads and phantom reads possible</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Nonrepeatable reads and phantom reads possible</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>TRANSACTION_REPEATABLE_READ</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Phantom reads not possible because entire table is locked</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Phantom reads possible</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>TRANSACTION_SERIALIZABLE</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>None</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>None</div>
</td>
</tr>
</tbody>
</table>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following <span style="font-style: italic;">java.sql.Connection</span> isolation levels are supported:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-family: Courier;">TRANSACTION_SERIALIZABLE</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-family: Courier;">RR</span>, <span style="font-family: Courier;">SERIALIZABLE</span>,
or <span style="font-family: Courier;">REPEATABLE READ</span> from SQL.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">TRANSACTION_SERIALIZABLE</span> means
that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> treats the transactions
as if they occurred serially (one after the other) instead of concurrently. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues locks to prevent
all the transaction anomalies listed in <span style="color: blue;">
<a href="#cdevconcepts15366">Transaction Anomalies</a>
</span> from
occurring. The type of lock it issues is sometimes called a <span style="font-style: italic;">range lock</span>.
For more information about range locks, see <span style="color: blue;">
<a href="#rdevconcepts8424">Scope of locks</a>
</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-family: Courier;">TRANSACTION_REPEATABLE_READ</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-family: Courier;">RS</span> from
SQL.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">TRANSACTION_REPEATABLE_READ</span> means that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues
locks to prevent only dirty reads and non-repeatable reads, but not phantoms.
It does not issue range locks for selects.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-family: Courier;">TRANSACTION_READ_COMMITTED</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-family: Courier;">CS</span> or <span style="font-family: Courier;">CURSOR
STABILITY</span> from SQL.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> means
that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues locks
to prevent only dirty reads, not all the transaction anomalies listed in <span style="color: blue;">
<a href="#cdevconcepts15366">Transaction Anomalies</a>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> is
the default isolation level for transactions.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-family: Courier;">TRANSACTION_READ_UNCOMMITTED</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-family: Courier;">UR</span>, <span style="font-family: Courier;">DIRTY
READ</span>, or <span style="font-family: Courier;">READ UNCOMMITTED</span> from SQL.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For a
SELECT INTO, FETCH with a read-only cursor, full select used in an INSERT,
full select/subquery in an UPDATE/DELETE, or scalar full select (wherever
used), READ UNCOMMITTED allows:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Any row that is read during the unit of work to be changed by other application
processes.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Any row that was changed by another application process to be read even
if the change has not been committed by the application process.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For other operations, the rules that apply to READ COMMITTED also
apply to READ UNCOMMITTED.</div>
</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N16138"></a><span></span>
<a name="N16141"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts22300"></a><span></span>Configuring isolation levels</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a connection does not specify its isolation level, it inherits the default
isolation level for the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, The default value is <span style="font-family: Courier;">CS</span>.
When set to <span style="font-family: Courier;">CS</span>, the connection inherits the TRANSACTION_READ_COMMITTED
isolation level. When set to <span style="font-family: Courier;">RR</span>, the connection inherits the TRANSACTION_SERIALIZABLE
isolation level, when set to <span style="font-family: Courier;">RS</span>, the connection inherits the TRANSACTION_REPEATABLE_READ
isolation level, and when set to <span style="font-family: Courier;">UR</span>, the connection inherits the
TRANSACTION_READ_UNCOMMITTED isolation level.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To override the inherited default, use the methods of <span style="font-style: italic;">java.sql.Connection</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, a connection can change the isolation level of the transaction
within an SQL statement. For more information, see "SET ISOLATION
statement" in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>. You can use the WITH clause to
change the isolation level for the current statement only, not the transaction.
For information about the"WITH clause," see the "SELECT statement"in
the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> In all cases except when you change the isolation level using the WITH
clause, changing the isolation level commits the current transaction.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  For information about how to choose a particular isolation
level, see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N16215"></a><span></span>
<a name="N1621E"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts23810"></a><span></span>Lock granularity</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<a name="cdevconcepts18383"></a><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can be configured for <span style="font-style: italic;">table-level</span> locking. With table-level locking, when a transaction locks
data in order to prevent any transaction anomalies, it always locks the entire
table, not just those rows being accessed.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By default, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is configured for row-level locking. Row-level
locking uses more memory but allows greater concurrency, which works better
in multi-user systems. Table-level locking works best with single-user applications
or read-only applications. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You typically set lock granularity for the entire <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, not
for a particular application. However, at runtime, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> may escalate
the lock granularity for a particular transaction from row-level locking to
table-level locking for performance reasons. You have some control over the
threshold at which this occurs. For information on turning off row-level locking,
see <span style="font-style: italic;">"derby.storage.rowLocking" </span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>. For more information about automatic lock escalation, see "About
the System's Selection of Lock Granularity" and "Transaction-Based
Lock Escalation" in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>
<span style="font-style: italic;">. </span>For more information
on tuning your <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, see "Tuning Databases and Applications".</div>
</div>
</div>
<div>
<a name="N162E9"></a><span></span>
<a name="N162F2"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts36402"></a><span></span>Types and scope of locks in Derby systems</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There are several types of locks available in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> systems, including
exclusive, shared, and update locks.</div>
</div>
<div>
<a name="N163C1"></a><span></span>
<a name="N163CA"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts842279"></a><span></span>Exclusive locks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a statement modifies data, its transaction holds an <span style="font-style: italic;">exclusive</span> lock on data that prevents other transactions from accessing
the data. This lock remains in place until the transaction holding the lock
issues a commit or rollback. Table-level locking lowers concurrency in a multi-user
system.</div>
</div>
</div>
<div>
<a name="N16453"></a><span></span>
<a name="N1645C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts842304"></a><span></span>Shared locks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a statement reads data without making any modifications, its transaction
obtains a <span style="font-style: italic;">shared lock</span> on the data. Another transaction
that tries to read the same data is permitted to read, but a transaction that
tries to update the data will be prevented from doing so until the shared
lock is released. How long this shared lock is held depends on the isolation
level of the transaction holding the lock. Transactions using the TRANSACTION_READ_COMMITTED
isolation level release the lock when the transaction steps through to the
next row. Transactions using the TRANSACTION_SERIALIZABLE or TRANSACTION_REPEATABLE_READ
isolation level hold the lock until the transaction is committed, so even
a SELECT can prevent updates if a commit is never issued. Transactions using
the TRANSACTION_READ_UNCOMMITTED isolation level do not request any locks.</div>
</div>
</div>
<div>
<a name="N164C9"></a><span></span>
<a name="N164D2"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts842385"></a><span></span>Update locks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a user-defined update cursor (created with the FOR UPDATE clause)
reads data, its transaction obtains an <span style="font-style: italic;">update </span>lock
on the data. If the user-defined update cursor updates the data, the update
lock is converted to an exclusive lock. If the cursor does not update the
row, when the transaction steps through to the next row, transactions using
the TRANSACTION_READ_COMMITTED isolation level release the lock, and transactions
using the TRANSACTION_SERIALIZABLE or TRANSACTION_REPEATABLE_READ isolation
level downgrade it to a shared lock until the transaction is committed. (For
update locks, the TRANSACTION_READ_UNCOMMITTED isolation level acts the same
way as TRANSACTION_READ_COMMITTED.)</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Update locks help minimize deadlocks.</div>
</div>
</div>
<div>
<a name="N16551"></a><span></span>
<a name="N1655A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevconcepts2462"></a><span></span>Lock compatibility</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N16567"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="color: blue;">
<a href="#rdevconcepts2462">Lock Compatibility Matrix</a>
</span> lists compatibility between lock types. <span style="font-style: italic;">+</span> means compatible,  <span style="font-style: italic;">-</span> means incompatible.</div>
</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Lock Compatibility Matrix</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">




<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span>&nbsp;'</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Shared</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Update</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Exclusive</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Shared</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">+</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div>
</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Update</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">+</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div>
</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Exclusive</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div>
<a name="N1669D"></a><span></span>
<a name="N166A6"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevconcepts8424"></a><span></span>Scope of locks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N166C5"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The amount of data locked by a statement can vary. </div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N166CE"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">table locks</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A statement can lock the <span style="font-style: italic;">entire table</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Table-level locking systems always lock entire tables.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Row-level locking systems can lock entire tables if the WHERE clause
of a statement cannot use an index. For example, UPDATES that cannot use an
index lock the entire table.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Row-level locking systems can lock entire
tables if a high number of single-row locks would be less efficient than a
single table-level lock. Choosing table-level locking instead of row-level
locking for performance reasons is called <span style="font-style: italic;">lock escalation</span>. (For more information about this topic, see "About the System's
Selection of Lock Granularity" and "Transaction-Based Lock Escalation"
in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.)</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">single-row locks</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A statement can lock only <span style="font-style: italic;">a single row</span> at a time.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section applies only
to row-level locking systems. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For TRANSACTION_READ_COMMITTED or TRANSACTION_REPEATABLE_READ
isolation, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> treats rows as cursors for SELECT statements. It locks
rows only as the application steps through the rows in the result. The current
row is locked. The row lock is released when the application goes to the next
row. (For TRANSACTION_SERIALIZABLE isolation, however, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks the
whole set before the application begins stepping through.) For TRANSACTION_READ_UNCOMMITTED,
no row locks are requested.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks single rows for INSERT
statements, holding each row until the transaction is committed. (If there
is an index associated with the table, the previous key is also locked.)</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">range locks</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A statement can lock <span style="font-style: italic;">a range of rows</span> (range lock).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section applies only to row-level
locking systems. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For <span style="font-style: italic;">any</span> isolation level, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks <span style="font-style: italic;">all the rows in the result</span> plus an entire range of rows
for updates or deletes.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For the TRANSACTION_SERIALIZABLE isolation level, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks
all the rows in the result plus an entire range of rows in the table for SELECTs
to prevent nonrepeatable reads and phantoms.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, if a SELECT
statement specifies rows in the <span style="font-style: italic;">Employee</span> table where
the <span style="font-style: italic;">salary</span> is BETWEEN two values, the system can lock
more than just the actual rows it returns in the result. It also must lock
the entire <span style="font-style: italic;">range</span> of rows between those two values
to prevent another transaction from inserting, deleting, or updating a row
within that range.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An index must be available for a range lock. If one
is not available, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks the entire table.</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Possible Types and Scopes of Locking</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">



<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Transaction Isolation Level</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Table-Level Locking</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Row-Level Locking</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection. TRANSACTION_ READ_UNCOMMITED (SQL: UR)</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>For SELECT statements, table-level locking is never requested
using this isolation level. For other statements, same as for TRANSACTION_
READ_ COMMITTED.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>SELECT statements get no locks. For other statements, same
as for TRANSACTION_ READ_COMMITTED.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection. TRANSACTION_ READ_COMMITTED (SQL: CS) </div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>SELECT statements get a shared lock on the entire table.
The locks are released when the user closes the <span style="font-style: italic;">ResultSet</span>. Other statements get exclusive locks on the entire table, which are
released when the transaction commits.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>SELECTs lock and release single rows as the user steps
through the <span style="font-style: italic;">ResultSet</span>. UPDATEs and DELETEs get exclusive
locks on a range of rows. INSERT statements get exclusive locks on single
rows (and sometimes on the preceding rows).</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection. TRANSACTION_ REPEATABLE_READ (SQL: RS)</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Same as for TRANSACTION_ SERIALIZABLE</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>SELECT statements get shared locks on the rows that satisfy
the WHERE clause (but do not prevent inserts into this range). UPDATEs and
DELETEs get exclusive locks on a range of rows. INSERT statements get exclusive
locks on single rows (and sometimes on the preceding rows).</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Connection. TRANSACTION_ SERIALIZABLE (SQL: RR)</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>SELECT statements get a shared lock on the entire table.
Other statements get exclusive locks on the entire table, which are released
when the transaction commits.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>SELECT statements get shared locks on a range of rows.
UPDATE and DELETE statements get exclusive locks on a range of rows. INSERT
statements get exclusive locks on single rows (and sometimes on the preceding
rows).</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N168A2"></a><span></span>
<a name="N168AB"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts842613"></a><span></span>Notes on locking</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition to the locks already described, foreign key lookups require
briefly held shared locks on the referenced table (row or table, depending
on the configuration).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The table and examples in this section do not take performance-based lock
escalation into account. Remember that the system can choose table-level locking
for performance reasons.</div>
</div>
</div>
</div>
<div>
<a name="N16917"></a><span></span>
<a name="N16920"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts28436"></a><span></span>Deadlocks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a database, a deadlock is a situation in which two or more transactions
are waiting for one another to give up locks.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, Transaction A might hold a lock on some rows in the <span style="font-style: italic;">Accounts</span> table and needs to update some rows in the <span style="font-style: italic;">Orders</span> table to finish. Transaction B holds locks on those very rows
in the <span style="font-style: italic;">Orders</span> table but needs to update the rows in
the <span style="font-style: italic;">Accounts</span> table held by Transaction A. Transaction
A cannot complete its transaction because of the lock on <span style="font-style: italic;">Orders</span>. Transaction B cannot complete its transaction because of the
lock on <span style="font-style: italic;">Accounts</span>. All activity comes to a halt and
remains at a standstill forever unless the DBMS detects the deadlock and aborts
one of the transactions.</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>A deadlock.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\dead.jpg">
</div>
<div></div>
</div>
</div>
<div>
<a name="N16A1D"></a><span></span>
<a name="N16A26"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts53677"></a><span></span>Avoiding Deadlocks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Using both row-level locking and the TRANSACTION_READ_COMMITTED isolation
level makes it likely that you will avoid deadlocks (both settings are <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> defaults).
However, deadlocks are still possible. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application developers
can avoid deadlocks by using consistent application logic; for example, transactions
that access <span style="font-style: italic;">Accounts</span> and <span style="font-style: italic;">Orders</span> should always access the tables in the same order. That way, in the
scenario described above, Transaction B simply waits for transaction A to
release the lock on <span style="font-style: italic;">Orders</span> before it begins. When
transaction A releases the lock on <span style="font-style: italic;">Orders</span>, Transaction
B can proceed freely.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Another tool available to you is the LOCK TABLE statement. A transaction
can attempt to lock a table in exclusive mode when it starts to prevent other
transactions from getting shared locks on a table. For more information, see "LOCK
TABLE statement" in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N16AC4"></a><span></span>
<a name="N16ACD"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts95005"></a><span></span>Deadlock detection</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a transaction waits more than a specific amount of time to obtain
a lock (called the deadlock timeout), <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can detect whether the transaction
is involved in a deadlock. When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> analyzes such a situation for
deadlocks it tries to determine how many transactions are involved in the
deadlock (two or more). Usually aborting one transaction breaks the deadlock. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> must
pick one transaction as the victim and abort that transaction; it picks the
transaction that holds the fewest number of locks as the victim, on the assumption
that transaction has performed the least amount of work. (This may not be
the case, however; the transaction might have recently been escalated from
row-level locking to table locking and thus hold a small number of locks even
though it has done the most work.) </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> aborts the victim transaction, it receives a deadlock
error (an <span style="font-style: italic;">SQLException</span> with an <span style="font-family: Courier;">
<span style="font-style: italic;">SQLState</span>
</span> of 40001). The error message gives you the transaction
IDs, the statements, and the status of locks involved in a deadlock situation.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ERROR 40001: A lock could not be obtained due to a deadlock,
cycle of locks &amp; waiters is:
Lock : ROW, DEPARTMENT, (1,14)
Waiting XID : {752, X} , APP, update department set location='Boise'
	where deptno='E21'
Granted XID : {758, X} Lock : ROW, EMPLOYEE, (2,8)
Waiting XID : {758, U} , APP, update employee set bonus=150 where salary=23840
Granted XID : {752, X} The selected victim is XID : 752</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information on configuring when deadlock checking occurs, see <span style="color: blue;">
<a href="#cdevconcepts16400">Configuring deadlock detection and lock wait timeouts</a>
</span>.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Deadlocks are detected only within a single database. Deadlocks
across multiple databases are not detected. Non-database deadlocks caused
by Java synchronization primitives are not detected by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
</div>
</div>
<div>
<a name="N16B8C"></a><span></span>
<a name="N16B95"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts89097"></a><span></span>Lock wait timeouts</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Even if a transaction is not involved in a deadlock, it might have to wait
a considerable amount of time to obtain a lock because of a long-running transaction
or transactions holding locks on the tables it needs. In such a situation,
you might not want a transaction to wait indefinitely. Instead, you might
want the waiting transaction to abort, or <span style="font-style: italic;">time out</span>,
after a reasonable amount of time, called a <span style="font-style: italic;">lock wait timeout</span>. (For information about configuring the lock wait timeout, see <span style="color: blue;">
<a href="#cdevconcepts16400">Configuring deadlock detection and lock wait timeouts</a>
</span>.)</div>
</div>
</div>
<div>
<a name="N16C10"></a><span></span>
<a name="N16C19"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts16400"></a><span></span>Configuring deadlock detection and lock wait timeouts</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You configure the amount of time a transaction waits before <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
any deadlock checking with the <span style="font-style: italic;">derby.locks.deadlockTimeout</span> property. You configure the amount of time a transaction waits before
timing out with the <span style="font-family: Courier;">
<span style="font-style: italic;">derby.locks.waitTimeout</span>
</span> property.
When configuring your database or system, you should consider these properties
together. For example, in order for any deadlock checking to occur, the <span style="font-family: Courier;">
<span style="font-style: italic;">derby.locks.deadlockTimeout</span>
</span> property must be set
to a value lower than the <span style="font-family: Courier;">
<span style="font-style: italic;">derby.locks.waitTimeout</span>
</span> property. If it is set to a value equal to or higher than the <span style="font-family: Courier;">
<span style="font-style: italic;">derby.locks.waitTimeout</span>
</span>, the transaction times out
before <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does any deadlock checking.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By
default, <span style="font-style: italic;">derby.locks.waitTimeout</span> is set to 60 seconds.
-1 is the equivalent of no wait timeout. This means that transactions never
time out, although <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can choose a transaction as a deadlock victim.</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>One possible configuration: deadlock
checking occurs when a transaction has waited 30 seconds; no lock wait timeouts
occur.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\lockwa3.jpg">
</div>
<div></div>
</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>Another typical configuration:
deadlock checking occurs after a transaction has waited 60 seconds for a lock;
after 90 seconds, the transaction times out and is rolled back. </div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\lockwa1.jpg">
</div>
<div></div>
</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>A configuration in which no deadlock
checking occurs: transactions time out after they have waited 50 seconds.
No deadlock checking occurs. </div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\lockwa2.jpg">
</div>
<div></div>
</div>
</div>
</div>
<div>
<a name="N16D17"></a><span></span>
<a name="N16D20"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts50894"></a><span></span>Debugging Deadlocks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If deadlocks occur frequently in your multi-user system with a particular
application, you might need to do some debugging. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides a class
to help you in this situation, <span style="font-style: italic;">org.apache.derby.diag.LockTable</span>. You can also set the property <span style="font-style: italic;">derby.locks.deadlockTrace</span> to dump additional information to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.log file about any deadlocks
that occur on your system. See the Tuning Guide for more information on this
property. For information, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Server and Administration Guide</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N16DAD"></a><span></span>
<a name="N16DB6"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevconcepts32861"></a><span></span>Programming applications to handle deadlocks</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you configure your system for deadlock and lockwait timeouts and an
application could be chosen as a victim when the transaction times out, you
should program your application to handle this. To do this, test for <span style="font-style: italic;">SQLExceptions</span> with <span style="font-family: Courier;">
<span style="font-style: italic;">SQLStates</span>
</span> of
40001 (deadlock timeout) or 40XL1 or 40XL2 (lockwait timeout).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In the case of a deadlock you might want to re-try the transaction that
was chosen as a victim. In the case of a lock wait timeout, you probably do
not want to do this right away.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following code is one example of how to handle a deadlock timeout.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">/// if this code might encounter a deadlock, 
// put the whole thing in a try/catch block
// then try again if the deadlock victim exception 
// was thrown</span>
try {
    s6.executeUpdate(
         "UPDATE employee " +
         "SET bonus = 625 "
         "WHERE empno='000150'");
    s6.executeUpdate("UPDATE project " +
         "SET respemp = '000150' " +
         "WHERE projno='IF1000'");
} 
<span style="font-weight: bold;">// note: do not catch such exceptions in database-side methods; 
// catch such exceptions only at the outermost level of 
// application code. 
// See <span style="color: blue;">
<a href="#cdevspecial41728">Database-side JDBC procedures and SQLExceptions</a>
</span>. </span> 
catch (SQLException se) { 
    if (se.getSQLState().equals("40001")) { 
        <span style="font-weight: bold;">// it was chosen as a victim of a deadlock. 
        // try again at least once at this point.</span> 
        System.out.println( "Will try the transaction again."); 
        s6.executeUpdate("UPDATE employee " + 
        "SET bonus = 625 " + 
        "WHERE empno='000150'"); 
        s6.executeUpdate("UPDATE project " + 
        "SET respemp = 000150 " + 
        "WHERE projno='IF1000'"); 
    } 
    else throw se; 
}
</div></pre>
</div>
</div>
</div>
</div>
<div>
<a name="N16E67"></a><span></span>
<a name="N16E70"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevconcepts34828"></a><span></span>Working with multiple connections to a single database</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section discusses deploying <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> so
that many connections can exist to a single database.</div>
</div>
<div>
<a name="N16F28"></a><span></span>
<a name="N16F31"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevconcepts713"></a><span></span>Deployment options and threading and connection modes</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N16F64"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A database can be available to multiple connections in the following
situations:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N16F6D"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Multiple applications access a single database (possible only when <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is running inside a server
framework).</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>A single application has more than one <span style="font-style: italic;">Connection</span> to the same database.
  <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The way you deploy <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> affects
the ways applications can use multi-threading and connections, as shown in <span style="color: blue;">
<a href="#rdevconcepts713">Threading and Connection Modes</a>
</span>.</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Threading and Connection Modes</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">



<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top">
<div>Connection mode</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Embedded</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Server</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">Multi-Threaded</span>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">From an application, using
a <span style="font-style: italic;">single</span>
<span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
and issuing requests against that connection in multiple threads.</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Supply a single <span style="font-style: italic;">Connection</span> object to separate threads. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> ensures that only one
operation is applied at a time for consistency. Server frameworks automatically
manage multi-threaded operations. For more information, see <span style="color: blue;">
<a href="#cdevconcepts19173">Transactions</a>
</span>.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Server frameworks can automatically multi-thread operations.
Remote client applications can multi-thread if desired.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">Multi-Connection</span>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">From an application, using
multiple connections to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
and issuing requests against those connections on multiple threads.</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Create individual connections within a single application
and use the appropriate connection for each JDBC request. The connections
can all be to the same database, or can be to different databases in the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Remote client applications can establish the multiple connections
desired.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">Multi-User</span>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Multiple applications (or JVMs)
accessing the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database.
Each user application has its own connection or connections to the database.</div>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Not possible. Only one application can access a database
at a time, and only one application can access a specific system at a time.
When using a pre-1.4 JVM, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> might
not prevent multiple applications from concurrently accessing the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, but do not allow
this because such access can corrupt the databases involved.</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Only one server should access a database at a time. Multiple
remote client applications can access the same server, and thus can access
the same database at the same time through that server.</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N170C5"></a><span></span>
<a name="N170CE"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts10914"></a><span></span>Multi-user database access</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Multi-user database access is possible if <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is running inside
a server framework.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If more than one client application tries to modify the same data, the
connection that gets the table first gets the lock on the data (either specific
rows or the entire table). The second connection has to wait until the first
connection commits or rolls back the transaction in order to access the data.
If two connections are only querying and not modifying data, they can both
access the same data at the same time because they can each get a shared lock.
For more information, see <span style="color: blue;">
<a href="#cdevconcepts30291">Locking, concurrency, and isolation</a>
</span>.</div>
</div>
</div>
<div>
<a name="N17133"></a><span></span>
<a name="N1713C"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts24019"></a><span></span>Multiple connections from a single application</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A single application can work with multiple <span style="font-style: italic;">Connections</span> to the same database and assign them to different threads. The application
programmer can avoid concurrency and deadlock problems in several ways:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Use the <span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> isolation level
and turn on row-level locking (the defaults).</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Beware of deadlocks caused by using more than one <span style="font-style: italic;">Connection</span> in a single thread (the most obvious case). For example, if
the thread tries to update the same table from two different <span style="font-family: Courier;">
<span style="font-style: italic;">Connections</span>
</span>, a deadlock can occur.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Assign <span style="font-style: italic;">Connections</span> to threads that handle discrete
tasks. For example, do not have two threads update the <span style="font-style: italic;">Hotels</span> table. Have one thread update the <span style="font-style: italic;">Hotels</span> table
and a different one update the <span style="font-style: italic;">Groups</span> table.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>If threads access the same tables, commit transactions often.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Multi-threaded Java applications have the ability to self-deadlock without
even accessing a database, so beware of that too.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Use nested connections to share the same lock space.</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N171D2"></a><span></span>
<a name="N171DB"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevconcepts23499"></a><span></span>Working with multiple threads sharing a single connection</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC allows you to share a single <span style="font-style: italic;">Connection</span> among
multiple threads.</div>
</div>
<div>
<a name="N1728E"></a><span></span>
<a name="N17297"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts89498"></a><span></span>Pitfalls of sharing a connection among threads</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here is a review of the potential pitfalls of sharing a single <span style="font-style: italic;">Connection</span> among multiple threads:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Committing or rolling back a transaction closes all open <span style="font-style: italic;">ResultSet</span> objects and currently executing <span style="font-style: italic;">Statements</span>, unless you are using held cursors.
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If one thread commits, it closes
the <span style="font-style: italic;">Statements</span> and <span style="font-style: italic;">ResultSets</span> of
all other threads using the same connection.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Executing a <span style="font-style: italic;">Statement</span> automatically closes any
existing open <span style="font-style: italic;">ResultSet</span> generated by an earlier execution
of that <span style="font-style: italic;">Statement</span>.
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If threads share <span style="font-style: italic;">Statements</span>, one thread could close another's <span style="font-style: italic;">ResultSet.</span>
</div>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In many cases, it is easier to assign each thread to a distinct <span style="font-style: italic;">Connection</span>. If thread <span style="font-style: italic;">A</span> does database work that
is not transactionally related to thread <span style="font-style: italic;">B</span>, assign
them to different <span style="font-style: italic;">Connections</span>. For example, if thread <span style="font-style: italic;">A</span> is associated with a user input window that allows users
to delete hotels and thread <span style="font-style: italic;">B</span> is associated with a
user window that allows users to view city information, assign those threads
to different <span style="font-style: italic;">Connections</span>. That way, when thread <span style="font-style: italic;">A</span> commits, it does not affect any <span style="font-style: italic;">ResultSets</span> or <span style="font-style: italic;">Statements</span> of thread B.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Another strategy is to have one thread do queries and another thread do
updates. Queries hold shared locks until the transaction commits in SERIALIZABLE
isolation mode; use READ_COMMITTED instead.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Yet another strategy is to have only one thread do database access. Have
other threads get information from the database access thread.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Multiple threads are permitted to share a <span style="font-style: italic;">Connection</span>, <span style="font-style: italic;">Statement</span>, or <span style="font-style: italic;">ResultSet</span>. However, the application programmer must ensure that one thread does
not affect the behavior of the others.</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1735E"></a><span></span>
<div style="font-weight: bold;">Recommended Practices</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here are some tips for avoiding unexpected behavior:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Avoid sharing <span style="font-style: italic;">Statements</span> (and their <span style="font-family: Courier;">
<span style="font-style: italic;">ResultSets</span>
</span>) among threads.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Each time a thread executes a<span style="font-style: italic;"> Statement</span>, it should
process the results before relinquishing the <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Each time a thread accesses the <span style="font-style: italic;">Connection</span>, it
should consistently commit or not, depending on application protocol.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Have one thread be the "managing" database <span style="font-style: italic;">Connection</span> thread that should handle the higher-level tasks, such as
establishing the <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>, committing,
rolling back, changing <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span> properties
such as auto-commit, closing the <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>,
shutting down the database (in an embedded environment), and so on.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Close <span style="font-style: italic;">ResultSets</span> and <span style="font-family: Courier;">
<span style="font-style: italic;">Statements</span>
</span> that are no longer needed in order to release resources.</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N17411"></a><span></span>
<a name="N1741A"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts65864"></a><span></span>Multi-thread programming tips</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some programmers might share a <span style="font-style: italic;">Connection</span> among multiple threads
because they have experienced poor concurrency using separate transactions.
Here are some tips for increasing concurrency:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Use row-level locking.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Use the <span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> isolation level.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Avoid queries that cannot use indexes; they require locking of all the
rows in the table (if only very briefly) and might block an update.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, some programmers might share a statement among multiple threads
to avoid the overhead of each thread's having its own. Using the single statement
cache, threads can share the same statement from <span style="font-style: italic;">different connections</span>.
For more information, see in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N17492"></a><span></span>
<a name="N1749B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevconcepts600"></a><span></span>Example of threads sharing a statement</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N174BA"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This example shows what can happen if two threads try to share a single<span style="font-style: italic;"> Statement</span>.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N174C9"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">PreparedStatement ps = conn.prepareStatement(
    "UPDATE account SET balance =  balance + ? WHERE id = ?");
<span style="font-weight: bold;">/* now assume two threads T1,T2 are given this
java.sql.PreparedStatement object </span>and that the following events
happen in the order shown (pseudojava code)*/
T1 - ps.setBigDecimal(1, 100.00);
T1 - ps.setLong(2, 1234);
T2 -  ps.setBigDecimal(1, -500.00);
<span style="font-weight: bold;">// *** At this point the prepared statement has the parameters
// -500.00 and 1234
// T1 thinks it is adding 100.00 to account 1234 but actually
// it is subtracting 500.00</span>
T1 - ps.executeUpdate();
T2 - ps.setLong(2, 5678);
<span style="font-weight: bold;">// T2 executes the correct update</span>
 T2 - ps.executeUpdate();
<span style="font-weight: bold;">/* Also, the auto-commit mode of the connection can lead
to some strange behavior.*/</span>
</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N174EA"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If it is absolutely necessary, the application can get around this problem
with Java synchronization.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N174F3"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the threads each obtain their own <span style="font-style: italic;">PreparedStatement</span> (with identical text), their <span style="font-family: Courier;">
<span style="font-style: italic;">setXXX</span>
</span> calls
do not interfere with each other. Moreover, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is able to share the
same compiled query plan between the two statements; it needs to maintain
only separate state information. However, there is the potential for confusion
in regard to the timing of the <span style="font-style: italic;">commit</span>, since a single <span style="font-style: italic;">commit</span> commits all the statements in a transaction.</div>
</div>
</div>
</div>
</div>
<div>
<a name="N1754C"></a><span></span>
<a name="N17555"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevdvlp22619"></a><span></span>Working with database threads in an embedded environment</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Do not use <span style="font-family: Courier;">
<span style="font-style: italic;">interrupt</span>
</span> calls to notify
threads that are accessing a database, because <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will catch the <span style="font-family: Courier;">
<span style="font-style: italic;">interrupt</span>
</span> call and close the connection to the database.
Use <span style="font-family: Courier;">
<span style="font-style: italic;">wait</span>
</span> and <span style="font-family: Courier;">
<span style="font-style: italic;">notify</span>
</span> calls instead.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This will not happen in a client/server environment, but if you want your
application to work in either environment it is good practice to follow this
rule.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There are special considerations when working with more than one database
thread in an application. See <span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevconcepts34828">Working with multiple connections to a single database</a>
</span>
</span> and <span style="font-style: italic;">
<span style="color: blue;">
<a href="#cdevconcepts23499">Working with multiple threads sharing a single connection</a>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N1763A"></a><span></span>
<a name="N17643"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevconcepts24927"></a><span></span>Working with Derby SQLExceptions in an Application</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC generates exceptions of the type <span style="font-style: italic;">java.sql.SQLException</span>. To see the exceptions generated by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, retrieve and process
the <span style="font-family: Courier;">
<span style="font-style: italic;">SQLExceptions</span>
</span> in a catch block.</div>
</div>
<div>
<a name="N176F1"></a><span></span>
<a name="N176FA"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevconcepts844813"></a><span></span>Information provided in SQLExceptions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides the message, <span style="font-style: italic;">SQLState</span> values,
and error codes. Use the <span style="font-family: Courier;">
<span style="font-style: italic;">getSQLState</span>
</span> and <span style="font-family: Courier;">
<span style="font-style: italic;">getMessage</span>
</span> methods to view the <span style="font-family: Courier;">
<span style="font-style: italic;">SQLState</span>
</span> and error messages. Use <span style="font-family: Courier;">
<span style="font-style: italic;">getErrorCode</span>
</span> to see the error code. The error code defines the severity of
the error and is not unique to each exception. The severity levels are described
in<span style="font-family: Courier;">
<span style="font-style: italic;">org.apache.derby.types.ExceptionSeverity</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Applications should also check for and process <span style="font-style: italic;">java.sql.SQLWarnings</span>, which are processed in a similar way. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues an <span style="font-family: Courier;">
<span style="font-style: italic;">SQLWarning</span>
</span> if the <span style="font-family: Courier;">
<span style="font-style: italic;">create=true</span>
</span> attribute is specified and the database already exists.</div>
</div>
<div>
<a name="N177B0"></a><span></span>
<a name="N177B9"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevprocsqle"></a><span></span>Example of processing SQLExceptions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N177C6"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, a single error can generate more than one <span style="font-style: italic;">SQLException</span>. Use a loop and the <span style="font-family: Courier;">
<span style="font-style: italic;">getNextException</span>
</span> method to process all <span style="font-family: Courier;">
<span style="font-style: italic;">SQLExceptions</span>
</span> in
the chain. In many cases, the second exception in the chain is the pertinent
one.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N177E9"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following is an example:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N177F2"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">catch (Throwable e) {
    System.out.println("exception thrown:");
    errorPrint(e);
}
static void errorPrint(Throwable e) {
    if (e instanceof SQLException) 
        SQLExceptionPrint((SQLException)e);
    else
        System.out.println("A non-SQL error: " + e.toString());
}
static void SQLExceptionPrint(SQLException sqle) {
    while (sqle != null) {
        System.out.println("\n---SQLException Caught---\n");
        System.out.println("SQLState:   " + (sqle).getSQLState());
        System.out.println("Severity: " + (sqle).getErrorCode());
        System.out.println("Message:  " + (sqle).getMessage()); 
        sqle.printStackTrace();  
        sqle = sqle.getNextException();
    }
}</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N177FC"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See also "<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Exception Messages and SQL States", in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N1782D"></a><span></span>
<a name="N17836"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevresman19524"></a><span></span>Using Derby as a J2EE resource manager</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">J2EE, or the Java 2 Platform, Enterprise Edition, is a standard for development
of enterprise applications based on reusable components in a multi-tier environment.
In addition to the features of the Java 2 Platform, Standard Edition (J2SE),
J2EE adds support for Enterprise Java Beans (EJBs), Java Server Pages (JSPs),
Servlets, XML and many more. The J2EE architecture is used to bring together
existing technologies and enterprise applications in a single, manageable
environment.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is a J2EE-conformant
component in a distributed J2EE system. As such, it is one part of a larger
system that includes, among other things, a JNDI server, a connection pool
module, a transaction manager, a resource manager, and user applications. Within this system, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
serve as the resource manager.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information on J2EE and how to work in this environment, see the
J2EE specification available at <span>
<span style="font-style: italic;">http://java.sun.com/j2ee/docs.html</span>
</span>.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  This chapter does not show you how to use <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> as
a Resource Manager. Instead, it provides details specific to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that
are not covered in the specification. This information is useful to programmers
developing other modules in a distributed J2EE system, not to end-user application
developers.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In order to qualify as a resource manager in a J2EE system, J2EE requires
these basic areas of support. These three areas of support involve implementation
of APIS and are described in "J2EE Compliance: Java Transaction API and javax.sql
Extensions" in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This chapter describes the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> classes
that implement the APIs and provides some implementation-specific details.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  All of the classes described in this chapter require a Java 2 Platform,
Standard Edition, v 1.2 (J2SE) or higher environment.</div>
</div>
<div>
<a name="N178E0"></a><span></span>
<a name="N178E9"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="rdevresman79556"></a><span></span>Classes that pertain to resource managers</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1790D"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the javadoc for each class for more information.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N17916"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDataSource</span>
<span style="font-style: italic;"></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Implements <span style="font-style: italic;">javax.sql.DataSource</span> interface, which a
JNDI server can reference. Typically this is the object that you work with
as a <span style="font-family: Courier;">
<span style="font-style: italic;">DataSource</span>
</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Implements <span style="font-style: italic;">javax.sql.ConnectionPoolDataSource</span>. A factory for <span style="font-family: Courier;">
<span style="font-style: italic;">PooledConnection</span>
</span> objects.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedXADataSource</span>
<span style="font-style: italic;"></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s implementation of a <span style="font-style: italic;">javax.sql.XADataSource</span>.</div>
</div>
</td></tr></table></div>
</div>
</div>
</div>
<div>
<a name="N179A9"></a><span></span>
<a name="N179B2"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevresman89722"></a><span></span>Getting a DataSource</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Normally, you can simply work with the interfaces for <span style="font-style: italic;">javax.sql.DataSource</span>, <span style="font-family: Courier;">
<span style="font-style: italic;">javax.sql.ConnectionPoolDataSource</span>
</span>, and <span style="font-family: Courier;">
<span style="font-style: italic;">javax.sql.XADataSource</span>
</span>,
as shown in the following examples.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource;
import org.apache.derby.jdbc.EmbeddedDataSource;
import org.apache.derby.jdbc.EmbeddedXADataSource; 

javax.sql.ConnectionPoolDataSource cpds = new EmbeddedConnectionPoolDataSource(); 
javax.sql.DataSource ds = new EmbeddedDataSource(); 
javax.sql.XADataSource xads = new EmbeddedXADataSource();</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides six properties for a <span style="font-style: italic;">DataSource</span>. These properties are in <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDataSource</span>. They are:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">DatabaseName</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This mandatory property must
be set. It identifies which database to access. If a database named wombat
located at /local1/db/wombat is to be accessed, then one should call <span style="font-style: italic;">setDatabaseName</span>("/local1/db/wombat") on the data source object. </div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">CreateDatabase</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Sets a property to
create a database the next time the <span style="font-style: italic;">XADataSource.getXAConection()</span> method is called. The string <span style="font-style: italic;">createString</span> is
always "create" (or possibly null). (Use the method <span style="font-family: Courier;">
<span style="font-style: italic;">setDatabaseName()</span>
</span> to define the name of the database.)</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">ShutdownDatabase</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Sets a property
to shut down a database. The string <span style="font-style: italic;">shutDownString</span> is
always "shutdown" (or possibly null). Shuts down the database the
next time <span style="font-family: Courier;">
<span style="font-style: italic;">XADataSource.getXAConnection().getConnection()</span>
</span> method is called.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">DataSourceName</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Name for ConnectionPooledDataSource
or XADataSource. Not used by the data source object. Used for informational
purpose only. </div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Description</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Description of the data
source. Not used by the data source object. Used for informational purpose
only. </div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">connectionAttributes</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Connection
attributes specific to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. See the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span> for a more
information about the attributes. </div>
</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N17AC0"></a><span></span>
<a name="N17AC9"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevresman92946"></a><span></span>Shutting down or creating a database</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you need to shut down or create a database, it is easiest just to work
with the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-specific implementations of interfaces, as shown in the
following examples.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">javax.sql.XADataSource xads = makeXADataSource(mydb, true);


<span style="font-weight: bold;">// example of setting property directory using </span>
// <span style="font-weight: bold;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> 's </span>XADataSource object
import org.apache.derby.jdbc.EmbeddedXADataSource;
import javax.sql.XADataSource;
<span style="font-weight: bold;">// dbname is the database name
// if create is true, create the database if not already created</span>
XADataSource makeXADataSource (String dbname, boolean create) 
{
    EmbeddedXADataSource xads = new EmbeddedXADataSource();
<span style="font-weight: bold;">    // use <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> 's setDatabaseName call</span>
    xads.setDatabaseName(dbname);
    if (create)
        xads.setCreateDatabase("create");
    return xads;
}</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Setting the property does not create or shut down the database. The database
is not actually created or shut down until the next connection request. </div>
</div>
</div>
</div>
<div>
<a name="N17B3D"></a><span></span>
<a name="N17B46"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevcsecuree"></a><span></span>Derby and Security</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can be deployed
in a number of ways and in a number of different environments. The security
needs of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
are also diverse. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supplies
or supports the following optional security mechanisms:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">User authentication</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> verifies
user names and passwords before permitting them access to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.
See <span style="color: blue;">
<a href="#cdevcsecure42374">Working with user authentication</a>
</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">User authorization</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A means of granting specific users permission
to read a database or to write to a database. See <span style="color: blue;">
<a href="#cdevcsecure36595">User authorization</a>
</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Disk encryption</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A means of encrypting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> data
stored on disk. See <span style="color: blue;">
<a href="#cdevcsecure24366">Encrypting databases on disk</a>
</span>.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">Validation of Certificate for Signed Jar Files</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a Java 2
environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> validates
certificates for classes loaded from signed jar files. See <span style="color: blue;">
<a href="#cdevcsecure90988">Signed jar files</a>
</span>.</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>Some of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> security
mechanisms at work in a client/server environment</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\security_os.jpg">
</div>
<div></div>
</div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>Another <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> security
mechanism, disk encryption, protects data when the recipient might not know
how to protect data. It is useful for databases deployed in an embedded environment.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\security2_os.jpg">
</div>
<div></div>
</div>
</div>
</td></tr></table></div>
</div>
<div>
<a name="N17CB9"></a><span></span>
<a name="N17CC2"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure12392"></a><span></span>Configuring security for your environment</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In most cases, you enable <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s security features through the
use of properties. It is important to understand the best way of setting properties
for your environment.</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N17CEC"></a><span></span>
<div style="font-weight: bold;">Configuring security</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not come with a built-in superuser. For that reason, be
careful when configuring <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> for user authentication and user authorization. </div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>When first working with security, work with system-level properties only
so that you can easily override them if you make a mistake. </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Be sure to create at least one valid user, and grant that user full (read-write)
access. For example, you might always want to create a user called <span style="font-style: italic;">sa</span> with the password <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>
</span> while
you are developing. </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>3. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Test the authentication system while it is still configured at the system
level. Be absolutely certain that you have configured the system correctly
before setting the properties as database-level properties.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>4. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Before disabling system-level properties (by setting <span style="font-style: italic;">derby.database.propertiesOnly</span> to true), test that at least one database-level read-write user (such
as <span style="font-style: italic;">sa</span>) is valid. If you do not have at least one valid
user that the system can authenticate, you will not be able to access your
database.</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N17DD4"></a><span></span>
<a name="N17DDD"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="tdevcsecure82556"></a><span></span>Configuring security in a client/server environment</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N17DEA"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This procedure requires a system with multiple databases and some administrative
resources. For systems that have a single database and for which there are
no administrative resources, follow the instructions in <span style="color: blue;">
<a href="#tdevcsecure81850">Configuring security in an embedded environment</a>
</span>.</div>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Configure security features as system properties.  See <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Provide administrative-level protection for the <span style="font-style: italic;">derby.properties</span> file and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases. For example, you can protect these files
and directories with operating system permissions and firewalls.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>3. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Turn on user authentication for your system.  All users must provide valid
user IDs and passwords to access the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system. See <span style="color: blue;">
<a href="#cdevcsecure42374">Working with user authentication</a>
</span> for information. If you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s built-in
users, configure users for the system in the <span style="font-style: italic;">derby.properties</span> file. Provide the protection for this file.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>4. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Configure user authorization for sensitive databases in your system. 
Only designated users will be able to access sensitive databases. You typically
configure user authorization with database-level properties. See <span style="color: blue;">
<a href="#cdevcsecure36595">User authorization</a>
</span> for information. It is also possible to configure user authorization
with system-level properties. This is useful when you are developing systems
or when all databases have the same level of sensitivity.</span>
</div>
</td></tr></table></div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N17E5F"></a><span></span>
</div>
</div>
</div>
<div>
<a name="N17E84"></a><span></span>
<a name="N17E8D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="tdevcsecure81850"></a><span></span>Configuring security in an embedded environment</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N17E9A"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded environment, typically there is only one database per system
and there are no administrative resources to protect databases.</div>
</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>1. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Encrypt the database when you create it.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>2. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Configure all security features as database-level properties.  These properties
are stored in the database (which is encrypted). See <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>3. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Turn on protection for database-level properties so that they cannot be
overridden by system properties by setting the <span style="font-style: italic;">derby.database.propertiesOnly</span> property to TRUE.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>4. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">To prevent unauthorized users from accessing databases once they are booted,
turn on user authentication for the database and configure user authorization
for the database.  See <span style="color: blue;">
<a href="#cdevcsecure42374">Working with user authentication</a>
</span> and <span style="color: blue;">
<a href="#cdevcsecure36595">User authorization</a>
</span> for more information.</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>5. 
          </div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">If you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s built-in users, configure each user
as a database-level property so that user names and passwords can be encrypted.</span>
</div>
</td></tr></table></div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N17EFE"></a><span></span>
</div>
</div>
</div>
</div>
<div>
<a name="N17F23"></a><span></span>
<a name="N17F2C"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure42374"></a><span></span>Working with user authentication</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
support for user authentication. <span style="font-style: italic;">User authentication</span> means that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> authenticates a user's
name and password before allowing that user access to the system.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When user authentication is enabled (which it is not by default), the user
requesting a connection must provide a valid name and password, which <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> verifies against the
repository of users defined for the system. Once <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> authenticates
the user, it grants the user access to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
but not necessarily access to the database made in the connection request.
In the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, access
to a database is determined by <span style="font-style: italic;">user authorization</span>. For information,
see <span style="color: blue;">
<a href="#cdevcsecure36595">User authorization</a>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows you to
provide a repository of users in a number of different ways. For example,
you can hook <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> up to
an external directory service elsewhere in your enterprise, create your own,
use <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s simple mechanism
for creating a built-in repository of users.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can define a repository of users for a particular database or for an
entire system, depending on whether you use system-wide or database-wide properties.
See <span style="color: blue;">
<a href="#cdevcsecure12392">Configuring security for your environment</a>
</span> for more information.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user authentication
is enabled and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses
an external directory service, the architecture looks something like that
shown in the Figure below: </div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user
authentication using an external service. The application can be a single-user
application with an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
or a multi-user application server.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\authentic_os.jpg">
</div>
<div></div>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> always runs embedded
in another Java application, whether that application is a single-user application
or a multiple-user application server or connectivity framework. A database
can be accessed by only one JVM at a time, so it is possible to deploy a system
in which the application in which <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
embedded, not <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, handles
the user authentication by connecting to an external directory service. </div>
<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;">
<div style="font-weight: bold;">
<span style="color: red;">Figure1. </span>The application provides the user authentication
using an external service. The application can be a single-user application
with an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
or a multi-user application server.</div>
<div>&nbsp;</div>
<div>
<img src="file:///C:\derby-docs-10.1\src\devguide\appauth_os.jpg">
</div>
<div></div>
</div>
</div>
<div>
<a name="N180E1"></a><span></span>
<a name="N180EA"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure36127"></a><span></span>Enabling user authentication</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To enable user authentication, set the <span style="font-style: italic;">derby.connection.requireAuthentication</span> property to true. Otherwise, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not require a user name
and password. You can set this property as a system-wide property or as a
database-wide property.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For a multi-user product, you would typically set it for the system in
the <span style="font-style: italic;">derby.properties</span> file for your server, since it
is in a trusted environment.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If you start a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system with user authentication
enabled but without defining at least one user, you will not be able to shut
down the system gracefully. When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is running in a connectivity
server and user authentication is turned on, stopping the server requires
a user name and password. You will need to alter shutdown scripts accordingly. </div>
</div>
</div>
<div>
<a name="N1818B"></a><span></span>
<a name="N18194"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure37817"></a><span></span>Defining users</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides several ways to define the repository of users and
passwords. To specify which of these services to use with your <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
set the property <span style="font-style: italic;">derby.authentication.provider</span> to
the appropriate value as discussed in the appropriate section listed below.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Setting the property as a system-wide property creates system-wide users.
Setting the property as a database-wide property creates users for a single
database only.</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="color: blue;">
<a href="#cdevcsecure38522">External directory service</a>
</span>: <span style="color: blue;">
<a href="#cdevcsecure41285">LDAP directory service</a>
</span>. This includes Windows NT domain user authentication through
the Netscape NT Synchronization Service.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="color: blue;">
<a href="#cdevcsecure21561">User-defined class</a>
</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="color: blue;">
<a href="#cdevcsecure21547">Built-in Derby users</a>
</span>
</div>
</td></tr></table></div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Shutting down the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system (for example, using the <span style="font-style: italic;">shutdown=true</span> form of the connection URL without specifying a particular
database) when user authentication is turned on requires that you define at
least one user as a system-wide user.</div>
</div>
</div>
<div>
<a name="N1826C"></a><span></span>
<a name="N18275"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure38522"></a><span></span>External directory service</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A directory service stores names and attributes of those names. A typical
use for a directory service is to store user names and passwords for a computer
system. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses the Java naming and directory interface (JNDI) to
interact with external directory services that can provide authentication
of users' names and passwords.</div>
</div>
<div>
<a name="N1832A"></a><span></span>
<a name="N18333"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure41285"></a><span></span>LDAP directory service</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can allow <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to authenticate users against an existing LDAP
directory service within your enterprise. LDAP (lightweight directory access
protocol) provides an open directory access protocol running over TCP/IP.
An LDAP directory service can quickly authenticate a user's name and password. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use an LDAP directory service, set <span style="font-style: italic;">derby.authentication.provider</span> to <span style="font-style: italic;">LDAP</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Examples of LDAP service providers are:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Netscape Directory Server  
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Netscape Directory Server is an LDAP directory
server. In addition, the Netscape Directory Synchronization Service synchronizes
entries in a Windows NT directory with the entries in Netscape's Directory
Server. It allows you to use the Windows NT directory as a repository for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> users.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>UMich slapd (freeware for the UNIX platform from the University of Michigan)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>AE SLAPD for Windows NT, from AEInc</div>
</td></tr></table></div>
</div>
<div>
<a name="N18412"></a><span></span>
<a name="N1841B"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure608"></a><span></span>Libraries for LDAP user authentication: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1844E"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use an LDAP directory service with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
you need the following libraries in your classpath:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1845D"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">jndi.jar</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JNDI classes</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">ldap.jar</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">LDAP provider from Sun</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">providerutil.jar</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JNDI classes for a provider</div>
</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1848F"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
not provide these libraries; they are available from Sun on the JNDI page.
Use the 1.1.x versions of these libraries, not the 1.2.x versions. You might
need to do two separate downloads to obtain all the required libraries.</div>
</div>
</div>
</div>
<div>
<a name="N184F2"></a><span></span>
<a name="N184FB"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure863446"></a><span></span>Setting up Derby to use your LDAP directory service: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When specifying LDAP as your authentication service, you must specify the
location of the server and its port number.</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">derby.authentication.server</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Set the property <span style="font-style: italic;">derby.authentication.server</span> to the location and port number
of the LDAP server. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.authentication.server=godfrey:389</div></pre>
</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N18580"></a><span></span>
<a name="N18589"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure876908"></a><span></span>Guest access to search for DNs: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an LDAP system, users are hierarchically organized in the directory
as a set of entries. An <span style="font-style: italic;">entry</span> is a set of name-attribute
pairs identified by a unique name, called a DN (distinguished name). An entry
is unambiguously identified by a DN, which is the concatenation of selected
attributes from each entry in the tree along a path leading from the root
down to the named entry, ordered from right to left. For example, a DN for
a user might look like this:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">cn=mary,ou=People,o=FlyTours.com

uid=mary,ou=People,o=FlyTours.com</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The allowable entries for the name are defined by the entry's <span style="font-style: italic;">objectClass</span>. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An LDAP client can bind to the directory (successfully log in) if it provides
a user ID and password. The user ID must be a DN, the fully qualified list
of names and attributes. This means that the user must provide a very long
name.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, the user knows only a simple user name (e.g., the first part
of the DN above, <span style="font-style: italic;">mary</span>). With <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, you
do not need the full DN, because an LDAP client (<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>) can go to the
directory first as a guest or even an anonymous user, search for the full
DN, then rebind to the directory using the full DN (and thus authenticate
the user).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> typically initiates a search for a full DN before binding to
the directory using the full DN for user authentication. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
not initiate a search in the following cases:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>You have set <span style="font-style: italic;">derby.authentication.ldap.searchFilter</span> to <span style="font-style: italic;">derby.user</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>A user DN has been cached locally for the specific user with the <span style="font-style: italic;">derby.user.UserName</span> property.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see <span style="font-style: italic;">derby.authentication.ldap.searchFilter</span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some systems permit anonymous searches; other require a user DN and password.
You can specify a user's DN and password for the search with the properties
listed below. In addition, you can limit the scope of the search by specifying
a filter (definition of the object class for the user) and a base (directory
from which to begin the search) with the properties listed below. </div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">derby.authentication.ldap.searchAuthDN (optional)</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specifies the DN with which to bind (authenticate) to the server when searching
for user DNs. This parameter is optional if anonymous access is supported
by your server. If specified, this value must be a DN recognized by the directory
service, and it must also have the authority to search for the entries.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If not set, it defaults to an anonymous search using the root DN specified
by the <span style="font-style: italic;">derby.authentication.ldap.searchBase</span> property.
For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">uid=guest,o=FlyTours.com</div></pre>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">derby.authentication.ldap.searchAuthPW (optional)</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specifies the password to use for the guest user configured above to bind
to the directory service when looking up the DN. If not set, it defaults to
an anonymous search using the root DN specified by the <span style="font-style: italic;">derby.authentication.ldap.searchBase</span> property.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">myPassword</div></pre>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">derby.authentication.ldap.searchBase (optional)</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specifies the root DN of the point in your hierarchy from which to begin a
guest search for the user's DN. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ou=people,o=FlyTours.com</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When using Netscape Directory Server, set this property to the root
DN, the special entry to which access control does not apply (optional).</div>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To narrow the search, you can specify a user's <span style="font-style: italic;">objectClass</span>.</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">derby.authentication.ldap.searchFilter (optional)</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Set <span style="font-style: italic;">derby.authentication.ldap.searchFilter</span> to a logical
expression that specifies what constitutes a user for your LDAP directory
service. The default value of this property is <span style="font-family: Courier;">
<span style="font-style: italic;">objectClass=inetOrgPerson</span>
</span>. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">objectClass=person</div></pre>
</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N186FA"></a><span></span>
<a name="N18703"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure863546"></a><span></span>LDAP performance issues: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For performance reasons, the LDAP directory server should be in the same
LAN as <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not cache the user's credential information
locally and thus must connect to the directory server every time a user connects.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Connection requests that provide the full DN are faster than those that
must search for the full DN.</div>
</div>
</div>
<div>
<a name="N1877B"></a><span></span>
<a name="N18784"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure863611"></a><span></span>Considerations when using Windows NT with LDAP: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Netscape provides LDAP functionality for Windows NT systems with its Netscape
Directory Synchronization service, which synchronizes the Windows NT users
with the Netscape Directory Server. SSL is recommended in this configuration.</div>
</div>
</div>
<div>
<a name="N187EB"></a><span></span>
<a name="N187F4"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure863676"></a><span></span>LDAP restrictions: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not support LDAP groups. </div>
</div>
</div>
</div>
<div>
<a name="N18860"></a><span></span>
<a name="N18869"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure864242"></a><span></span>JNDI-specific properties for external directory services</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows you to set a few advanced JNDI properties, which you
can set in any of the supported ways of setting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties. Typically
you would set these at the same level (database or system) for which you configured
the external authentication service.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The list of supported properties can be found in Appendix A: JNDI Context
Environment in the Java Naming and Direction API at <span>
<span style="font-style: italic;">http://java.sun.com/products/jndi/reference/api/index.html</span>
</span>. The external directory service must support the property.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Each JNDI provider has its set of properties that you can set within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, you can set the property <span style="font-style: italic;">java.naming.security.authentication</span> to allow user credentials to be encrypted on the network if the provider
supports it. You can also specify that SSL be used with LDAP (LDAPS).</div>
</div>
</div>
<div>
<a name="N188EB"></a><span></span>
<a name="N188F4"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure21561"></a><span></span>User-defined class</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Set <span style="font-style: italic;">derby.authentication.provider</span> to the full name
of a class that implements the public interface <span style="font-style: italic;">org.apache.derby.authentication.UserAuthenticator</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By writing your own class that fulfills some minimal requirements, you
can hook <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> up to an <span style="font-style: italic;">external authentication service</span> other than LDAP. To do so, specify an external authentication
service by setting the property <span style="font-family: Courier;">
<span style="font-style: italic;">derby.authentication.provider</span>
</span> to a class name that you want <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to load at startup.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The class that provides the external authentication service must implement
the public interface <span style="font-style: italic;">org.apache.derby.authentication</span>.<span style="font-style: italic;">UserAuthenticator</span> and throw exceptions of the type <span style="font-style: italic;">java.sql.SQLException</span> where appropriate.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Using a user-defined class makes <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> adaptable to various naming
and directory services.</div>
</div>
<div>
<a name="N189A7"></a><span></span>
<a name="N189B0"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevexudclass"></a><span></span>Example of setting a user-defined class: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N189BD"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A very simple example of a class that implements the <span style="font-style: italic;">org.apache.derby.authentication</span> interface:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N189CC"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import org.apache.derby.authentication.UserAuthenticator;
import java.io.FileInputStream;
import java.util.Properties;
import java.sql.SQLException;
<span style="font-weight: bold;">/**
  * A simple example of a specialized Authentication scheme.
  * The system property 'derby.connection.requireAuthentication'
  * must be set
  * to true and 'derby.connection.specificAuthentication' must
  * contain the full class name of the overriden authentication
  * scheme,  i.e., the name of this class.
  *
  * @see org.apache.derby.authentication.UserAuthenticator 
  */</span>

public class MyAuthenticationSchemeImpl implements
UserAuthenticator {
    private static final String USERS_CONFIG_FILE = "myUsers.cfg";
    private static Properties usersConfig;

   <span style="font-weight: bold;"> // Constructor
    // We get passed some Users properties if the 
    //authentication service could not set them as 
    //part of System properties.
    //</span>
    public MyAuthenticationSchemeImpl() {
    }
<span style="font-weight: bold;">    /* static block where we load the users definition from a
users configuration file.*/</span>

    static {
<span style="font-weight: bold;">       /* load users config file as Java properties
        File must be in the same directory where
        <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>  gets started.
       (otherwise full path must be specified) */</span>
       FileInputStream in = null;
       usersConfig = new Properties();
       try {
           in = new FileInputStream(USERS_CONFIG_FILE);
           usersConfig.load(in);
           in.close();
       } catch (java.io.IOException ie) {
           // No Config file. Raise error message
           System.err.println(
             "WARNING: Error during Users Config file
retrieval");
           System.err.println("Exception: " + ie);
       }
    }
<span style="font-weight: bold;">    /**
     * Authenticate the passed-in user's credentials.
     * A more complex class could make calls
     * to any external users directory.
     *
     * @param userName               The user's name
     * @param userPassword           The user's password 
     * @param databaseName           The database 
     * @param infoAdditional jdbc connection info.
     * @exception SQLException on failure
     */</span>
    public boolean authenticateUser(String userName,
     String userPassword,
     String databaseName,
     Properties info)
       throws SQLException 
    {
 <span style="font-weight: bold;">      /* Specific Authentication scheme logic.
        If user has been authenticated, then simply return.
        If user name and/or password are invalid, 
        then raise the appropriate exception.
            
       This example allows only users defined in the
       users config properties object.

       Check if the passed-in user has been defined for the system.
       We expect to find and match the property corresponding to
       the credentials passed in. */</span>
       if (userName == null)
          <span style="font-weight: bold;"> // We do not tolerate 'guest' user for now.
       </span>    return false;
<span style="font-weight: bold;">       //
       // Check if user exists in our users config (file)
       // properties set.
       // If we did not find the user in the users config set, then
       // try to find if the user is defined as a System property.
       //</span>
       String actualUserPassword;
       actualUserPassword = usersConfig.getProperty(userName);
       if (actualUserPassword == null)
           actualUserPassword = System.getProperty(userName);
       if (actualUserPassword == null)
            <span style="font-weight: bold;">// no such passed-in user found</span>
            return false;
            <span style="font-weight: bold;">// check if the password matches</span>
       if (!actualUserPassword.equals(userPassword))
       return false;
       <span style="font-weight: bold;">// Now, check if the user is a valid user of the database</span>
       if (databaseName != null)
       {
             <span style="font-weight: bold;">/* if database users restriction lists present, then check 
            if there is one for this database and if so, 
            check if the user is a valid one of that database.
            For this example, the only user we authorize in database
            DarkSide is user 'DarthVader'. This is the only database
            users restriction list we have for this example.
            We authorize any valid (login) user to access the
            OTHER databases in the system.
            Note that database users ACLs could be set in the same
            properties file or a separate one and implemented as you
            wish. */</span>
<span style="font-weight: bold;">//</span>
           if (databaseName.equals("DarkSide")) {
              <span style="font-weight: bold;">// check if user is a valid one.</span>
              if (!userName.equals("DarthVader"))
                  <span style="font-weight: bold;">// This user is not a valid one of the passed-in</span>
                  return false;
           }
       }
       <span style="font-weight: bold;">// The user is a valid one in this database</span>
       return true;
    }
}</div></pre>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N18A4F"></a><span></span>
<a name="N18A58"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure21547"></a><span></span>Built-in Derby users</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides a simple, built-in repository of user names and passwords. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use the built-in repository, set <span style="font-style: italic;">derby.authentication.provider</span> to <span style="font-style: italic;">BUILTIN</span>. Using built-in users is an alternative
to using an external directory service such as LDAP.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.authentication.provider=BUILTIN</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can create user names and passwords for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> users by specifying
them with the <span style="font-style: italic;">derby.user.UserName</span> property.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  These user names are case-sensitive for user authorization.
User names are <span style="font-style: italic;">SQL92Identifiers</span>. Delimited identifiers
are allowed:  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.user."FRed"=java</div></pre>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information on user names and <span style="font-style: italic;">SQL92Identifiers</span>, see <span style="color: blue;">
<a href="#cdevcsecure37241">Users and authorization identifiers</a>
</span>.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  For passwords, it is a good idea not to use words that would
be easily guessed, such as a login name or simple words or numbers. A password
should be a mix of numbers and upper- and lowercase letters.</div>
</div>
<div>
<a name="N18B4B"></a><span></span>
<a name="N18B54"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure864642"></a><span></span>Database-level properties</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you create users with database-level properties, those users are available
to the specified database only.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You set the property once for each user. To delete a user, set that user's
password to null.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-weight: bold;">-- adding the user sa with password '<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>pass'</span>
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.sa', '<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>pass')
<span style="font-weight: bold;">-- adding the user mary with password 'little7xylamb'</span>
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.mary', 'little7xylamb')
<span style="font-weight: bold;">-- removing mary by setting password to null</span>
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.mary', null)</span>
</div></pre>
</div>
</div>
<div>
<a name="N18BB3"></a><span></span>
<a name="N18BBC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure864692"></a><span></span>System-level properties</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you create users with system-level properties, those users are available
to all databases in the system.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You set the value of this system-wide property once for each user, so you
can set it several times. To delete a user, remove that user from the file.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can define this property in the usual ways- typically
in the <span style="font-style: italic;">derby.properties</span> file. For more information about setting properties,
see <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here is a sample excerpt from the <span style="font-style: italic;">derby.properties</span> file:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;"># Users definition
#</span>
derby.user.sa=<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>pass
derby.user.mary=little7xylamb</div></pre>
</div>
</div>
</div>
<div>
<a name="N18C29"></a><span></span>
<a name="N18C32"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevcsecure557"></a><span></span>List of user-authentication properties</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N18C3B"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="color: blue;">
<a href="#rdevcsecure557">User Authentication Properties</a>
</span> summarizes
the various properties related to user authentication.</div>
</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>User Authentication Properties</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">


<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Property Name</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Use</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span style="font-style: italic;">derby.connection.requireAuthentication</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Turns on user authentication.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span style="font-style: italic;">derby.authentication.provider</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Specifies the kind of user authentication to use.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span style="font-style: italic;">derby.authentication.server</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>For LDAP user authentication, specifies the location of
the server.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span style="font-style: italic;">derby.authentication.ldap.searchAuthDN, derby.authentication.ldap.searchAuthPW, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.authentication.ldap.searchFilter, </span> and <span style="font-family: Courier;">
<span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.authentication. ldap.searchBase</span>
</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Configures the way DN searches are performed.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span style="font-style: italic;">derby.user.UserName</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Creates a user name and password for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in user repository.</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span style="font-style: italic;">javax.naming.*</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>JNDI properties</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div>
<a name="N18D6F"></a><span></span>
<a name="N18D78"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure79358"></a><span></span>Programming applications for Derby user authentication</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section discusses programming user authentication into applications
for use with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
</div>
<div>
<a name="N18E16"></a><span></span>
<a name="N18E1F"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure766"></a><span></span>Programming the application to provide the user and password</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N18E52"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In the <span style="font-style: italic;">DriverManager.getConnection</span> call, an application
can provide the user name and password:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N18E61"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Separately as arguments to the following signature of the method: <span style="font-style: italic;">getConnection(String url, String user, String password)</span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", "mary", "little7xylamb");</div></pre>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>As attributes to the database connection URL  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB;user=mary;password=little7xylamb");</div></pre>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>By setting the user and password properties in a Properties object as
with other connection URL attributes  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Properties p = new Properties();
p.put("user", "mary");
p.put("password", "little7xylamb");
Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", p);</div></pre>
</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N18E8F"></a><span></span>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The password is not encrypted. When you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
the context of a server framework, the framework should be responsible for
encrypting the password across the network. If your framework does not encrypt
the password, consider using SSL. </div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N18E9E"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information about the treatment of user names within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
see <span style="color: blue;">
<a href="#cdevcsecure37241">Users and authorization identifiers</a>
</span>.</div>
</div>
</div>
</div>
<div>
<a name="N18ED6"></a><span></span>
<a name="N18EDF"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure305"></a><span></span>Login failure exceptions with user authentication</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N18EEC"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If user authentication is turned on and a valid user name and password
are not provided, <span style="font-style: italic;">SQLException</span> 08004 is raised.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N18EFB"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ERROR 08004: Connection refused : Invalid authentication.</div></pre>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N18F26"></a><span></span>
<a name="N18F2F"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure37241"></a><span></span>Users and authorization identifiers</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">User names within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
are known as <span style="font-style: italic;">authorization identifiers</span>. The authorization identifier
is a string that represents the name of the user, if one was provided in the
connection request. For example, the built-in function CURRENT_USER returns
the authorization identifier for the current user.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once the authorization identifier is passed to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
it becomes an <span style="font-style: italic;">SQL92Identifier</span>. <span style="font-family: Courier;">
<span style="font-style: italic;">SQL92Identifiers</span>
</span>-the
kind of identifiers that represent database objects such as tables and columns-are
case-insensitive (they are converted to all caps) unless delimited with double
quotes, are limited to 128 characters, and have other limitations.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">User names must be valid authorization identifiers even if user authentication
is turned off, and even if all users are allowed access to all databases.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about <span style="font-style: italic;">SQL92Identifiers</span>, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
<div>
<a name="N1903B"></a><span></span>
<a name="N19044"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure24458"></a><span></span>Authorization identifiers, user authentication, and user authorization</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When working with both user authentication and user authorization, you
need to understand how user names are treated by each system. If an external
authentication system is used, the conversion of the user's name to an
authorization identifier does not happen until <span style="font-style: italic;">after</span> authentication
has occurred but <span style="font-style: italic;">before</span> user authorization (see <span style="color: blue;">
<a href="#cdevcsecure36595">User authorization</a>
</span>). Imagine, for example, a user named
Fred.</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Within the user authentication system, Fred is known as <span style="font-style: italic;">FRed</span>. Your external user authorization service is case-sensitive, so
Fred must always type his name that way.  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", "FRed", "flintstone");</div></pre>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user authorization system, Fred becomes a case-insensitive
authorization identifier. Fred is known as <span style="font-style: italic;">FRED</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>When specifying which users are authorized to access the accounting database,
you must list Fred's authorization identifier, <span style="font-style: italic;">FRED</span> (which you can type as <span style="font-style: italic;">FRED</span>, <span style="font-style: italic;">FREd</span>, or <span style="font-style: italic;">fred</span>, since the system automatically
converts it to all-uppercase).  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">derby.fullAccessUsers=sa,FRED,mary</span>
</div></pre>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Let's take a second example, where Fred has a slightly different name
within the user authentication system.</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Within the user authentication system, Fred is known as <span style="font-style: italic;">Fred!</span>. You must now put double quotes around the name, because it is
not a valid <span style="font-family: Courier;">
<span style="font-style: italic;">SQL92Identifier</span>
</span>. (<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> knows
to remove the double quotes when passing the name to the external authentication
system.)  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", "\"Fred!\"", "flintstone");</div></pre>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user authorization system, <span style="font-style: italic;">Fred</span> becomes a case-sensitive authorization identifier. Fred is known
as <span style="font-style: italic;">Fred!</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>When specifying which users are authorized to access the accounting database,
you must list Fred's authorization identifier, <span style="font-style: italic;">"Fred!"</span> (which you must always delimit with double quotation marks).  
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.fullAccessUsers=sa,"Fred!",manager</div></pre>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">As shown in the first example, your external authentication system may
be case-sensitive, whereas the authorization identifier within <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> may
not be. If your authentication system allows two distinct users whose names
differ by case, delimit all user names within the connection request to make
all user names case-sensitive within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system. In addition,
you must also delimit user names that do not conform to <span style="font-style: italic;">SQL92Identifier</span> rules with double quotes.</div>
</div>
</div>
<div>
<a name="N1916A"></a><span></span>
<a name="N19173"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure865580"></a><span></span>User names and schemas</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">User names can affect a user's default schema. For information about
user names and schemas, see "SET SCHEMA statement" in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>
<span style="font-style: italic;">.</span>
</div>
</div>
</div>
<div>
<a name="N191C5"></a><span></span>
<a name="N191CE"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevcsecure622"></a><span></span>Exceptions when using authorization identifiers</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N191DB"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specifying an invalid authorization identifier in a database user authorization
property raises an exception. Specifying an invalid authorization identifier
in a connection request raises an exception.</div>
</div>
</div>
</div>
</div>
<div>
<a name="N19212"></a><span></span>
<a name="N1921B"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure36595"></a><span></span>User authorization</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides user authorization, which is a means of granting users
permission to access a database (or system). <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows you to distinguish
between full (read-write) access and read-only access. (<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Version 10.1 does
not support the SQL GRANT and REVOKE features, which allow you to set permissions
to specific database objects or specific SQL actions.)</div>
</div>
<div>
<a name="N192F8"></a><span></span>
<a name="N19301"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure866060"></a><span></span>Setting user authorization</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, you configure user authorization for a particular database.
However, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> also allows you to configure user authorization for the
system, which is useful during development and for specifying a secure default
access for all databases in the system.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To control access to a particular database, set database-level properties
that specify which users have full (read-write) access to the database and
which users have read-only access to the database. Users not specified by
either property inherit the default access for the database (none, read-only,
or full read-write access). When not explicitly set, the default access for
a database is full (read-write) access.</div>
</div>
<div>
<a name="N19397"></a><span></span>
<a name="N193A0"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure865818"></a><span></span>Setting the default access mode</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify the default access mode for the database, use the <span style="font-style: italic;">derby.database.defaultConnectionMode</span> property. You can set the property
to the following values:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">noAccess</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">readOnlyAccess</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">fullAccess</span> (the default)</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> validates the authorization configuration properties when users
set them. It raises an exception if a user attempts to set the properties
to invalid values (see <span style="color: blue;">
<a href="#rdevcsecure379">User authorization exceptions</a>
</span>). </div>
</div>
</div>
<div>
<a name="N19437"></a><span></span>
<a name="N19440"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure865880"></a><span></span>Setting the access mode for particular users</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify which particular users have full (read-write) access to a database,
use the <span style="font-style: italic;">derby.database.fullAccessUsers</span> property. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers', 'sa,mary')</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify which particular users have read-only access to a database,
use the <span style="font-style: italic;">derby.database.readOnlyAccessUsers</span> property. For example:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.readOnlyAccessUsers', 'guest,"Fred!"')</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For these properties, you specify users as a comma-separated list (no spaces
between the comma and the next user).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For users not specified with either property the access is specified by
the <span style="font-style: italic;">derby.database.defaultConnectionMode</span> property.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  It is possible to configure a database so that it cannot be changed
(or even accessed) using the <span style="font-style: italic;">derby.database.defaultConnectionMode</span> property.
If you set this property to <span style="font-family: Courier;">
<span style="font-style: italic;">noAccess</span>
</span> or <span style="font-family: Courier;">
<span style="font-style: italic;">readOnlyAccess</span>
</span>,
be sure to allow at least one user full access.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the Javadoc for the utility or <span style="color: blue;">
<a href="#rdevcsecure131">Examples of user authorization</a>
</span> for
more details.</div>
</div>
</div>
<div>
<a name="N194F8"></a><span></span>
<a name="N19501"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure935"></a><span></span>Notes on user authorization</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1950E"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">All the authorization properties are set for a connection when it is created.
Changing any of the authorization properties does not affect existing connections.
However, all future connections are affected by the change. </div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19517"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about authorization identifiers, see <span style="color: blue;">
<a href="#cdevcsecure37241">Users and authorization identifiers</a>
</span>.</div>
</div>
</div>
</div>
<div>
<a name="N19563"></a><span></span>
<a name="N1956C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure379"></a><span></span>User authorization exceptions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19579"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a user is not authorized to connect to the database specified in the
connection request, <span style="font-style: italic;">SQLException</span> 04501 is raised.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19588"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a user with <span style="font-style: italic;">readOnlyAccess</span> attempts to write
to a database, <span style="font-style: italic;">SQLException</span> 08004 <span style="font-family: Courier;">
<span style="font-style: italic;">- connection refused</span>
</span> is raised.</div>
</div>
</div>
</div>
</div>
<div>
<a name="N195E2"></a><span></span>
<a name="N195EB"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevcsecure190"></a><span></span>Read-only and full access permissions</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19619"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="color: blue;">
<a href="#rdevcsecure190">Permissions for Read-Only and Full-Access Users</a>
</span> shows which actions read-only
and full-access users are permitted to perform on regular or source databases
and on target databases.</div>
</div>
<div>
<div style="font-weight: bold;">
<span style="color: red;">Table1. </span>Permissions for Read-Only and Full-Access Users</div>
<table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top">



<thead>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Action</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Read-Only Users</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;">
<div>Full-Access Users</div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Executing SELECT statements</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Reading database properties</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Loading database classes from jar files</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Executing INSERT, UPDATE, or DELETE statements</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span>&nbsp;'</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Executing DDL statements</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span>&nbsp;'</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Adding or replacing jar files</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span>&nbsp;'</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
</tr>
<tr>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>Setting database properties</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>
<span>&nbsp;'</span>
</div>
</td>
<td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top">
<div>X</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div>
<a name="N19738"></a><span></span>
<a name="N19741"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevcsecure131"></a><span></span>Examples of user authorization</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1974E"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This example shows the property settings to configure a database to support: </div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19757"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Full access for a single user named "sa"</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Read-only access for anyone else who connects to the database   
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.defaultConnectionMode',
    'readOnlyAccess')</span>
<span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers', 'sa')</span>
</div></pre>
</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19778"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following example shows the settings to configure a database to support: </div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19781"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Full access for a single user named "Fred!" (case-sensitive) with
full (read-write) access </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Read-only access for mary and guest </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>No access for other users</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N19798"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The example also demonstrates the use of delimited identifiers for user
names.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N197A1"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.defaultConnectionMode',
    'noAccess')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers', '"Fred!"')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.readOnlyAccessUsers', 'mary,guest')</span>
</div></pre>
</div>
</div>
</div>
</div>
<div>
<a name="N197DD"></a><span></span>
<a name="N197E6"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure24366"></a><span></span>Encrypting databases on disk</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
a way for you to encrypt your data on disk.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, database systems encrypt and decrypt data in transport over
the network, using industry-standard systems. This system works well for client/server
databases; the server is assumed to be in a trusted, safe environment, managed
by a system administrator. In addition, the recipient of the data is trusted
and should be capable of protecting the data. The only risk comes when transporting
data over the wire, and data encryption happens during network transport only.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
are platform-independent files that are designed to be easily shared in a
number of ways, including transport over the Internet. Recipients of the data
might not know how, or might not have the means, to properly protect the data.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This data encryption feature provides the ability to store user data in
an encrypted form. The user who boots the database must provide a boot password.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Jar files stored in the database are not encrypted.</div>
</div>
<div>
<a name="N198C9"></a><span></span>
<a name="N198D2"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure96815"></a><span></span>Requirements for Derby encryption</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports disk encryption, but you must supply the following:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>An implementation of the Java Cryptographic Extension (JCE) package version
1.2.1 or higher.   <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not support earlier, non-exportable, versions
of JCE (such as JCE 1.2). More information on JCE 1.2.1, including a product
download, can be found at: <span>
<span style="font-style: italic;">http://java.sun.com/products/jce/index.html</span>
</span>. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Any
attempt to create or access an encrypted database without the libraries for
an implementation of JCE of the proper version, or without Java
2 Platform, Standard Edition, v 1.2 (J2SE) or higher, raises an exception;
you will not be able to create or boot the database.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The JCE installation
documentation describes configuring (registering) the JCE software. You do
not need to do this; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> registers JCE dynamically. </div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The encryption provider   <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An encryption provider implements the Java
cryptography concepts. The JRE for J2SE 1.4 or J2EE 1.4 includes JCE and one
or more default encryption providers.</div>
</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N1995D"></a><span></span>
<a name="N19966"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure97760"></a><span></span>Working with encryption</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section describes using encryption in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div>
</div>
<div>
<a name="N199EA"></a><span></span>
<a name="N199F3"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure88690"></a><span></span>Encrypting databases on creation</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows you to configure a database for encryption when you
create it. To do so, you specify <span style="font-style: italic;">dataEncryption=true</span> on
the connection URL.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> The Java Runtime Environment (JRE) determines the default encryption provider,
as follows:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>For J2SE/J2EE 1.4 or higher, the JRE's provider is the default.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>For an IBM Corp J2SE/J2EE 1.3 JRE, the default provider is <span style="font-style: italic;">com.ibm.crypto.provider</span>.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>For a Sun Microsystem J2SE/J2EE 1.3 JRE, the default provider is <span style="font-style: italic;">com.sun.crypto.provider.SunJCE</span>. </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>For any other J2SE/J2EE 1.3 JRE, a provider must be specified.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You have the option of specifying an alternate encryption provider; see <span style="color: blue;">
<a href="#cdevcsecure31493">Specifying an alternate encryption provider</a>
</span>. The default encryption algorithm
is DES, but you have the option of specifying an alternate algorithm; see <span style="color: blue;">
<a href="#cdevcsecure67151">Specifying an alternate encryption algorithm</a>
</span>.</div>
</div>
</div>
<div>
<a name="N19AAF"></a><span></span>
<a name="N19AB8"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure866716"></a><span></span>Creating the boot password</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you encrypt a database you must also specify a boot password, which
is an alpha-numeric string used to generate the encryption key. The length
of the encryption key depends on the algorithm used:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>AES (128, 192, and 256 bits)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>DES (the default) (56 bits)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>DESede (168 bits)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>All other algorithms (128 bits)</div>
</td></tr></table></div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The boot password should have at least as many characters as number
of bytes in the encryption key (56 bits=8 bytes, 168 bits=24 bytes, 128 bits=16
bytes). The minimum number of characters for the boot password allowed by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is eight.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It is a good idea not to use words that would be easily guessed, such as
a login name or simple words or numbers. A <span style="font-style: italic;">bootPassword</span>, like any password,
should be a mix of numbers and upper- and lowercase letters.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You turn on and configure encryption and specify the corresponding boot
password on the connection URL for a database when you create it:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:encryptionDB1;create=true;dataEncryption=true;
    bootPassword=clo760uds2caPe</div></pre>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If you lose the <span style="font-style: italic;">bootPassword</span> and the database is not currently
booted, you will not be able to connect to the database anymore. (If you know
the current <span style="font-style: italic;">bootPassword</span>, you can change it. See <span style="color: blue;">
<a href="#cdevcsecure55054">Changing the boot password</a>
</span>.)</div>
</div>
<div>
<a name="N19B76"></a><span></span>
<a name="N19B7F"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure31493"></a><span></span>Specifying an alternate encryption provider: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can specify an alternate provider when you create the database with
the <span style="font-family: Courier;">
<span style="font-style: italic;">encryptionProvider=providerName</span>
</span> attribute. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You must specify the full package and class name of the provider, and you
must also add the libraries to the application's classpath.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">-- using the the provider library jce_jdk13-10b4.zip|
-- available from www.bouncycastle.org</span>
jdbc:derby:encryptedDB3;create=true;dataEncryption=true;
bootPassword=clo760uds2caPe;
encryptionProvider=org.bouncycastle.jce.provider.BouncyCastleProvider;
encryptionAlgorithm=DES/CBC/NoPadding

<span style="font-weight: bold;">-- using a provider
-- available from
-- http://jcewww.iaik.tu-graz.ac.at/download.html</span>
jdbc:derby:encryptedDB3;create=true;dataEncryption=true;
bootPassword=clo760uds2caPe;
encryptionProvider=iaik.security.provider.IAIK;encryptionAlgorithm=
DES/CBC/NoPadding</div></pre>
</div>
</div>
<div>
<a name="N19BE4"></a><span></span>
<a name="N19BED"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure67151"></a><span></span>Specifying an alternate encryption algorithm: </div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the following encryption algorithms:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>DES (the default)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>DESede (also known as triple DES)</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Any encryption algorithm that fulfills the following requirements:  
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>It is symmetric</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>It is a block cipher, with a block size of 8 bytes</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>It uses the <span style="font-style: italic;">NoPadding</span> padding scheme</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Its secret key can be represented as an arbitrary byte array</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>It requires exactly one initialization parameter, an initialization vector
of type <span style="font-style: italic;">javax.crypto.spec.IvParameterSpec</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>It can use <span style="font-style: italic;">javax.crypto.spec.SecretKeySpec</span> to
represent its key</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, the algorithm <span style="font-style: italic;">Blowfish</span> implemented
in the Sun JCE package fulfills these requirements.</div>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By Java convention, an encryption algorithm is specified like this:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-style: italic;">algorithmName</span>/<span style="font-style: italic;">feedbackMode</span>/<span style="font-style: italic;">padding</span>
</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The only feedback modes allowed are:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>CBC</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>CFB</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>ECB</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>OFB</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By default, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses the DES algorithm of <span style="font-style: italic;">DES/CBC/NoPadding</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specify an alternate encryption algorithm when you create a database with
the <span style="font-style: italic;">encryptionAlgorithm=algorithm</span> attribute. If the
algorithm you specify is not supported by the provider you have specified, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> throws
an exception.</div>
</div>
</div>
</div>
<div>
<a name="N19CE6"></a><span></span>
<a name="N19CEF"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure60146"></a><span></span>Booting an encrypted database</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once you have created an encrypted database, you must supply the boot password
to reboot it. Encrypted databases cannot be booted automatically along with
all other system databases on system startup (see <span style="font-style: italic;">"derby.system.bootAll" </span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>). Instead, you boot encrypted databases
when you first connect to them.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, to access an encrypted database called <span style="font-style: italic;">wombat,</span> created with the boot password clo760uds2caPe<span style="font-style: italic;">,</span> you would use the following connection URL:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:wombat;bootPassword=clo760uds2caPe</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once the database is booted, all connections can access the database without
the boot password. Only a connection that boots the database requires the
key.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, the following connections would boot the database and thus
require the boot password:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The first connection to the database in the JVM session</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The first connection to the database after the database has been explicitly
shut down</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The first connection to the database after the system has been shut down
and then rebooted</div>
</td></tr></table></div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The boot password is not meant to prevent unauthorized connections
to the database once it has been booted. To protect a database once it has
been booted, turn on user authentication (see <span style="color: blue;">
<a href="#cdevcsecure42374">Working with user authentication</a>
</span>).</div>
</div>
</div>
<div>
<a name="N19DA3"></a><span></span>
<a name="N19DAC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="cdevcsecure55054"></a><span></span>Changing the boot password</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can change the boot password for the current database.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'bootPassword', '<span style="font-style: italic;">oldbpw</span> , <span style="font-style: italic;">newbpw</span>');</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">where <span style="font-style: italic;">oldbpw</span> is the current boot password and <span style="font-style: italic;">newbpw</span> is the new boot password. This call commits immediately;
it is not transactional.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="font-family: Courier;">
<span style="font-style: italic;">PropertyInfo.getDatabaseProperty("bootPassword")</span>
</span>, or <span style="font-family: Courier;">VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY('bootPassword')</span>, will not return the boot password.</div>
</div>
</div>
</div>
</div>
<div>
<a name="N19E34"></a><span></span>
<a name="N19E3D"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure90988"></a><span></span>Signed jar files</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a Java 2 environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can detect digital signatures on jar
files. When attempting to load a class from a signed jar file stored in the
database, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will verify the validity of the signature.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> class loader only validates the integrity
of the signed jar file and that the certificate has not expired. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> cannot
ascertain whether the validity/identity of declared signer is correct. To
validate identity, use a Security Manager (i.e., an implementation of <span style="font-style: italic;">java.lang.SecurityManager</span>).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When loading classes from an application jar file in a Java 2 environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> behaves
as follows: </div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">If the class is signed, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will:</span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Verify that the jar was signed using a X.509 certificate (i.e., can be
represented by the class <span style="font-style: italic;">java.security.cert.X509Certificate</span>). If not, throw an exception. </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Verify that the digital signature matches the contents of the file. If
not, throw an exception. </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Check that the set of signing certificates are all valid for the current
date and time. If any certificate has expired or is not yet valid, throw an
exception.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Pass the array of certificates to the <span style="font-style: italic;">setSigners()</span> method of <span style="font-family: Courier;">
<span style="font-style: italic;">java.lang.ClassLoader</span>
</span>.
This allows security managers to obtain the list of signers for a class (using <span style="font-family: Courier;">
<span style="font-style: italic;">java.lang.Class.getSigners</span>
</span>) and then validate the
identity of the signers using the services of a Public Key Infrastructure
(PKI). </div>
</td></tr></table></div>
</div>
</td></tr></table></div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not provide a security manager.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about signed jar files, see the Java 2 specifications
at <span>
<span style="font-style: italic;">http://java.sun.com</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about Java 2 security, go to <span>
<span style="font-style: italic;">http://java.sun.com/security/</span>
</span>.</div>
</div>
</div>
<div>
<a name="N19F83"></a><span></span>
<a name="N19F8C"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure10983"></a><span></span>Notes on the Derby security features</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Because <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not support traditional grant and revoke features,
the security model has some basic limitations. For both embedded and client/server
systems, it assumes that users are trusted. You must trust your full-access
users not to perform undesirable actions. You lock out non full-access users
with database properties, which are stored in the database (and in an encrypted
database these properties are also encrypted). Note, however, for a distributed/embedded
system that a sophisticated user with the database encryption key might be
able to physically change those properties in the database files.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, it is not necessary to have a specific
connection (or permission to access a particular database) to shut down the
system. Any authenticated user can shut down the system.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Other security holes to think about are:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>JVM subversion, running the application under a home-grown JVM.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Trolling for objects</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Class substitution, locating a class that has access to sensitive data
and replacing it with one that passes on information</div>
</td></tr></table></div>
</div>
</div>
<div>
<a name="N1A055"></a><span></span>
<a name="N1A05E"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcsecure51876"></a><span></span>User authentication and authorization examples</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section provides examples on using user authentication and authorization
in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in either a client/server
environment or in an embedded environment.</div>
</div>
<div>
<a name="N1A111"></a><span></span>
<a name="N1A11A"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevcsecure125"></a><span></span>User authentication example in a client/server environment</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A127"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In this example, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is running in a user-designed application
server. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides the user authentication, not the application
server. The server is running in a secure environment, the application server
encrypts the passwords, and a database administrator is available. The administrator
configures security using system-level properties in the <span style="font-style: italic;">derby.properties</span> file and has protected this file with operating system
tools. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connects to an existing LDAP directory service within the
enterprise to authenticate users.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A148"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The default access mode for all databases is set to <span style="font-style: italic;">fullAccess</span> (the default).</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A157"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-style: italic;">derby.properties</span> file for the server includes
the following entries:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A166"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;"># turn on user authentication</span>
derby.connection.requireAuthentication=true
<span style="font-weight: bold;"># set the authentication provider to an external LDAP server</span>
derby.authentication.provider=LDAP
<span style="font-weight: bold;"># the host name and port number of the LDAP server</span>
derby.authentication.server=godfrey:389
<span style="font-weight: bold;"># the search base for user names</span>
derby.authentication.ldap.searchBase=o=oakland.mycompany.com
<span style="font-weight: bold;"># explicitly show the access mode for databases (this is default)</span>
derby.database.defaultAccessMode=fullAccess</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A18D"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">With these settings, all users must be authenticated by the LDAP server
in order to access any <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A19C"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The database administrator has determined that one database, <span style="font-style: italic;">accountingDB</span>, has additional security needs. Within a connection to that
database, the database administrator uses database-wide properties (which
override properties set in the <span style="font-style: italic;">derby.properties</span> file)
to limit access to this database. Only the users <span style="font-style: italic;">prez</span>, <span style="font-style: italic;">cfo</span>, and <span style="font-style: italic;">numberCruncher</span> have full
(read-write) access to this database, and only <span style="font-style: italic;">clerk1</span> and <span style="font-style: italic;">clerk2</span> have read-only access to this database. No other
users can access the database.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A1CF"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.defaultAccessMode', 'noAccess')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers',
    'prez,cfo,numberCruncher')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.readAccessUsers', 'clerk1,clerk2')</span>
</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A1DD"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The database administrator then requires all current users to disconnect
and re-connect. These property changes do not go into effect for current connections.
The database administrator can force current users to reconnect by shutting
down the database</div>
</div>
</div>
</div>
<div>
<a name="N1A207"></a><span></span>
<a name="N1A210"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevcsecure13713"></a><span></span>User authentication example in a single-user, embedded environment</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A21D"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In this example, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
embedded in a single-user application that is deployed in a number of different
and potentially insecure ways. For that reason, the application developer
has decided to encrypt the database and to turn on user authentication using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s built-in user authentication,
which will not require connections to an LDAP server. The end-user must know
the <span style="font-style: italic;">bootPassword</span> to boot the database and the user name and password
to connect to the database. Even if the database ended up in an e-mail, only
the intended recipient would be able to access data in the database. The application
developer has decided not to use any user authorization features, since each
database will accept only a single user. In that situation, the default full-access
connection mode is acceptable.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A238"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When creating the database, the application developer encrypts
the database by using the following connection URL:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A241"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">jdbc:derby:wombat;create=true;dataEncryption=true;
    bootPassword=sxy90W348HHn</span>
</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A24F"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Before deploying the database, the application developer turns
on user authentication, sets the authentication provider to BUILTIN, creates
a single user and password, and disallows system-wide properties to protect
the database-wide security property settings:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A258"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.connection.requireAuthentication', 'true')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.authentication.provider', 'BUILTIN')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.enduser', 'red29PlaNe')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.propertiesOnly', true')</span>
</div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A266"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When the user connects (and boots) the database, the user has
to provide the <span style="font-style: italic;">bootPassword</span>, the user name, and the password. The following
example shows how to provide those in a connection URL, although the application
programmer would probably provide GUI windows to allow the end user to type
those in:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A275"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">jdbc:derby:wombat;bootPassword=sxy90W348HHn;
    user=enduser;password=red29PlaNe</span>
</div></pre>
</div>
</div>
<div>
<a name="N1A2B6"></a><span></span>
<a name="N1A2BF"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure26537"></a><span></span>User authentication and authorization extended examples</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A2CC"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following two examples from the <span style="font-style: italic;">sample</span> database
show how to turn on and turn off user authentication using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in user authentication and user authorization.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A2E1"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">/** 
	  * Turn on built-in user authentication and user authorization. 
	  * 
	  * @param conn a connection to the database.
	  */

	public static void turnOnBuiltInUsers(Connection conn) throws SQLException { 
		System.out.println("Turning on authentication."); 
		Statement s = conn.createStatement(); 


		// Setting and Confirming requireAuthentication 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.connection.requireAuthentication', 'true')");
		ResultSet rs = s.executeQuery( 
			"VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(" + 
			"'derby.connection.requireAuthentication')"); 
		rs.next(); 
		System.out.println(rs.getString(1)); 
		// Setting authentication scheme to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.authentication.provider', 'BUILTIN')"); 

		// Creating some sample users 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.user.sa', 'ajaxj3x9')"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.user.guest', 'java5w6x')"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.user.mary', 'little7xylamb')"); 

		// Setting default connection mode to no access 
		// (user authorization) 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.defaultConnectionMode', 'noAccess')"); 
		// Confirming default connection mode 
		rs = s.executeQuery (
			"VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(" + 
			"'derby.database.defaultConnectionMode')"); 
		rs.next(); 
		System.out.println(rs.getString(1)); 

		// Defining read-write users 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.fullAccessUsers', 'sa,mary')"); 

		// Defining read-only users 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.readOnlyAccessUsers', 'guest')"); 

		// Confirming full-access users 
		rs = s.executeQuery(
			"VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(" + 
			"'derby.database.fullAccessUsers')"); 
		rs.next(); 
		System.out.println(rs.getString(1)); 

		// Confirming read-only users 
		rs = s.executeQuery(
			"VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(" + 
			"'derby.database.readOnlyAccessUsers')"); 
		rs.next(); 
		System.out.println(rs.getString(1)); 

		//we would set the following property to TRUE only 
		//when we were ready to deploy. 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.propertiesOnly', 'false')"); 
		s.close(); 
	} </div></pre>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A2F1"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">/** 
	  * Turn off built-in user authentication and user authorization. 
	  * 
	  * @param conn a connection to the database.
	  */

	public static void turnOffBuiltInUsers(Connection conn) throws SQLException { 
		Statement s = conn.createStatement(); 
		System.out.println("Turning off authentication."); 

		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.connection.requireAuthentication', 'false')"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.authentication.provider', null)"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.user.sa', null)"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.user.guest', null)"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.user.mary', null)"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.defaultConnectionMode', 'fullAccess')"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.fullAccessUsers', null)"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.readOnlyAccessUsers', null)"); 
		s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" + 
			"'derby.database.propertiesOnly', 'false')"); 

		// Confirming requireAuthentication 
		ResultSet rs = s.executeQuery(
			"VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(" + 
			"'derby.connection.requireAuthentication')"); 
		rs.next(); 
		System.out.println(rs.getString(1)); 

		// Confirming default connection mode 
		rs = s.executeQuery(
			"VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(" + 
			"'derby.database.defaultConnectionMode')"); 
		rs.next(); 
		System.out.println(rs.getString(1)); 
		System.out.println("Turned off all the user-related properties."); 
		s.close(); 
	}
}
</div></pre>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N1A30F"></a><span></span>
<a name="N1A318"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevcbabejdfj"></a><span></span>Running Derby under a security manager</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When running within an application or application server with a Java 2
Security Manager enabled, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> must be granted certain permissions
to execute and access database files.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about permissions and examples of creating permission
objects and granting permissions, see the Security Architecture specification
at <span>
<span style="font-style: italic;">http://java.sun.com/j2se/1.4.2/docs/guide/security/PolicyFiles.html</span>
</span>.</div>
</div>
<div>
<a name="N1A3F1"></a><span></span>
<a name="N1A3FA"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevbabejgjd"></a><span></span>Granting permissions to Derby</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses which permissions should be granted to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> (the code base derby.jar).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See Default Policy Implementation and Policy File Syntax at <span>
<span style="font-style: italic;">http://java.sun.com/j2se/1.4.2/docs/guide/security/PolicyFiles.html</span>
</span> for more information about creating policy files.</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A433"></a><span></span>
<div style="font-weight: bold;">Mandatory permissions</div>
<div>
<div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.lang.RuntimePermission createClassLoader</span>
</div>
<div style="margin-left: 72pt + 16pt;">Mandatory. It allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
execute SQL queries and supports loading class files from jar files stored
in the database.</div>
</div>
<div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.util.PropertyPermission "derby.*", read</span>
</div>
<div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to read
individual <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties
set in the JVM's system set. If the action is denied, properties in the JVM's
system set are ignored.</div>
</div>
</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A46E"></a><span></span>
<div style="font-weight: bold;">Database access permissions</div>
<div>
<div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.io.FilePermission "directory${/}/-", "read,write,delete"</span>
</div>
<div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to manage
files within the database that maps to the directory specified. For read-only
databases, only the "read" action needs to be granted.</div>
</div>
</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A48F"></a><span></span>
<div style="font-weight: bold;">Optional permissions</div>
<div>
<div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.io.FilePermission "${derby.system.home}", "read,write"</span>
</div>
<div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to determine
the system directory when set by d<span style="font-style: italic;">b2j.system.home </span>and create it if
needed. If the system directory already exists then only the "read" permission
needs to be granted.</div>
</div>
<div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.util.PropertyPermission "user.dir", "read"</span>
</div>
<div style="margin-left: 72pt + 16pt;">Permits access to the system directory value if <span style="font-style: italic;">derby.system.home</span> is
not set or no permission has been granted to read the <span style="font-family: Courier;">
<span style="font-style: italic;">derby.system.home</span>
</span> property.</div>
</div>
<div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.io.FilePermission "${derby.system.home}${/}derby.properties",
"read"</span>
</div>
<div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to read
the system properties file from the system directory.</div>
</div>
<div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.io.FilePermission "${derby.system.home}${/}derby.log",
"read,write,delete"</span>
</div>
<div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">
<span style="font-weight: bold;">permission java.io.FilePermission "${user.dir}${/}derby.log", "read,write,delete"</span>
</div>
<div style="margin-left: 72pt + 16pt;">Only one of these permissions is needed. Permits the application to read,
write, and delete to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> log
file, unless the log has been re-directed. (See the <span style="font-style: italic;">derby.stream.error </span>properties
in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span> for more
information.) If one of the requested valid actions is denied, the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> log
will be <span style="font-family: Courier;">
<span style="font-style: italic;">java.lang.System.err</span>
</span>.</div>
</div>
</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A525"></a><span></span>
<div style="font-weight: bold;">Combining permissions</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You might grant one <span style="font-style: italic;">FilePermission</span> that
encompasses several or all of the permissions instead of separately granting
a number of the more specific permissions. For example:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">permission java.io.FilePermission "${derby.system.home}/-", "read,write,delete"</div></pre>This allows the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
complete access to the system directory and any databases contained in the
system directory.</div>
</div>
</div>
</div>
<div>
<a name="N1A567"></a><span></span>
<a name="N1A570"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevcsecure871387"></a><span></span>Examples of Java 2 security policy files for embedded Derby</div>
<div style="margin-left: 72pt; font-size: 10pt;"></div>
<div>
<a name="N1A5DC"></a><span></span>
<a name="N1A5E5"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure871406"></a><span></span>Java 2 security policy file example 1</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A5F2"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">/* Grants permission to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and access all      */
/* databases under the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system home              */
/* when it is specified by the system property             */
/* <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.system.home                                        */

/* Note <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.system.home must be an absolute pathname */</span>

grant codeBase "file://f:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/derby.jar" {

  permission java.lang.RuntimePermission "createClassLoader";
  permission java.util.PropertyPermission "derby.*", "read";

  permission java.io.FilePermission "${derby.system.home}${/}
-", "read,write,delete";
};</div></pre>
</div>
</div>
</div>
<div>
<a name="N1A64D"></a><span></span>
<a name="N1A656"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure871422"></a><span></span>Java 2 security policy file example 2</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A663"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">/* Grants permission to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and access all      */
/* databases under the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system home              */
/* when it defaults to the current directory               */</span>


grant codeBase "file://f:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/derby.jar" {
  permission java.lang.RuntimePermission "createClassLoader";
  permission java.util.PropertyPermission "derby.*", "read";
 
  permission java.util.PropertyPermission "user.dir", "read";
  permission java.io.FilePermission "${user.dir}${/}-",
 "read,write,delete";

};</div></pre>
</div>
</div>
</div>
<div>
<a name="N1A6B2"></a><span></span>
<a name="N1A6BB"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevcsecure871439"></a><span></span>Java 2 security policy file example 3</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A6C8"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">/* Grants permission to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and access a single */
/* database (salesdb) under the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system home     */

/* Note <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.system.home must be an absolute pathname */</span>

grant codeBase "file://f:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/derby.jar" {

  permission java.lang.RuntimePermission "createClassLoader";
  permission java.util.PropertyPermission "derby.*", "read";

  permission java.io.FilePermission "${derby.system.home}${/}*", 
"read,write,delete";
  permission java.io.FilePermission "${derby.system.home}${/}
salesdb${/}
-", "read,write,delete";


}; </div></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N1A71D"></a><span></span>
<a name="N1A726"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevadvjdbc35053"></a><span></span>Developing Tools and Using Derby with an IDE</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Applications such as database tools are designed to work with databases
whose schemas and contents are unknown in advance. This section discusses
a few topics useful for such applications.</div>
</div>
<div>
<a name="N1A75A"></a><span></span>
<a name="N1A763"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevadvjdbc41138"></a><span></span>Offering Connection Choices to the User</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC's <span style="font-style: italic;">java.sql.Driver.getPropertyInfo</span> method
allows a generic GUI tool to determine the properties for which it should
prompt a user in order to get enough information to connect to a database.
Depending on the values the user has supplied so far, additional values might
become necessary. It might be necessary to iterate though several calls to <span style="font-family: Courier;">
<span style="font-style: italic;">getPropertyInfo</span>
</span>. If no more properties are necessary,
the call returns an array of zero length.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, do not use the method against an instance of <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>. Instead, request
the JDBC driver from the driver manager:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">java.sql.DriverManager.getDriver(
    "jdbc:derby:").getPropertyInfo(<span style="font-style: italic;">URL</span>, <span style="font-style: italic;">Prop</span>)</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, the properties returned in the <span style="font-style: italic;">DriverPropertyInfo</span> object are connection URL attributes, including a list of booted
databases in a system (the <span style="font-family: Courier;">
<span style="font-style: italic;">databaseName</span>
</span> attribute).</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Databases in a system are not automatically booted until you connect with
them. You can configure your system to retain the former behavior, in which
case the steps described in this section will continue to work. See <span style="font-style: italic;">"derby.system.bootAll" </span> in <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Tuning Derby</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="font-style: italic;">getPropertyInfo</span> requires a connection URL and a <span style="font-family: Courier;">
<span style="font-style: italic;">Properties</span>
</span> object as parameters. Typically, what
you pass are values that you will use in a future call to <span style="font-family: Courier;">
<span style="font-style: italic;">java.sql.DriverManager.getConnection</span>
</span> when you actually connect
to the database. For information about setting attributes in calls to <span style="font-family: Courier;">
<span style="font-style: italic;">java.sql.DriverManager.getConnection</span>
</span>, see <span style="color: blue;">
<a href="#rdevdvlp22102">Database connection examples</a>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A call to <span style="font-style: italic;">getPropertyInfo</span> with parameters that
contain sufficient information to connect successfully returns an array of
zero length. (Receiving this zero-length array does not <span style="font-style: italic;">guarantee</span> that the <span style="font-family: Courier;">
<span style="font-style: italic;">getConnection</span>
</span> call
will succeed, because something else could go wrong.)</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Repeat calls to <span style="font-style: italic;">getPropertyInfo</span> until it returns
a zero-length array or none of the properties remaining are desired.</div>
</div>
<div>
<a name="N1A87C"></a><span></span>
<a name="N1A885"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="rdevadvjdbc034"></a><span></span>The DriverPropertyInfo Array</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A89F"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a non-zero-length array is returned by <span style="font-style: italic;">getPropertyInfo</span>, each element is a <span style="font-family: Courier;">
<span style="font-style: italic;">DriverPropertyInfo</span>
</span> object
representing a connection URL attribute that has not already been specified. Only those
that make sense in the current context are returned.</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A8B8"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This <span style="font-style: italic;">DriverPropertyInfo</span> object contains:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A8C7"></a><span></span>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">name of the attribute</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">description</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">current value</span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If an attribute has a default
value, this is set in the value field of <span style="font-style: italic;">DriverPropertyInfo</span>, even if the attribute has not been set in the connection URL or the <span style="font-family: Courier;">
<span style="font-style: italic;">Properties</span>
</span> object. If the attribute does not have
a default value and it is not set in the URL or the <span style="font-family: Courier;">
<span style="font-style: italic;">Properties</span>
</span> object, its value will be null.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">list of choices</span>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="font-style: italic;">whether required for a connection request</span>
</div>
</td></tr></table></div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A91B"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Several fields in a <span style="font-style: italic;">DriverPropertyInfo</span> object are
allowed to be null.</div>
</div>
</div>
<div>
<a name="N1A950"></a><span></span>
<a name="N1A959"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;">
<a name="rdevadvjdbc965"></a><span></span>DriverPropertyInfo array example</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A978"></a><span></span>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here is some example code:</div>
</div>
<div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;">
<a name="N1A981"></a><span></span>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;
import java.util.Properties;
<span style="font-weight: bold;">// start with the least amount of information
// to see the full list of choices
// we could also enter with a URL and Properties
// provided by a user.</span>
String url = "jdbc:derby:";
Properties info = new Properties();
Driver cDriver = DriverManager.getDriver(url);
for (;;)
        {
        DriverPropertyInfo[] attributes = cDriver.getPropertyInfo(
            url, info);
        <span style="font-weight: bold;"> // zero length means a connection attempt can be made</span>
        if (attributes.length == 0)
        break;
<span style="font-weight: bold;">        // insert code here to process the array, e.g.,
        // display all options in a GUI and allow the user to
        // pick and then set the attributes in info or URL.</span>
        }
<span style="font-weight: bold;">// try the connection</span>
Connection conn = DriverManager.getConnection(url, info);</div></pre>
</div>
</div>
</div>
</div>
</div>
<div>
<a name="N1A9B7"></a><span></span>
<a name="N1A9C0"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevadvjdbc32436"></a><span></span>Using Derby with IDEs</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you use an integrated development environment (IDE) to develop an
embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application, you might need to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> within
a server framework. This is because an IDE might try connecting to the database
from two different JVMs, whereas only a single JVM instance should connect
to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database at one time, as described in <span style="color: blue;">
<a href="#cdevdvlp96597">One Derby instance for each Java Virtual Machine</a>
</span> (multiple connections from the same JVM are allowed). </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An "embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application" is one which runs in the
same JVM as the application. Such an application uses the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> driver
(<span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>; see <span style="color: blue;">
<a href="#cdevdvlp40170">Embedded Derby JDBC driver</a>
</span>) and connection URL (<span style="font-family: Courier;">
<span style="font-style: italic;">jdbc:derby:databaseName</span>
</span>; see <span style="color: blue;">
<a href="#rdevdvlp38881">Embedded Derby JDBC database connection URL</a>
</span>). If you use this
driver name or connection URL from the IDE, when the IDE tries to open a second connection
to the same database with the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, the attempt fails. Two
JVMs cannot connect to the same database in embedded mode.</div>
</div>
<div>
<a name="N1AA6D"></a><span></span>
<a name="N1AA76"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevadvjdbc18939"></a><span></span>IDEs and multiple JVMs</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you use an integrated development environment (IDE) to build a Java
application, you can launch the application from within the IDE at any point
in the development process. Typically, the IDE launches a JVM dedicated to
the application. When the application completes, the JVM exits. Any database
connections established by the application are closed. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">During the development of a database application, most IDEs allow you to
test individual database connections and queries without running the entire
application. When you test an individual database connection or query (which
requires a database connection), the IDE might launch a JVM that runs in a
specialized testing environment. In this case, when a test completes, the
JVM remains active and available for further testing, and the database connection
established during the test remains open.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Because of the behaviors of the IDE described above, if you use the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC
driver, you may encounter errors connecting in the following situations:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>You test an individual query or database connection and then try to run
an application that uses the same database as the tested feature.  
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The
database connection established by testing the connection or query stays open,
and prevents the application from establishing a connection to the same database.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>You run an application, and before it completes (for example, while it
waits for user input), you attempt to run a second application or to test
a connection or query that uses the same database as the first application.</div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<div>
<a name="N1AABF"></a><span></span>
<a name="N1AAC8"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevtricks32436"></a><span></span>SQL tips</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section provides some examples of interesting SQL features. It also
includes a few non-SQL tips.</div>
</div>
<div>
<a name="N1AB27"></a><span></span>
<a name="N1AB30"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevtricks19707"></a><span></span>Retrieving the database connection URL</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not have a built-in function that returns the name of
the database. However, you can use <span style="font-style: italic;">DatabaseMetaData</span> to
return the connection URL of any local <span style="font-family: Courier;">
<span style="font-style: italic;">Connection</span>
</span>.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">/* in java */</span>
String myURL = conn.getMetaData().getURL();
</div></pre>
</div>
</div>
<div>
<a name="N1ABBC"></a><span></span>
<a name="N1ABC5"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevtricks39584"></a><span></span>Supplying a parameter only once</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you want to supply a parameter value once and use it multiple times
within a query, put it in the FROM clause with an appropriate CAST:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT  phonebook.* 
	FROM phonebook, (VALUES (CAST(? AS INT), CAST(? AS VARCHAR(255))))  
						AS Choice(choice, search_string)
	WHERE search_string = (case when choice = 1 then firstnme 
                 when choice=2 then lastname 
						when choice=3 then phonenumber end);</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This query selects what the second parameter will be compared to based
on the value in the first parameter. Putting the parameters in the FROM clause
means that they need to be applied only once to the query, and you can give
them names so that you can refer to them elsewhere in the query. In the example
above, the first parameter is given the name <span style="font-style: italic;">choice</span>,
and the second parameter is given the name <span style="font-style: italic;">search_string</span>.</div>
</div>
</div>
<div>
<a name="N1AC4D"></a><span></span>
<a name="N1AC56"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevtricks21248"></a><span></span>Defining an identity column</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An identity column is a column that stores numbers that increment by one
with each insertion. Identity columns are sometimes called autoincrement columns. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
autoincrement as a built-in feature; see CREATE TABLE statement in the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Below is an example that shows how to use an identity column to create
the MAP_ID column of the MAPS table in the <span style="font-style: italic;">toursDB database</span>.</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CREATE TABLE MAPS
(
MAP_ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
MAP_NAME VARCHAR(24) NOT NULL,
REGION VARCHAR(26),
AREA DECIMAL(8,4) NOT NULL,
PHOTO_FORMAT VARCHAR(26) NOT NULL,
PICTURE BLOB(102400),
UNIQUE (MAP_ID, MAP_NAME)
)</div></pre>
</div>
</div>
<div>
<a name="N1ACF1"></a><span></span>
<a name="N1ACFA"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevtricks23426"></a><span></span>Using third-party tools</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can hook into any JDBC tool with just our JDBC Driver class name (<span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>) and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
JDBC connection URL. </div>
</div>
</div>
<div>
<a name="N1AD60"></a><span></span>
<a name="N1AD69"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevtricks13019"></a><span></span>Tricks of the VALUES clause</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;"></div>
<div>
<a name="N1ADFB"></a><span></span>
<a name="N1AE04"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevtricks807337"></a><span></span>Multiple rows</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the complete SQL-92 VALUES clause; this is very handy
in several cases. The first useful case is that it can be used to insert multiple
rows:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">INSERT INTO OneColumnTable VALUES 1,2,3,4,5,6,7,8

INSERT INTO TwoColumnTable VALUES
    (1, 'first row'),
    (2, 'second row'),
    (3, 'third row')</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Dynamic parameters reduce the number of times execute requests are sent
across:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-weight: bold;">-- send 5 rows at a time:</span>
PREPARE p1 AS 'INSERT INTO ThreeColumnTable VALUES 
(?,?,?), (?,?,?), (?,?,?), (?,?,?), (?,?,?)
EXECUTE p1 USING 'VALUES (''1st'',1,1,''2nd'',2,2''3rd'',
3,3,''4th'',4,4,''5th'',5,5)'</span>
</div></pre>
</div>
</div>
<div>
<a name="N1AE5A"></a><span></span>
<a name="N1AE63"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevtricks807365"></a><span></span>Mapping column values to return values</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Multiple-row VALUES tables are useful in mapping column values to desired
return values in queries:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">
<span style="font-weight: bold;">-- get the names of all departments in Ohio</span>
SELECT DeptName
FROM Depts,
(VALUES (1, 'Shoe'),
    (2, 'Laces'),
    (4, 'Polish'))
AS DeptMap(DeptCode,DeptDesc)
WHERE Depts.DeptCode = DeptMap.DeptCode
AND Depts.DeptLocn LIKE '%Ohio%'</span>
</div></pre>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You might also find it useful to store values used often for mapping in
a persistent table and then using that table in the query.</div>
</div>
</div>
<div>
<a name="N1AEAA"></a><span></span>
<a name="N1AEB3"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;">
<a name="cdevtricks807400"></a><span></span>Creating empty queries</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Developers using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in existing applications might need to create "empty"
queries with the right result shape for filling in bits of functionality <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
not supply. Empty queries of the right size and shape can be formed off a
single values table and a "WHERE FALSE" condition:</div>
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">SELECT *
FROM (VALUES ('',1,"TRUE")) AS ProcedureInfo(ProcedureName,NumParameters, 
ProcedureValid)
WHERE 1=0</span>
</div></pre>
</div>
</div>
</div>
</div>
<div>
<a name="N1AEFC"></a><span></span>
<a name="N1AF05"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevin10613"></a><span></span>Localizing Derby</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> offers support for locales. The word <span style="font-style: italic;">locale</span> in the Java platform refers to an instance of a class that identifies
a particular combination of language and region. If a Java class varies its
behavior according to <span style="font-style: italic;">locale</span>, it is said to be locale-sensitive. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
some support for locales for databases and other components such as the tools
and the installer.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It also provides a feature to support databases in many different languages,
a feature which is independent of a particular territory.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you create or upgrade a database, you can use the territory attribute
to associate a non-default territory with the database. For information about
how to use the territory attribute, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Reference Manual</span>
</span>
</span>.</div>
</div>
<div>
<a name="N1AF95"></a><span></span>
<a name="N1AF9E"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevin71274"></a><span></span>SQL parser support for Unicode</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To support users in many different languages, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s SQL parser
understands all Unicode characters and allows any Unicode character or number
to be used in an identifier. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not attempt to ensure that the
characters in identifiers are valid in the database's locale.</div>
</div>
</div>
<div>
<a name="N1AFF7"></a><span></span>
<a name="N1B000"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevin55108"></a><span></span>Other components</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> also provides
locale support for the following: </div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Database error messages are in the language of the locale, if support
is explicitly provided for that locale with a special library.   <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> explicitly supports Spanish-language
error messages. If a database's locale is set to one of the Spanish-language
locales, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> returns
error messages in the Spanish language.</div>
</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools. In
the case of the tools, locale support includes locale-specific interface and
error messages and localized data display.   <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about
localization of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools,
see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Tools and Utilities Guide</span>
</span>
</span>. </div>
</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Localized messages require special libraries. See <span style="color: blue;">
<a href="#cdevin38113">Messages libraries</a>
</span>.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The locale of the error messages and of the tools is not determined by
the database's localle set by the <span style="font-style: italic;">locale=ll_CC</span> attribute when the database
is created but instead by the default system locale. This means that it is
possible to create a database with a non-default locale. In such a case, error
messages would not be returned in the language of the database's locale but
in the language of the default locale instead.</div>
<div>
<span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  You can override the default locale for ij with a property on the JVM.
For more information, see the <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">
<span style="font-style: italic;">Derby Tools and Utilities Guide</span>
</span>
</span>.</div>
</div>
</div>
<div>
<a name="N1B0C0"></a><span></span>
<a name="N1B0C9"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevin38113"></a><span></span>Messages libraries</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to provide localized messages:</div>
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>You must have the locale-specific <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar file. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
such jars for only some locales. You will find the locale jar files in the
/lib directory in your <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> installation.</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>The locale-specific <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar file must be in the classpath.</div>
</td></tr></table></div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The locale-specific <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar file is named <span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_ll_CC.jar</span>, where<span style="font-style: italic;"> ll</span> is the two-letter code for language,
and <span style="font-style: italic;">CC</span> is the two-letter code for country. For example,
the name of the jar file for error messages for the German locale is <span style="font-family: Courier;">
<span style="font-style: italic;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_de_DE.jar.</span>
</span>
</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the following locales:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_de_DE.jar German </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_es.jar - Spanish </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_fr.jar - French </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_it.jar - Italian </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_ja_JP.jar - Japanese </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_ko_KR.jar - Korean </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_pt_BR.jar - Brazilian Portuguese </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_zh_CN.jar - Simplified Chinese </div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>
<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_zh_TW.jar - Traditional Chinese</div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<div>
<a name="N1B1DF"></a><span></span>
<a name="N1B1E8"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="cdevstandards806118"></a><span></span>Derby and standards</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> adheres to SQL99 standards wherever possible. Below you will
find a guide to those features currently in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that are not standard;
these features are currently being evaluated and might be removed in future
releases.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section describes those parts of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that are non-standard
or not typical for a database system:</div>
</div>
<div>
<a name="N1B2CA"></a><span></span>
<a name="N1B2D3"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805644"></a><span></span>Dynamic SQL</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses JDBC's Prepared Statement, and does not provide SQL commands
for dynamic SQL. </div>
</div>
</div>
<div>
<a name="N1B38D"></a><span></span>
<a name="N1B396"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805664"></a><span></span>Cursors</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses JDBC's Result Sets, and does not provide SQL for manipulating
cursors except for positioned update and delete. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s scrolling
insensitive cursors are provided through JDBC, not through SQL commands. </div>
</div>
</div>
<div>
<a name="N1B456"></a><span></span>
<a name="N1B45F"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805690"></a><span></span>Information schema</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses its own system
catalog that can be accessed using standard JDBC DatabaseMetadata calls. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not provide the
standard Information Schema views.</div>
</div>
</div>
<div>
<a name="N1B51F"></a><span></span>
<a name="N1B528"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805716"></a><span></span>Transactions</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">All operations in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> are
transactional. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports
transaction control using JDBC 3.0 Connection methods. This includes support
for savepoints and for the four JDBC transaction isolation levels. The only
SQL command provided for transaction control is SET TRANSACTION ISOLATION.</div>
</div>
</div>
<div>
<a name="N1B5E9"></a><span></span>
<a name="N1B5F2"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805742"></a><span></span>Stored routines and PSM</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports external procedures using the Java programming language.
Procedures are managed using the CREATE PROCEDURE and DROP PROCEDURE statements. </div>
</div>
</div>
<div>
<a name="N1B6AC"></a><span></span>
<a name="N1B6B5"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805768"></a><span></span>Calling functions and procedures</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the CALL (procedure) statement for calling external procedures declared by the CREATE PROCEDURE statement. Built-in functions and user-defined functions declared with the CREATE FUNCTION command can be called as part of an SQL select statement or by using either a VALUES clause or VALUES expression. </div>
</div>
</div>
<div>
<a name="N1B76F"></a><span></span>
<a name="N1B778"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805841"></a><span></span>Unique constraints and nulls</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The SQL standard defines that unique constraints on nullable columns allow
any number of nulls; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not permit unique constraints on nullable
columns. </div>
</div>
</div>
<div>
<a name="N1B833"></a><span></span>
<a name="N1B83C"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805893"></a><span></span>NOT NULL characteristic</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The SQL standard says NOT NULL is a constraint, and can be named and viewed
in the information schema as such. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not provide naming for
NOT NULL, nor does it present it as a constraint in the information schema,
only as a characteristic of the column. </div>
</div>
</div>
<div>
<a name="N1B8F7"></a><span></span>
<a name="N1B900"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805949"></a><span></span>DECIMAL max precision</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, the maximum precision for DECIMAL columns is 31 digits.
SQL99 does not require a specific maximum precision for decimals, but most
products have a maximum precision of 15-32 digits.</div>
</div>
</div>
<div>
<a name="N1B9BB"></a><span></span>
<a name="N1B9C4"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards805975"></a><span></span>CLOB, and BLOB</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the standard
CLOB and BLOB data types. BLOB and CLOB values are limited to a maximum of
2,147,483,647 characters.</div>
</div>
</div>
<div>
<a name="N1BA7E"></a><span></span>
<a name="N1BA87"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards806001"></a><span></span>Expressions on LONGs</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> permits expressions on LONG VARCHAR; however LONG VARCHAR data
types are not allowed in:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>GROUP BY clauses</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>ORDER BY clauses</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>JOIN operations</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>PRIMARY KEY constraints</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>Foreign KEY constraints</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>UNIQUE key constraints</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>MIN aggregate function</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>MAX aggregate function</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>[NOT] IN predicate</div>
</td></tr><tr><td valign="top" style="text-align: right;" width="24">
<div>
<span>&bull;</span>
</div>
</td><td width="8">&nbsp;</td><td valign="top">
<div>UNION, INTERSECT, and EXCEPT operators</div>
</td></tr></table></div>SQL99 also places some restrictions on expressions on LONG types.</div>
</div>
</div>
<div>
<a name="N1BB78"></a><span></span>
<a name="N1BB81"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;">
<div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;">
<a name="cdevstandards806027"></a><span></span>ALTER TABLE</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Slightly different ALTER TABLE syntax for altering column defaults. SQL99
uses DROP and SET, we use DEFAULT.</div>
</div>
</div>
</div>
<div>
<a name="N1BC36"></a><span></span>
<a name="N1BC3F"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;">
<div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;">
<a name="rdevtrademderby"></a><span></span>Trademarks</div>
</div>
<div style="margin-left: 72pt; font-size: 10pt;">
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following terms are trademarks or registered trademarks of other companies
and have been used in at least one of the documents in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Apache Derby</span> documentation
library:</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cloudscape, DB2, DB2 Universal Database, DRDA, and IBM are trademarks of
International Business Machines Corporation in the United States, other countries,
or both.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Microsoft, Windows, Windows NT, and the Windows logo are trademarks of
Microsoft Corporation in the United States, other countries, or both. </div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Java and all Java-based trademarks are trademarks of Sun Microsystems,
Inc. in the United States, other countries, or both.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">UNIX is a registered trademark of The Open Group in the United States and
other countries.</div>
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Other company, product, or service names may be trademarks or service marks
of others.</div>
</div>
</div>
</div>
</div><div valign="top">
<div style="font-family: Helvetica; font-weight: bold; font-size: 10pt; text-align: center;">
<span>&bull;</span>
</div>
</div><br></body></html>